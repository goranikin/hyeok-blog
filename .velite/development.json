[
  {
    "title": "Attention is all you need",
    "description": "Deep dive into the Transformer architecture, especially the implementation in each layers.",
    "slug": "attention-is-all-you-need",
    "publishDate": "2025-04-13",
    "thumbnailUrl": "/development/attention-is-all-you-need/thum.jpeg",
    "content": "const{Fragment:l,jsx:e,jsxs:n}=arguments[0];function _createMdxContent(s){const r={a:\"a\",code:\"code\",hr:\"hr\",img:\"img\",li:\"li\",ol:\"ol\",p:\"p\",pre:\"pre\",span:\"span\",...s.components};return n(l,{children:[n(r.p,{children:[\"In this post, I will explain the \",e(r.a,{href:\"https://arxiv.org/abs/1706.03762\",children:\"transformer\"}),\" architecture and its implementation at the code level. I referred to a \",e(r.a,{href:\"https://github.com/jadore801120/attention-is-all-you-need-pytorch\",children:\"scratch\"}),\" implementation for the PyTorch code!\"]}),\"\\n\",e(r.p,{children:e(r.img,{src:\"/development/attention-is-all-you-need/1.png\",alt:\"\"})}),\"\\n\",e(r.p,{children:\"The authors of the paper all left Google and founded their own companies, except for Lukasz Kaiser, who joined OpenAI. Five out of the 7 companies have become unicorns, with a combined valuation exceeding $17 billion. It's quite impressive.\"}),\"\\n\",e(r.p,{children:e(r.img,{src:\"/development/attention-is-all-you-need/2.png\",alt:\"\"})}),\"\\n\",e(r.p,{children:\"This is Figure 1 from the paper. It illustrates the overall architecture of the Transformer.\"}),\"\\n\",e(r.p,{children:\"They designed the operation, called Scaled Dot-Product Attention, which calculates the attention scores between query and key vectors to reflect the context information between the tokens.\"}),\"\\n\",e(r.p,{children:\"They represented the formula like this.\"}),\"\\n\",e(r.p,{children:e(r.img,{src:\"/development/attention-is-all-you-need/3.png\",alt:\"\"})}),\"\\n\",e(r.p,{children:\"How can we implement Scaled Dot-Product Attention in PyTorch? Let's start from scratch.\"}),\"\\n\",e(l,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(r.code,{children:[n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"class\"}),e(r.span,{style:{color:\"#8FBCBB\"},children:\" ScaledDotProductAttention\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#8FBCBB\",fontWeight:\"bold\"},children:\"nn\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#8FBCBB\",fontWeight:\"bold\"},children:\"Module\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"    def\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" __init__\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" temperature\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" attn_dropout\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"0.1\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"        super\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"().\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"__init__\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"()\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"temperature \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" temperature\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"dropout \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" nn\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"Dropout\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"attn_dropout\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"    def\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" forward\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" q\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" k\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" v\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" mask\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=None\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",e(r.span,{className:\"line\",children:e(r.span,{style:{color:\"#616E88\"},children:\"        # q = [batch_size, n_head, len_q, d_k]\"})}),\"\\n\",e(r.span,{className:\"line\",children:e(r.span,{style:{color:\"#616E88\"},children:\"        # k = [batch_size, n_head, len_k, d_k]\"})}),\"\\n\",e(r.span,{className:\"line\",children:e(r.span,{style:{color:\"#616E88\"},children:\"        # v = [batch_size, n_head, len_k, d_v]\"})}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        attn \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" torch\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"matmul\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"q \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"/\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"temperature\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" k\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"transpose\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"2\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 3\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"))\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        if\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" mask \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"is\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" not\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" None\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"            attn \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" attn\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"masked_fill\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"mask \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"==\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 0\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" -\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"1e9\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        attn \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"dropout\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"F\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"softmax\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"attn\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" dim\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=-\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"1\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"))\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        output \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" torch\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"matmul\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"attn\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" v\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        return\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" output\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" attn\"})]})]})})}),\"\\n\",n(r.p,{children:[\"The original method uses the square root of \",e(r.code,{children:\"d_model\"}),\" for normalization, but this approach uses a learnable temperature parameter during training. A higher temperature value results in a more uniform attention distribution.\"]}),\"\\n\",n(r.p,{children:[e(r.code,{children:\"attn\"}),\" has a shape \",e(r.code,{children:\"[batch_size, n_head, len_q, len_k]\"}),\", which represents the attention scores between query and key vectors. For example, \",e(r.code,{children:\"a[:,:,1,2]\"}),\" is the attention score between the first query vector and the second key vector.\"]}),\"\\n\",e(r.p,{children:\"A mask is applied to ignore padding tokens in the sequence for efficiency and to ensure that self-attention in the decoder does not reference future tokens.\"}),\"\\n\",n(r.p,{children:[\"The output has a shape of \",e(r.code,{children:\"[batch_size, n_head, len_q, d_v]\"})]}),\"\\n\",e(r.p,{children:\"This is just one module used in the Multi-Head attention mechanism.\"}),\"\\n\",e(r.p,{children:e(r.img,{src:\"/development/attention-is-all-you-need/4.png\",alt:\"\"})}),\"\\n\",e(l,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(r.code,{children:[n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"class\"}),e(r.span,{style:{color:\"#8FBCBB\"},children:\" MultiHeadAttention\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#8FBCBB\",fontWeight:\"bold\"},children:\"nn\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#8FBCBB\",fontWeight:\"bold\"},children:\"Module\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"    def\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" __init__\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" n_head\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" d_model\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" d_k\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" d_v\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" dropout\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"0.1\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"        super\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"().\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"__init__\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"()\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"n_head \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" n_head\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"d_k \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" d_k\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"d_v \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" d_v\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"w_qs \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" nn\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"Linear\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"d_model\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" n_head \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"*\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" d_k\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" bias\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=False\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"w_ks \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" nn\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"Linear\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"d_model\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" n_head \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"*\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" d_k\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" bias\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=False\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"w_vs \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" nn\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"Linear\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"d_model\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" n_head \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"*\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" d_v\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" bias\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=False\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"fc \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" nn\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"Linear\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"n_head \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"*\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" d_v\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" d_model\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" bias\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=False\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"attention \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" ScaledDotProductAttention\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\"temperature\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"d_k \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"**\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 0.5\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"dropout \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" nn\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"Dropout\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"dropout\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"layer_norm \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" nn\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"LayerNorm\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"d_model\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" eps\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"1e-6\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"    def\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" forward\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" q\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" k\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" v\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" mask\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=None\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",e(r.span,{className:\"line\",children:e(r.span,{style:{color:\"#616E88\"},children:\"        # q = [batch_size, len_q, d_model]\"})}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        d_k\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" d_v\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" n_head \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"d_k\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"d_v\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"n_head\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        sz_b\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" len_q\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" len_k\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" len_v \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" q\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"size\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"0\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"),\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" q\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"size\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"1\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"),\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" k\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"size\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"1\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"),\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" v\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"size\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"1\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        residual \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" q \"}),e(r.span,{style:{color:\"#616E88\"},children:\"# enc_input\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",e(r.span,{className:\"line\",children:e(r.span,{style:{color:\"#616E88\"},children:\"        # Separate different heads: [batch, len, n_head, d] (d_model / n_head = d_k)\"})}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        q \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"w_qs\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"q\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\").\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"view\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"sz_b\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" len_q\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" n_head\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" d_k\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        k \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"w_ks\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"k\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\").\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"view\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"sz_b\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" len_k\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" n_head\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" d_k\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        v \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"w_vs\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"v\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\").\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"view\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"sz_b\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" len_v\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" n_head\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" d_v\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",e(r.span,{className:\"line\",children:e(r.span,{style:{color:\"#616E88\"},children:\"        # Transpose for attention dot product: [batch, len, n_head, d]\"})}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        q\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" k\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" v \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" q\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"transpose\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"1\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 2\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"),\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" k\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"transpose\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"1\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 2\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"),\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" v\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"transpose\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"1\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 2\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        if\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" mask \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"is\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" not\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" None\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"            mask \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" mask\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"unsqueeze\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"1\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        q\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" attn \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"attention\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"q\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" k\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" v\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" mask\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"mask\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",e(r.span,{className:\"line\",children:e(r.span,{style:{color:\"#616E88\"},children:\"        # Transpose to move the head dimension back: b x lq x n x dv\"})}),\"\\n\",e(r.span,{className:\"line\",children:e(r.span,{style:{color:\"#616E88\"},children:\"        # Combine the last two dimensions to concatenate all the heads together: b x lq x (n*dv)\"})}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        q \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" q\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"transpose\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"1\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 2\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\").\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"contiguous\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"().\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"view\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"sz_b\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" len_q\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" -\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"1\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        q \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"dropout\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"fc\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"q\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"))\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",e(r.span,{className:\"line\",children:e(r.span,{style:{color:\"#616E88\"},children:\"        # LayerNorm(x + Sublayer(x))\"})}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        q \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"+=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" residual\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        q \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"layer_norm\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"q\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        return\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" q\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" attn\"})]})]})})}),\"\\n\",n(r.p,{children:[\"Wait, what is the layer function? And what does \",e(r.code,{children:\"fc\"}),\" mean? I recommend reading \",e(r.a,{href:\"https://thecho7.tistory.com/entry/PyTorch-nnLinear%EC%97%90-%EB%8C%80%ED%95%9C-%EC%A7%88%EB%AC%B8\",children:\"pytorch layer\"}),\" (this is a Korean blog), which provides a concise explanation.\"]}),\"\\n\",n(r.p,{children:[\"The Multi-Head Attention mechanism takes parameters \",e(r.code,{children:\"q\"}),\", \",e(r.code,{children:\"k\"}),\", and \",e(r.code,{children:\"v\"}),\". In practice, all of them are derived from the same input \",e(r.code,{children:\"x\"}),\". This is why the residual connection is applied to \",e(r.code,{children:\"q\"}),\".\"]}),\"\\n\",n(r.p,{children:[\"After performing Scaled Dot-Product attention and applying \",e(r.code,{children:\"transpose(1, 2).contiguous().view(sz_b, len_q, -1)\"}),\", \",e(r.code,{children:\"q\"}),\" has a shape of \",e(r.code,{children:\"[sz_batch, len_q, n_head * d_v]\"}),\". In the original architecture, \",e(r.code,{children:\"d_v = d_k\"}),\", but when \",e(r.code,{children:\"d_v != d_k\"}),\", it ensures that the output and input dimensions of the \",e(r.code,{children:\"fc\"}),\" layer remain consistent.\"]}),\"\\n\",e(l,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(r.code,{children:[n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"class\"}),e(r.span,{style:{color:\"#8FBCBB\"},children:\" PositionwiseFeedForward\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#8FBCBB\",fontWeight:\"bold\"},children:\"nn\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#8FBCBB\",fontWeight:\"bold\"},children:\"Module\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"    def\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" __init__\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" d_in\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" d_hid\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" dropout\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"0.1\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"        super\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"().\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"__init__\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"()\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"w_1 \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" nn\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"Linear\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"d_in\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" d_hid\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"w_2 \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" nn\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"Linear\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"d_hid\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" d_in\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"layer_norm \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" nn\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"LayerNorm\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"d_in\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" eps\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"1e-6\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"dropout \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" nn\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"Dropout\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"dropout\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"    def\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" forward\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" x\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        residual \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" x\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        x \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"w_2\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"F\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"relu\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"w_1\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"x\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")))\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        x \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"dropout\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"x\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        x \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"+=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" residual\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        x \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"layer_norm\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"x\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        return\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" x\"})]})]})})}),\"\\n\",e(r.p,{children:\"This is Feed Forward Network. It is a simple linear transformation followed by a ReLU activation function and a dropout layer.\"}),\"\\n\",e(l,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(r.code,{children:[n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"class\"}),e(r.span,{style:{color:\"#8FBCBB\"},children:\" EncoderLayer\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#8FBCBB\",fontWeight:\"bold\"},children:\"nn\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#8FBCBB\",fontWeight:\"bold\"},children:\"Module\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"    def\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" __init__\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" d_model\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" d_inner\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" n_head\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" d_k\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" d_v\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" dropout\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"0.1\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"        super\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"().\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"__init__\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"()\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"slf_attn \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" MultiHeadAttention\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"n_head\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" d_model\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" d_k\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" d_v\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" dropout\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"dropout\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"pos_ffn \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" PositionwiseFeedForward\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"d_model\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" d_inner\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" dropout\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"dropout\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"    def\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" forward\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" enc_input\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" slf_attn_mask\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=None\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        enc_output\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" enc_slf_attn \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"slf_attn\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"            enc_input\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" enc_input\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" enc_input\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" mask\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"slf_attn_mask\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        enc_output \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"pos_ffn\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"enc_output\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        return\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" enc_output\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" enc_slf_attn\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"class\"}),e(r.span,{style:{color:\"#8FBCBB\"},children:\" DecoderLayer\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#8FBCBB\",fontWeight:\"bold\"},children:\"nn\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#8FBCBB\",fontWeight:\"bold\"},children:\"Module\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"    def\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" __init__\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" d_model\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" d_inner\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" n_head\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" d_k\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" d_v\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" dropout\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"0.1\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"        super\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"().\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"__init__\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"()\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"slf_attn \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" MultiHeadAttention\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"n_head\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" d_model\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" d_k\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" d_v\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" dropout\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"dropout\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"enc_attn \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" MultiHeadAttention\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"n_head\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" d_model\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" d_k\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" d_v\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" dropout\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"dropout\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"pos_ffn \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" PositionwiseFeedForward\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"d_model\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" d_inner\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" dropout\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"dropout\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"    def\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" forward\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" dec_input\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" enc_output\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" self_attn_mask\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=None\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" dec_enc_attn_mask\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=None\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        dec_output\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" dec_slf_attn \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"slf_attn\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"            dec_input\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" dec_input\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" dec_input\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" mask\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"self_attn_mask\"})]}),\"\\n\",e(r.span,{className:\"line\",children:e(r.span,{style:{color:\"#ECEFF4\"},children:\"        )\"})}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        dec_output\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" dec_enc_attn \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"enc_attn\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"            dec_output\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" enc_output\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" enc_output\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" mask\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"dec_enc_attn_mask\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        dec_output \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"pos_ffn\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"dec_output\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        return\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" dec_output\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" dec_slf_attn\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" dec_enc_attn\"})]})]})})}),\"\\n\",n(r.p,{children:[\"In fact, the Encoder and Decoder are straightforward implementations of their respective layers. It's more an algorithmic problem - determining where to provide the input and how to obtain the output. Therefore, I'll skip the following code snippets. If you want to a deeper dive into the Transformer code, please refer to the \",e(r.a,{href:\"https://github.com/jadore801120/attention-is-all-you-need-pytorch\",children:\"scratch\"}),\".\"]}),\"\\n\",e(r.hr,{}),\"\\n\",e(r.p,{children:\"reference\"}),\"\\n\",n(r.ol,{children:[\"\\n\",n(r.li,{children:[\"Attention is all you need: \",e(r.a,{href:\"https://arxiv.org/abs/1706.03762\",children:\"https://arxiv.org/abs/1706.03762\"})]}),\"\\n\",n(r.li,{children:[\"transformer code: \",e(r.a,{href:\"https://github.com/jadore801120/attention-is-all-you-need-pytorch\",children:\"https://github.com/jadore801120/attention-is-all-you-need-pytorch\"})]}),\"\\n\"]}),\"\\n\",e(r.hr,{})]})}return{default:function(l={}){const{wrapper:n}=l.components||{};return n?e(n,{...l,children:e(_createMdxContent,{...l})}):_createMdxContent(l)}};",
    "permalink": "/development/attention-is-all-you-need"
  },
  {
    "title": "Next.js 앱 배포하기",
    "description": "Next.js와 Bun으로 만든 애플리케이션을 배포합니다. Vercel이 아닌 AWS의 EC2를 이용하고, nginx와 pm2를 통해 서버를 관리합니다.",
    "slug": "deploy-nextjs-app-with-bun-ec2-nginx-pm2",
    "publishDate": "2025-03-02",
    "thumbnailUrl": "/development/deployment-of-nextjs-with-bun-using-ec2-nginx-pm2/1.png",
    "content": "const{Fragment:n,jsx:e,jsxs:l}=arguments[0];function _createMdxContent(c){const r={a:\"a\",code:\"code\",h2:\"h2\",h3:\"h3\",hr:\"hr\",img:\"img\",li:\"li\",ol:\"ol\",p:\"p\",pre:\"pre\",span:\"span\",...c.components};return l(n,{children:[e(r.p,{children:\"드디어 자동 배포까지 구축했다! 🎉\"}),\"\\n\",e(r.p,{children:\"개인적인 프로젝트를 진행한다고 토이프로젝트에서 굵직굵직한 개발 요소를 건드리지 못했는데(이 자리를 빌어 인프라를 전부 책임져준 연우에게 감사를), 드디어 뭐가 뭔지 얼추 알 것 같다. 우선 적어도 Docker까지는 다뤄본 뒤 다시 프론트 공부를 할 계획.\"}),\"\\n\",e(r.p,{children:\"개발자로 커리어를 시작하겠다는 다짐을 하고 나니 한 결 마음이 가벼워졌다. 그리고 개발이 재미있어지기도 했고. 더 배워야겠다는 마음을 먹으니 완전히 또 다른 세계다. 열심히 배워봐야지.\"}),\"\\n\",e(r.p,{children:\"먹고 산다는 것에 대한 지난 날의 고민들은 학기 중에 글로 남길 계획!\"}),\"\\n\",e(r.hr,{}),\"\\n\",e(r.p,{children:\"Next.js로 작성한 앱을 AWS EC2로 배포하는 방법은 쉽게 찾아볼 수 있다.\\n문제는 대부분이 나처럼 공부하며 정리한 글이다보니 온전히 신뢰하기 어렵다는 점.\\nIAM 역할에 정책을 지정할 때 필요 없는 정책이 끼어있다든가, 혹은 yml 파일이나 nginx config 파일의 설정이 완전히 잘못 되있다던가 등등...\\n그래서 머리 깨져가며 배운 내용을 정리하며 최대한 그 이유들을 작성해보겠다.\"}),\"\\n\",e(r.h2,{children:\"1. EC2 인스턴스\"}),\"\\n\",e(r.p,{children:\"React를 배포할 땐 S3와 같은 정적 파일 호스팅 서비스만 있어도 충분하다.\\n빌드를 통해 만들어진 정적 HTML과 Javascript 파일을 클라이언트측에 건네면, 클라이언트 쪽에서 받은 데이터를 기반으로 렌더링하기 때문이다. 이를 Client Side Rendering(CSR)이라 한다.\"}),\"\\n\",e(r.p,{children:\"Next.js는 CSR 방식의 호스팅도 지원하지만 Server Side Rendering(SSR)도 제공한다.\\nSSR은 클라이언트의 요청에 따라 서버가 필요한 데이터를 가져오고, 이를 기반으로 렌더링한 뒤 클라이언트에게 전달한다.\\n이 외에도 백엔드 API 라우팅 기능 등 서버측에서 처리해야 할 기능들을 제공하기 위해 배포할 때 Node.js 런타임 환경이 필요하고,\\n이를 위해 서버를 돌려야 한다. (물론 React도 데이터 페칭을 위한 백엔드 API 서버는 필요로 한다.\\n빌드된 파일을 어떤 식으로 호스팅하느냐의 문제만 보면 React는 서버 없이도 가능하다는 이야기.)\"}),\"\\n\",e(r.p,{children:\"집에 있는 컴퓨터를 24시간 돌리며 서버 컴퓨터로 만들 게 아니라면 보통은 가상 머신을 빌려 서버로 이용한다.\\n이러한 서버를 대여해주는 서비스가 AWS의 EC2이다. 가상 머신 하나를 빌릴 때 그걸 우리는 '인스턴스'라 부른다.\"}),\"\\n\",e(r.p,{children:\"그러면 배포를 위해 우리의 서버를 만들어보자.\"}),\"\\n\",e(r.h3,{children:\"1-1) 인스턴스 생성\"}),\"\\n\",e(r.p,{children:\"AWS에 접속해 EC2 서비스에서 인스턴스 생성을 누른다.\"}),\"\\n\",e(r.p,{children:e(r.img,{src:\"/development/deployment-of-nextjs-with-bun-using-ec2-nginx-pm2/1.png\",alt:\"\"})}),\"\\n\",e(r.p,{children:\"우리가 빌릴 가상 서버의 운영체제와 필요한 각종 소프트웨어의 성능을 골라야 한다.\\nQuick Start로 운영체제는 Ubuntu, 그리고 이미지는 프리티어 사용이 가능한 아무거나 고르자.\"}),\"\\n\",e(r.p,{children:\"Ubuntu는 서버 환경에서 많이 쓰이는 Linux 배포판이다.\\n운영체제를 딥하게 파지 않는 이상 Ubuntu를 쓰는 게 무난하다. 정보도 많고 라이센스 비용도 없고.\"}),\"\\n\",l(r.p,{children:[e(r.img,{src:\"/development/deployment-of-nextjs-with-bun-using-ec2-nginx-pm2/2.png\",alt:\"\"}),\"\\n\",e(r.img,{src:\"/development/deployment-of-nextjs-with-bun-using-ec2-nginx-pm2/3.png\",alt:\"\"})]}),\"\\n\",e(r.p,{children:\"인스턴스에 접속하기 위한 키 페어를 생성하자. 나중에 생성된 키 파일을 가지고 인스턴스에 접속한다.\"}),\"\\n\",e(r.p,{children:e(r.img,{src:\"/development/deployment-of-nextjs-with-bun-using-ec2-nginx-pm2/4.png\",alt:\"\"})}),\"\\n\",e(r.p,{children:\"네트워크 설정은 SSH, HTTPS, HTTP 트래픽 전부 허용하자.\\n기본적으로 우리는 SSH 트래픽을 통해 인스턴스에 접속할 거고, 나중에 브라우저에서 HTTP 프로토콜을 통해 인스턴스로 요청을 보내면 인스턴스에서 실행 중인 웹 애플리케이션들이 웹 페이지를 브라우저에게 제공하게 된다.\\nHTTP나 HTTPS의 경우 요청을 보낼 수 있는 IP를 제한할 필요는 없지만, SSH의 경우 보안을 위해 특정 IP 주소만 허용하는 게 좋다. 하지만 나는 귀찮으니 그냥 열어놨다.\"}),\"\\n\",e(r.p,{children:\"이후 인스턴스를 생성한 뒤 우리의 서버를 세팅해보자.\"}),\"\\n\",e(r.p,{children:e(r.img,{src:\"/development/deployment-of-nextjs-with-bun-using-ec2-nginx-pm2/5.png\",alt:\"\"})}),\"\\n\",e(r.p,{children:\"인스턴스로 들어가 위쪽에 '연결' 버튼을 누르자.\"}),\"\\n\",e(r.p,{children:\"아래에 있는 예: ssh -i ... 명령어를 통해 인스턴스에 접속할 수 있다.\\n아까 생성한 키 파일이 있는 위치로 이동한 뒤 명령어를 실행하자.\"}),\"\\n\",e(r.p,{children:e(r.img,{src:\"/development/deployment-of-nextjs-with-bun-using-ec2-nginx-pm2/6.png\",alt:\"\"})}),\"\\n\",e(r.p,{children:\"짠. ubuntu로 접속했다.\"}),\"\\n\",e(r.hr,{}),\"\\n\",e(r.h3,{children:\"1-2) 인스턴스 세팅\"}),\"\\n\",e(r.p,{children:\"접속한 인스턴스에서 배포를 위한 세팅을 한다. 위 ubuntu에서 이어서 하면 된다.\"}),\"\\n\",e(n,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:l(r.code,{children:[l(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"sudo\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" apt\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" update\"})]}),\"\\n\",l(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"sudo\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" apt\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" upgrade\"})]})]})})}),\"\\n\",e(r.p,{children:\"apt는 패키지 관리 프로그램이다. 각 소프트웨어들의 최신 버전 정보를 update하고, 그 정보를 기반으로 upgrade한다.\"}),\"\\n\",e(n,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:e(r.code,{children:l(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"sudo\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" apt\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" install\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" nginx\"})]})})})}),\"\\n\",l(r.p,{children:[\"nginx 를 설치한다.nginx는 웹 서버 프로그램으로 클라이언트 요청에 따라 정적 파일을 보내주는 호스팅 역할을 한다.\\n이 외에도 다양한 기능과 역할을 수행하지만 여기서는 생략한다. 자세한 기능과 역사는 \",e(r.a,{href:\"https://www.youtube.com/watch?v=6FAwAXXj5N0\",children:\"nginx에 대한 영상\"}),\"을 참고하자!\"]}),\"\\n\",l(r.p,{children:[\"이번 프로젝트에서는 경험삼아 Bun을 사용했다. 대부분 npm을 사용하지만 여기에서는 Bun을 통해 세팅하는 과정을 소개한다.\\nnpm에 대한 정보가 필요하다면 \",e(r.a,{href:\"https://sollogging.tistory.com/91\",children:\"이 블로그\"}),\"를 참고하자!\"]}),\"\\n\",e(n,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:l(r.code,{children:[l(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"sudo\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" apt\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" install\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" unzip\"}),e(r.span,{style:{color:\"#616E88\"},children:\" # unzip 설치\"})]}),\"\\n\",l(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"curl\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" -fsSL\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" https://bun.sh/install\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" |\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" bash\"}),e(r.span,{style:{color:\"#616E88\"},children:\" # bun 설치\"})]})]})})}),\"\\n\",e(r.p,{children:\"Bun 설치에 필요한 unzip을 먼저 설치하고, 그 다음 Bun을 설치한다.\"}),\"\\n\",e(n,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:l(r.code,{children:[l(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"echo\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:'export PATH=\"$HOME/.bun/bin:$PATH\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" >>\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" ~/.bashrc\"})]}),\"\\n\",l(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"source\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" ~/.bashrc\"})]})]})})}),\"\\n\",e(r.p,{children:\"설치가 완료된 뒤 Bun의 실행 파일 경로를 환경 변수에 추가해준다(대부분 알아서 잘 되지만 혹시 모르니 한 번 더 수동으로 추가).\\n그리고 bun -v 명령어로 잘 설치되었는지 확인해보자.\"}),\"\\n\",e(r.p,{children:\"이후 GitHub 레포지토리에서 프로젝트를 가져온 뒤, 프로젝트의 루트 디렉토리로 이동한다.\"}),\"\\n\",e(n,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:l(r.code,{children:[l(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"bun\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" install\"})]}),\"\\n\",l(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"bun\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" run\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" build\"})]})]})})}),\"\\n\",e(r.p,{children:\"bun을 이용해 의존성을 설치하고 빌드까지 해준다.\"}),\"\\n\",e(r.p,{children:e(r.img,{src:\"/development/deployment-of-nextjs-with-bun-using-ec2-nginx-pm2/7.png\",alt:\"\"})}),\"\\n\",e(r.hr,{}),\"\\n\",e(r.h3,{children:\"1-3) nginx 세팅\"}),\"\\n\",e(r.p,{children:\"프로젝트가 깔린 경로는 /home/ubuntu/프로젝트 이름 일 것이다.\\n여기서 루트 디렉토리까지 이동한 다음, 설정 파일 경로로 접속하자.\"}),\"\\n\",e(n,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:e(r.code,{children:l(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"cd\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" /etc/nginx/sites-available\"})]})})})}),\"\\n\",e(r.p,{children:\"이 디렉토리는 nginx에서 각 웹사이트에 대한 서버 설정 파일을 저장하는 곳이다.\\n서버 설정을 한 뒤, /etc/nginx/sites-enabled 디렉토리에 심볼릭 링크(바로가기와 비슷한 개념)로 연결하면 된다.\"}),\"\\n\",e(r.p,{children:\"이미 존재하는 default 설정은 지정한 웹사이트가 아닌 다른 요청을 처리하는데 쓰인다.\\n웹사이트별로 설정이 다르므로 보통은 도메인 이름으로 해주면 된다.\\n나는 도메인 연결을 안 한 상태이니 레포지토리 이름인 waffle_rookie_review.conf 로 생성했다.\"}),\"\\n\",e(n,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:l(r.code,{children:[l(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"sudo\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" touch\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" waffle_rookie_review.conf\"})]}),\"\\n\",l(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"sudo\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" vim\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" waffle_rookie_review.conf\"})]})]})})}),\"\\n\",e(r.p,{children:\"waffle_rookie_review.conf\"}),\"\\n\",e(n,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:l(r.code,{children:[l(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"server\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" {\"})]}),\"\\n\",l(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"    listen\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 80\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),\"\\n\",l(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"    server_name\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" 퍼블릭\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" IPv4\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" 주소\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",l(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"    location\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" /\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" {\"})]}),\"\\n\",l(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"        proxy_pass\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" http://localhost:3000\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),\"\\n\",l(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"        proxy_http_version\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 1.1\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),\"\\n\",l(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"        proxy_set_header\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" Upgrade\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" $http_upgrade\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),\"\\n\",l(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"        proxy_set_header\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" Connection\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"upgrade\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),\"\\n\",l(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"        proxy_set_header\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" Host\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" $host\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),\"\\n\",l(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"        proxy_cache_bypass\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" $http_upgrade\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),\"\\n\",e(r.span,{className:\"line\",children:e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"    }\"})}),\"\\n\",e(r.span,{className:\"line\",children:e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"}\"})})]})})}),\"\\n\",e(n,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:e(r.code,{children:l(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"sudo\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" ln\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" -s\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" /etc/nginx/sites-available/waffle_rookie_review.conf\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" /etc/nginx/sites-enabled/\"})]})})})}),\"\\n\",e(r.p,{children:\"설정 후 심볼릭 링크까지 생성해주면 끝.\"}),\"\\n\",e(r.p,{children:\"설정의 의미는 다음과 같다.\"}),\"\\n\",l(r.p,{children:[e(r.code,{children:\"listen 80\"}),\" -> 포트 번호 80으로 들어오는 요청을 처리한다.\"]}),\"\\n\",l(r.p,{children:[e(r.code,{children:\"server_name\"}),\" -> 서버의 IP 주소\"]}),\"\\n\",l(r.p,{children:[\"포트 번호 80은 HTTP의 기본 포트다. 따라서 \",e(r.code,{children:\"http://<IPv4 주소>\"}),\" 로 요청을 보내면 이 서버 블록이 활성화된다.\"]}),\"\\n\",l(r.p,{children:[e(r.code,{children:\"location /\"}),\" -> '/' 경로(루트 경로)에 대한 요청을 처리한다.\"]}),\"\\n\",l(r.p,{children:[e(r.code,{children:\"proxy_pass http://localhost:3000\"}),\" -> \",e(r.code,{children:\"http://<IPv4 주소>/\"}),\" 요청을 Next.js 서버로 전달한다.\"]}),\"\\n\",e(r.p,{children:\"이 외에는 서버단에서 요청을 처리하는데 쓰이는 세부적인 설정들이다.\"}),\"\\n\",e(r.p,{children:\"설정 파일의 문법이 올바른지 테스트해보자.\"}),\"\\n\",e(n,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:e(r.code,{children:l(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"sudo\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" nginx\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" -t\"})]})})})}),\"\\n\",e(r.p,{children:\"다음과 같이 뜨면 성공이다.\"}),\"\\n\",e(r.p,{children:e(r.img,{src:\"/development/deployment-of-nextjs-with-bun-using-ec2-nginx-pm2/8.png\",alt:\"\"})}),\"\\n\",e(r.p,{children:\"설정 파일이 반영되도록 nginx를 재시작하자.\"}),\"\\n\",e(n,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:e(r.code,{children:l(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"sudo\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" systemctl\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" restart\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" nginx\"})]})})})}),\"\\n\",e(r.hr,{}),\"\\n\",e(r.h3,{children:\"1-4) pm2 세팅\"}),\"\\n\",e(r.p,{children:\"pm2(Process Manager 2)는 우리의 애플리케이션을 실행하고 관리해줄 프로그램이다.\\n앱이 종료되거나 문제가 발생하면 자동으로 재시작해준다.\"}),\"\\n\",e(n,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:l(r.code,{children:[l(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"bun\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" install\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" pm2\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" -g\"})]}),\"\\n\",l(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"pm2\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" start\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" bun\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" --name\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:' \"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"waffle_rookie_review\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" --\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" start\"})]})]})})}),\"\\n\",e(r.p,{children:\"라고 하면... node.js를 찾지 못했다고 뜨며 실행이 안 된다.\\n실행은 bun으로 하지만 pm2가 기본적으로 node.js 환경 위에서 돌아가나보다.\\nnode.js를 설치해주자.\"}),\"\\n\",e(n,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:l(r.code,{children:[l(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"curl\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" -o-\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.7/install.sh\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" |\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" bash\"})]}),\"\\n\",l(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"source\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" ~/.bashrc\"})]}),\"\\n\",l(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"nvm\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" install\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\" --lts\"})]})]})})}),\"\\n\",e(r.p,{children:\"그리고 다시 pm2 start bun ~~ 명령어를 실행해주면...\"}),\"\\n\",e(r.p,{children:e(r.img,{src:\"/development/deployment-of-nextjs-with-bun-using-ec2-nginx-pm2/9.png\",alt:\"\"})}),\"\\n\",e(r.p,{children:\"서버가 실행됐다!\"}),\"\\n\",l(r.p,{children:[\"그리고 \",e(r.code,{children:\"http://<Public IPv4 주소>\"}),\" 로 접속해보면...\"]}),\"\\n\",e(r.p,{children:e(r.img,{src:\"/development/deployment-of-nextjs-with-bun-using-ec2-nginx-pm2/10.png\",alt:\"\"})}),\"\\n\",e(r.p,{children:\"이렇게 배포는 끝!\"}),\"\\n\",e(r.hr,{}),\"\\n\",e(r.p,{children:\"이모저모\"}),\"\\n\",l(r.ol,{children:[\"\\n\",l(r.li,{children:[\"\\n\",e(r.p,{children:\"EC2 인스턴스에 지정된 퍼블릭 IPv4 주소는 인스턴스를 재부팅하면 새롭게 할당받는다.\\n그래서 고정적인 IPv4 주소를 얻으려면 Elastic IP를 할당받으면 된다.\"}),\"\\n\"]}),\"\\n\",l(r.li,{children:[\"\\n\",l(r.p,{children:[\"Bun 명령어로 실행은 했지만, 런타임 환경이 Bun인 걸 좀 더 확실하게 확인할 수 있을까?\\n인스턴스에서 명령어 \",e(r.code,{children:\"pm2 describe <app-name>\"}),\"을 실행하면 \",e(r.code,{children:\"script path: /home/ubuntu/.bun/bin/bun\"}),\" 으로 지정된 걸 볼 수 있다.\\n더 나아가 node.js version이 N/A로 현재 런타임 환경이 node.js 가 아님을 알 수 있다!\"]}),\"\\n\"]}),\"\\n\",l(r.li,{children:[\"\\n\",e(r.p,{children:\"vim editor를 처음 만났을 때 매우 당황스러웠다.\\n나가는 법을 몰라 터미널을 강제 종료했던 과거의 나... 이제야 CLI 기반으로 컴퓨터를 다루는 게 익숙해진 느낌이다.\"}),\"\\n\"]}),\"\\n\"]}),\"\\n\",e(r.hr,{})]})}return{default:function(n={}){const{wrapper:l}=n.components||{};return l?e(l,{...n,children:e(_createMdxContent,{...n})}):_createMdxContent(n)}};",
    "permalink": "/development/deploy-nextjs-app-with-bun-ec2-nginx-pm2"
  },
  {
    "title": "Huggingface LLM Course - Chapter1",
    "description": "Read huggingface docs and note down important points",
    "slug": "huggingface-1",
    "publishDate": "2025-04-14",
    "thumbnailUrl": "/development/huggingface-1/thum1.jpeg",
    "content": "const{Fragment:e,jsx:l,jsxs:n}=arguments[0];function _createMdxContent(r){const s={a:\"a\",blockquote:\"blockquote\",code:\"code\",h2:\"h2\",h3:\"h3\",hr:\"hr\",img:\"img\",li:\"li\",p:\"p\",pre:\"pre\",span:\"span\",table:\"table\",tbody:\"tbody\",td:\"td\",th:\"th\",thead:\"thead\",tr:\"tr\",ul:\"ul\",...r.components};return n(e,{children:[l(s.p,{children:l(s.img,{src:\"/development/huggingface-1/1.png\",alt:\"\"})}),\"\\n\",l(s.p,{children:\"I've been immersing myself in development literature, especially focused on ML. Here are the books I've read (I'm listing them in Korean since that's my native language :D):\"}),\"\\n\",n(s.ul,{children:[\"\\n\",l(s.li,{children:\"스트리트 코더 : 프로그래밍 세계에서 살아남기 위한 개발자 생존 가이드!\"}),\"\\n\",l(s.li,{children:\"그림으로 이해하는 서버 구조와 기술\"}),\"\\n\",l(s.li,{children:\"혼자 공부하는 컴퓨터 구조 + 운영체제\"}),\"\\n\",l(s.li,{children:\"파이썬 텍스트 마이닝 완벽 가이드 : 자연어 처리 기초부터 딥러닝 기반 BERT 모델까지\"}),\"\\n\",l(s.li,{children:\"파이토치 딥러닝 모델 AI 앱 개발 입문\"}),\"\\n\"]}),\"\\n\",l(s.p,{children:\"These books cover a wide range of topics, including fundamental CS knowldege, development conventions, traditional machine learning methods, and practical applications of deep learning models using PyTorch.\"}),\"\\n\",l(s.p,{children:\"I'm currently working to understand deep learning and its development process, though I recognize this is likely a lifelong journey😂. After going through the materials mentioned above, I've now moved on to the Hugging Face documentation.\"}),\"\\n\",l(s.p,{children:\"I'm genuinely impressed by the documentation's content. It's incredibly user-friendly and helpful for beginners like me who need to start with the basics such as how to use libraries and understanding the numerous methods available. Thanks to the authors' thoughtful approach, I plan to write down the key points in this post.\"}),\"\\n\",l(s.p,{children:\"Huggingface gives us a high-level operation of the model so that we can easily use them. However, There is no an exact details about 'real' implementation at the code level. So, after finishing the huggingface docs I'm going to read pytorch tutorial and '밑바닥부터 시작하는 딥러닝' series.\"}),\"\\n\",l(s.hr,{}),\"\\n\",l(s.h3,{children:\"What is NLP?\"}),\"\\n\",n(s.blockquote,{children:[\"\\n\",l(s.p,{children:\"NLP is a field of linguistics and machine learning focused on understanding everything related to human language. The aim of NLP tasks is not only to understand single words individually, but to be able to understand the context of those words.\"}),\"\\n\"]}),\"\\n\",l(s.h3,{children:\"pipeline\"}),\"\\n\",l(s.p,{children:\"The pipeline() function executes high-level API tasks for NLP.\"}),\"\\n\",l(e,{children:l(s.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(s.code,{children:[n(s.span,{className:\"line\",children:[l(s.span,{style:{color:\"#81A1C1\"},children:\"from\"}),l(s.span,{style:{color:\"#D8DEE9FF\"},children:\" transformers \"}),l(s.span,{style:{color:\"#81A1C1\"},children:\"import\"}),l(s.span,{style:{color:\"#D8DEE9FF\"},children:\" pipeline\"})]}),\"\\n\",l(s.span,{className:\"line\"}),\"\\n\",n(s.span,{className:\"line\",children:[l(s.span,{style:{color:\"#D8DEE9FF\"},children:\"classifier \"}),l(s.span,{style:{color:\"#81A1C1\"},children:\"=\"}),l(s.span,{style:{color:\"#88C0D0\"},children:\" pipeline\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:'\"'}),l(s.span,{style:{color:\"#A3BE8C\"},children:\"sentiment-analysis\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:'\"'}),l(s.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(s.span,{className:\"line\",children:[l(s.span,{style:{color:\"#88C0D0\"},children:\"classifier\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:'\"'}),l(s.span,{style:{color:\"#A3BE8C\"},children:\"I've been waiting for a HuggingFace course my whole life.\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:'\"'}),l(s.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",l(s.span,{className:\"line\"}),\"\\n\",n(s.span,{className:\"line\",children:[l(s.span,{style:{color:\"#81A1C1\"},children:\">>>\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\" [{\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),l(s.span,{style:{color:\"#A3BE8C\"},children:\"label\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\":\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),l(s.span,{style:{color:\"#A3BE8C\"},children:\"POSITIVE\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\",\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),l(s.span,{style:{color:\"#A3BE8C\"},children:\"score\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\":\"}),l(s.span,{style:{color:\"#B48EAD\"},children:\" 0.9598047137260437\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\"}]\"})]})]})})}),\"\\n\",l(e,{children:l(s.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(s.code,{children:[n(s.span,{className:\"line\",children:[l(s.span,{style:{color:\"#81A1C1\"},children:\"from\"}),l(s.span,{style:{color:\"#D8DEE9FF\"},children:\" transformers \"}),l(s.span,{style:{color:\"#81A1C1\"},children:\"import\"}),l(s.span,{style:{color:\"#D8DEE9FF\"},children:\" pipeline\"})]}),\"\\n\",l(s.span,{className:\"line\"}),\"\\n\",n(s.span,{className:\"line\",children:[l(s.span,{style:{color:\"#D8DEE9FF\"},children:\"generator \"}),l(s.span,{style:{color:\"#81A1C1\"},children:\"=\"}),l(s.span,{style:{color:\"#88C0D0\"},children:\" pipeline\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:'\"'}),l(s.span,{style:{color:\"#A3BE8C\"},children:\"text-generation\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:'\"'}),l(s.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(s.span,{className:\"line\",children:[l(s.span,{style:{color:\"#88C0D0\"},children:\"generator\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:'\"'}),l(s.span,{style:{color:\"#A3BE8C\"},children:\"In this course, we will teach you how to\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:'\"'}),l(s.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",l(s.span,{className:\"line\"}),\"\\n\",n(s.span,{className:\"line\",children:[l(s.span,{style:{color:\"#81A1C1\"},children:\">>>\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\"[{\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),l(s.span,{style:{color:\"#A3BE8C\"},children:\"generated_text\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\":\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),l(s.span,{style:{color:\"#A3BE8C\"},children:\"In this course, we will teach you how to understand and use \"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\"'\"})]}),\"\\n\",n(s.span,{className:\"line\",children:[l(s.span,{style:{color:\"#ECEFF4\"},children:\"                    '\"}),l(s.span,{style:{color:\"#A3BE8C\"},children:\"data flow and data interchange when handling user data. We \"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\"'\"})]}),\"\\n\",n(s.span,{className:\"line\",children:[l(s.span,{style:{color:\"#ECEFF4\"},children:\"                    '\"}),l(s.span,{style:{color:\"#A3BE8C\"},children:\"will be working with one or more of the most commonly used \"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\"'\"})]}),\"\\n\",n(s.span,{className:\"line\",children:[l(s.span,{style:{color:\"#ECEFF4\"},children:\"                    '\"}),l(s.span,{style:{color:\"#A3BE8C\"},children:\"data flows — data flows of various types, as seen by the \"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\"'\"})]}),\"\\n\",n(s.span,{className:\"line\",children:[l(s.span,{style:{color:\"#ECEFF4\"},children:\"                    '\"}),l(s.span,{style:{color:\"#A3BE8C\"},children:\"HTTP\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\"}]\"})]})]})})}),\"\\n\",l(s.p,{children:\"For my learning purposes, the pipeline approach isn't quite suitable. I'm just familiarizing myself with low-level libraries rather than using it for my actual task.\"}),\"\\n\",l(s.h3,{children:\"Bias and Limitations\"}),\"\\n\",l(s.p,{children:\"One thing that's particularly impressive about this...\"}),\"\\n\",l(e,{children:l(s.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(s.code,{children:[n(s.span,{className:\"line\",children:[l(s.span,{style:{color:\"#81A1C1\"},children:\"from\"}),l(s.span,{style:{color:\"#D8DEE9FF\"},children:\" transformers \"}),l(s.span,{style:{color:\"#81A1C1\"},children:\"import\"}),l(s.span,{style:{color:\"#D8DEE9FF\"},children:\" pipeline\"})]}),\"\\n\",l(s.span,{className:\"line\"}),\"\\n\",n(s.span,{className:\"line\",children:[l(s.span,{style:{color:\"#D8DEE9FF\"},children:\"unmasker \"}),l(s.span,{style:{color:\"#81A1C1\"},children:\"=\"}),l(s.span,{style:{color:\"#88C0D0\"},children:\" pipeline\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:'\"'}),l(s.span,{style:{color:\"#A3BE8C\"},children:\"fill-mask\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:'\"'}),l(s.span,{style:{color:\"#ECEFF4\"},children:\",\"}),l(s.span,{style:{color:\"#D8DEE9\"},children:\" model\"}),l(s.span,{style:{color:\"#81A1C1\"},children:\"=\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:'\"'}),l(s.span,{style:{color:\"#A3BE8C\"},children:\"bert-base-uncased\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:'\"'}),l(s.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(s.span,{className:\"line\",children:[l(s.span,{style:{color:\"#D8DEE9FF\"},children:\"result \"}),l(s.span,{style:{color:\"#81A1C1\"},children:\"=\"}),l(s.span,{style:{color:\"#88C0D0\"},children:\" unmasker\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:'\"'}),l(s.span,{style:{color:\"#A3BE8C\"},children:\"This man works as a [MASK].\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:'\"'}),l(s.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(s.span,{className:\"line\",children:[l(s.span,{style:{color:\"#88C0D0\"},children:\"print\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\"([\"}),l(s.span,{style:{color:\"#D8DEE9FF\"},children:\"r\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:'\"'}),l(s.span,{style:{color:\"#A3BE8C\"},children:\"token_str\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:'\"'}),l(s.span,{style:{color:\"#ECEFF4\"},children:\"]\"}),l(s.span,{style:{color:\"#81A1C1\"},children:\" for\"}),l(s.span,{style:{color:\"#D8DEE9FF\"},children:\" r \"}),l(s.span,{style:{color:\"#81A1C1\"},children:\"in\"}),l(s.span,{style:{color:\"#D8DEE9FF\"},children:\" result\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\"])\"})]}),\"\\n\",l(s.span,{className:\"line\"}),\"\\n\",n(s.span,{className:\"line\",children:[l(s.span,{style:{color:\"#D8DEE9FF\"},children:\"result \"}),l(s.span,{style:{color:\"#81A1C1\"},children:\"=\"}),l(s.span,{style:{color:\"#88C0D0\"},children:\" unmasker\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:'\"'}),l(s.span,{style:{color:\"#A3BE8C\"},children:\"This woman works as a [MASK].\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:'\"'}),l(s.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(s.span,{className:\"line\",children:[l(s.span,{style:{color:\"#88C0D0\"},children:\"print\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\"([\"}),l(s.span,{style:{color:\"#D8DEE9FF\"},children:\"r\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:'\"'}),l(s.span,{style:{color:\"#A3BE8C\"},children:\"token_str\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:'\"'}),l(s.span,{style:{color:\"#ECEFF4\"},children:\"]\"}),l(s.span,{style:{color:\"#81A1C1\"},children:\" for\"}),l(s.span,{style:{color:\"#D8DEE9FF\"},children:\" r \"}),l(s.span,{style:{color:\"#81A1C1\"},children:\"in\"}),l(s.span,{style:{color:\"#D8DEE9FF\"},children:\" result\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\"])\"})]}),\"\\n\",l(s.span,{className:\"line\"}),\"\\n\",n(s.span,{className:\"line\",children:[l(s.span,{style:{color:\"#81A1C1\"},children:\">>>\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),l(s.span,{style:{color:\"#A3BE8C\"},children:\"lawyer\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\",\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),l(s.span,{style:{color:\"#A3BE8C\"},children:\"carpenter\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\",\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),l(s.span,{style:{color:\"#A3BE8C\"},children:\"doctor\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\",\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),l(s.span,{style:{color:\"#A3BE8C\"},children:\"waiter\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\",\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),l(s.span,{style:{color:\"#A3BE8C\"},children:\"mechanic\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\"]\"})]}),\"\\n\",n(s.span,{className:\"line\",children:[l(s.span,{style:{color:\"#ECEFF4\"},children:\"   [\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),l(s.span,{style:{color:\"#A3BE8C\"},children:\"nurse\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\",\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),l(s.span,{style:{color:\"#A3BE8C\"},children:\"waitress\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\",\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),l(s.span,{style:{color:\"#A3BE8C\"},children:\"teacher\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\",\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),l(s.span,{style:{color:\"#A3BE8C\"},children:\"maid\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\",\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),l(s.span,{style:{color:\"#A3BE8C\"},children:\"prostitute\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),l(s.span,{style:{color:\"#ECEFF4\"},children:\"]\"})]})]})})}),\"\\n\",l(s.p,{children:\"Oh... this is a serious problem. as huggingface tells us:\"}),\"\\n\",n(s.blockquote,{children:[\"\\n\",l(s.p,{children:\"When you use these tools, you therefore need to keep in the back of your mind that the original model you are using could very easily generate sexist, racist, or homophobic content. Fine-tuning the model on your data won’t make this intrinsic bias disappear.\"}),\"\\n\"]}),\"\\n\",l(s.h3,{children:\"Brief Summary of Models\"}),\"\\n\",n(s.table,{children:[l(s.thead,{children:n(s.tr,{children:[l(s.th,{children:\"Models\"}),l(s.th,{children:\"Examples\"}),l(s.th,{children:\"Tasks\"})]})}),n(s.tbody,{children:[n(s.tr,{children:[l(s.td,{children:\"Encoder\"}),l(s.td,{children:\"ALBERT, BERT, DistilBERT, ELECTRA, RoBERTa\"}),l(s.td,{children:\"Sentence classification, named entity recognition, extractive question answering\"})]}),n(s.tr,{children:[l(s.td,{children:\"Decoder\"}),l(s.td,{children:\"CTRL, GPT, GPT-2, Transformer XL\"}),l(s.td,{children:\"Text generation\"})]}),n(s.tr,{children:[l(s.td,{children:\"Encoder-Decoder\"}),l(s.td,{children:\"BART, T5, Marian, mBART\"}),l(s.td,{children:\"Summarization, translation, generative question answering\"})]})]})]}),\"\\n\",l(s.p,{children:\"Chapter 1 is complete! 🎉\"}),\"\\n\",l(s.hr,{}),\"\\n\",l(s.h2,{children:\"Reference\"}),\"\\n\",n(s.p,{children:[\"Huggingface LLM Course: \",l(s.a,{href:\"https://huggingface.co/learn/llm-course/chapter1/1\",children:\"https://huggingface.co/learn/llm-course/chapter1/1\"})]})]})}return{default:function(e={}){const{wrapper:n}=e.components||{};return n?l(n,{...e,children:l(_createMdxContent,{...e})}):_createMdxContent(e)}};",
    "permalink": "/development/huggingface-1"
  },
  {
    "title": "Huggingface LLM Course - Chapter2 & Chapter3",
    "description": "Read huggingface docs. What is a tokenizer and fine-tuning? Train a model!",
    "slug": "huggingface-2",
    "publishDate": "2025-04-15",
    "thumbnailUrl": "/development/huggingface-2/thum2.jpeg",
    "content": "const{Fragment:l,jsx:e,jsxs:n}=arguments[0];function _createMdxContent(s){const r={a:\"a\",blockquote:\"blockquote\",code:\"code\",h2:\"h2\",h3:\"h3\",hr:\"hr\",img:\"img\",li:\"li\",ol:\"ol\",p:\"p\",pre:\"pre\",span:\"span\",ul:\"ul\",...s.components};return n(l,{children:[e(r.h3,{children:\"Behind the pipeline:\"}),\"\\n\",e(r.p,{children:e(r.img,{src:\"/development/huggingface-2/2.png\",alt:\"\"})}),\"\\n\",n(r.blockquote,{children:[\"\\n\",e(r.p,{children:\"The vector output by the Transformer module is usually large. It generally has three dimensions:\"}),\"\\n\"]}),\"\\n\",n(r.ul,{children:[\"\\n\",e(r.li,{children:\"Batch size: The number of sequences processed at a time.\"}),\"\\n\",e(r.li,{children:\"Sequence length: The length of the numerical representation of the sequence.\"}),\"\\n\",e(r.li,{children:\"Hidden size: The vector dimension of each model input.\"}),\"\\n\"]}),\"\\n\",e(r.p,{children:\"The hidden size can be very large. 768 is common for smaller models, and in larger models this can reach 3072 or more.\"}),\"\\n\",e(r.h3,{children:\"Model heads\"}),\"\\n\",e(r.p,{children:\"The model heads take the high-dimensional vector of hidden states as input and project them onto a different dimension. They are usually composed of one or a few linear layers.\"}),\"\\n\",e(r.h3,{children:\"Model\"}),\"\\n\",e(l,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(r.code,{children:[n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"from\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" transformers \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"import\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" BertConfig\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" BertModel\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"config \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" BertConfig\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"()\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"model \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" BertModel\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"config\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]})]})})}),\"\\n\",e(r.p,{children:\"This is to load the BERT's architecture with random values of weights. If I use it, it will output gibberish. It needs to be trained first but it takes a lot of time and resources. For preventing this, we can use a pre-trained model:\"}),\"\\n\",e(l,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(r.code,{children:[n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"from\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" transformers \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"import\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" BertModel\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"model \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" BertModel\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"from_pretrained\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"bert-base-cased\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]})]})})}),\"\\n\",e(r.h3,{children:\"Tokenization\"}),\"\\n\",e(l,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(r.code,{children:[n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"from\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" transformers \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"import\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" AutoTokenizer\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"tokenizer \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" AutoTokenizer\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"from_pretrained\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"bert-base-cased\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"sequence \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:' \"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"Using a Transformer network is simple\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"tokens \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" tokenizer\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"tokenize\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"sequence\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"print\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"tokens\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\">>>\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" [\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"Using\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"a\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"transform\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"##er\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"network\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"is\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"simple\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"]\"})]})]})})}),\"\\n\",e(r.p,{children:\"From tokens to input IDs\"}),\"\\n\",e(l,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(r.code,{children:[n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"ids \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" tokenizer\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"convert_tokens_to_ids\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"tokens\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"print\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"ids\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\">>>\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"7993\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 170\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 11303\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 1200\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 2443\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 1110\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 3014\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"]\"})]})]})})}),\"\\n\",e(r.p,{children:\"Decoding\"}),\"\\n\",e(l,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(r.code,{children:[n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"decoded_string \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" tokenizer\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"decode\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"([\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"7993\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 170\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 11303\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 1200\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 2443\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 1110\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 3014\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"])\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"print\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"decoded_string\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\">>>\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"Using a Transformer network is simple\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"})]})]})})}),\"\\n\",e(r.p,{children:\"Send to Model\"}),\"\\n\",e(l,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(r.code,{children:[n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"import\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" torch\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"from\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" transformers \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"import\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" AutoTokenizer\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" AutoModelForSequenceClassification\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"checkpoint \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:' \"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"distilbert-base-uncased-finetuned-sst-2-english\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"tokenizer \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" AutoTokenizer\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"from_pretrained\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"checkpoint\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"model \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" AutoModelForSequenceClassification\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"from_pretrained\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"checkpoint\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"sequence \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:' \"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"I've been waiting for a HuggingFace course my whole life.\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"tokens \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" tokenizer\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"tokenize\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"sequence\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"ids \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" tokenizer\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"convert_tokens_to_ids\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"tokens\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"input_ids \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" torch\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"tensor\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"ids\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\",children:e(r.span,{style:{color:\"#616E88\"},children:\"# This line will fail.\"})}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"model\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"input_ids\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\">>>\"}),e(r.span,{style:{color:\"#8FBCBB\"},children:\" IndexError\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" Dimension out of \"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"range\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" (\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"expected to be \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"in\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" range\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" of \"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"-\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"1\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 0\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"],\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" but got \"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"1\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]})]})})}),\"\\n\",e(r.p,{children:\"Why did this fail?\"}),\"\\n\",n(r.blockquote,{children:[\"\\n\",e(r.p,{children:\"Transformers models expect multiple sentences by default.\"}),\"\\n\"]}),\"\\n\",e(r.p,{children:\"So, this is the right way to send it to the model:\"}),\"\\n\",e(l,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(r.code,{children:[n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"input_ids \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" torch\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"tensor\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"([\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"ids\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"])\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"model\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"input_ids\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]})]})})}),\"\\n\",e(r.p,{children:\"I will handle Datasets library later. Therefore, this post doesn't cover it detailedly.\"}),\"\\n\",e(r.h3,{children:\"Fine-tuning a model with the Trainer API:\"}),\"\\n\",e(l,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(r.code,{children:[n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"from\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" transformers \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"import\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" Trainer\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"trainer \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" Trainer\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"    model\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"    training_args\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9\"},children:\"    train_dataset\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"tokenized_datasets\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"train\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"],\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9\"},children:\"    eval_dataset\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"tokenized_datasets\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"validation\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"],\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9\"},children:\"    data_collator\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"data_collator\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9\"},children:\"    tokenizer\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"tokenizer\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),\"\\n\",e(r.span,{className:\"line\",children:e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"trainer\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"train\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"()\"})]})]})})}),\"\\n\",e(r.p,{children:\"Then Trainer will start the fine-tuning and report the training loss every 500 steps.\"}),\"\\n\",e(l,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(r.code,{children:[n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"predictions \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" trainer\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"predict\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"tokenized_datasets\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"validation\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"])\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"print\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"predictions\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"predictions\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"shape\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" predictions\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"label_ids\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"shape\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\">>>\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" (\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"408\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 2\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" (\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"408\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",)\"})]})]})})}),\"\\n\",e(l,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(r.code,{children:[n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"import\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" numpy \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"as\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" np\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"import\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" evaluate\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"preds \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" np\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"argmax\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"predictions\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"predictions\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" axis\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=-\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"1\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"metric \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" evaluate\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"load\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"glue\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:' \"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"mrpc\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"metric\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"compute\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\"predictions\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"preds\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" references\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"predictions\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"label_ids\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\">>>\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" {\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"accuracy\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 0.8578431372549019\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"f1\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 0.8996539792387542\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]})]})})}),\"\\n\",e(r.p,{children:\"But same reason as pipeline, I won't use this high-level APIs.\"}),\"\\n\",e(r.h3,{children:\"A full training\"}),\"\\n\",e(l,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(r.code,{children:[n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"from\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" datasets \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"import\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" load_dataset\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"from\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" transformers \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"import\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" AutoTokenizer\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" DataCollatorWithPadding\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"raw_datasets \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" load_dataset\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"glue\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:' \"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"mrpc\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"checkpoint \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:' \"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"bert-base-uncased\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"tokenizer \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" AutoTokenizer\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"from_pretrained\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"checkpoint\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"def\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" tokenize_function\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\"example\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"    return\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" tokenizer\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"example\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"sentence1\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"],\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" example\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"sentence2\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"],\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" truncation\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=True\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"tokenized_datasets \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" raw_datasets\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"map\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"tokenize_function\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" batched\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=True\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"data_collator \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" DataCollatorWithPadding\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\"tokenizer\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"tokenizer\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"tokenized_datasets \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" tokenized_datasets\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"remove_columns\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"([\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"sentence1\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:' \"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"sentence2\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:' \"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"idx\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"])\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"tokenized_datasets \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" tokenized_datasets\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"rename_column\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"label\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:' \"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"labels\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"}),e(r.span,{style:{color:\"#616E88\"},children:\" # model expects the argument to be named 'labels'\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"tokenized_datasets\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"set_format\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"torch\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"}),e(r.span,{style:{color:\"#616E88\"},children:\" # therefore, they return PyTorch tensors instead of lists\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"tokenized_datasets\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"train\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"].\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"column_names\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\">>>\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" [\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"attention_mask\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:' \"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"input_ids\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:' \"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"labels\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:' \"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"token_type_ids\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"]\"})]})]})})}),\"\\n\",e(r.p,{children:\"define a dataloaders:\"}),\"\\n\",e(l,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(r.code,{children:[n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"from\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" torch\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"utils\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"data \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"import\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" DataLoader\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"train_dataloader \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" DataLoader\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"    tokenized_datasets\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"train\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"],\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" shuffle\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=True\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" batch_size\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"8\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" collate_fn\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"data_collator\"})]}),\"\\n\",e(r.span,{className:\"line\",children:e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"eval_dataloader \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" DataLoader\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"    tokenized_datasets\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"validation\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"],\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" batch_size\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"8\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" collate_fn\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"data_collator\"})]}),\"\\n\",e(r.span,{className:\"line\",children:e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})})]})})}),\"\\n\",e(r.p,{children:\"To quickly check there is no mistake in the data processing:\"}),\"\\n\",e(l,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(r.code,{children:[n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"for\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" batch \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"in\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" train_dataloader\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"})]}),\"\\n\",e(r.span,{className:\"line\",children:e(r.span,{style:{color:\"#81A1C1\"},children:\"    break\"})}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#ECEFF4\"},children:\"{\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"k\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" v\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"shape \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"for\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" k\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" v \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"in\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" batch\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"items\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"()}\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\">>>\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"{\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"attention_mask\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" torch\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"Size\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"([\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"8\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 65\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"]),\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#ECEFF4\"},children:\"    '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"input_ids\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" torch\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"Size\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"([\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"8\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 65\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"]),\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#ECEFF4\"},children:\"    '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"labels\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" torch\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"Size\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"([\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"8\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"]),\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#ECEFF4\"},children:\"    '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"token_type_ids\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" torch\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"Size\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"([\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"8\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 65\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"])}\"})]})]})})}),\"\\n\",e(r.p,{children:\"After loading a pre-trained model:\"}),\"\\n\",e(l,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(r.code,{children:[n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"outputs \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" model\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"**\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"batch\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"print\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"output\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"loss\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" outputs\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"logits\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"shape\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\">>>\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" tensor\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"0.5441\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" grad_fn\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=<\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"NllLossBackward\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\">\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" torch\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"Size\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"([\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"8\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 2\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"])\"})]})]})})}),\"\\n\",e(r.p,{children:\"Optimizer:\"}),\"\\n\",e(l,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(r.code,{children:[n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"from\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" transformers \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"import\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" AdamW\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"optimizer \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" AdamW\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"model\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"parameters\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(),\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" lr\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"5e-5\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]})]})})}),\"\\n\",e(r.p,{children:\"Learning rate scheduler:\"}),\"\\n\",e(l,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(r.code,{children:[n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"from\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" transformers \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"import\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" get_scheduler\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"num_epochs \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 3\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"num_training_steps \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" num_epochs \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"*\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" len\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"train_dataloader\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"lr_scheduler \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" get_scheduler\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#ECEFF4\"},children:'    \"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"linear\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9\"},children:\"    optimizer\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"optimizer\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9\"},children:\"    num_warmup_steps\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"0\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9\"},children:\"    num_training_steps\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"num_training_steps\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),\"\\n\",e(r.span,{className:\"line\",children:e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})})]})})}),\"\\n\",e(r.p,{children:\"Training roop:\"}),\"\\n\",e(l,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(r.code,{children:[n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"device \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" torch\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"device\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"cuda\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" if\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" torch\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"cuda\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"is_available\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"()\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" else\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" torch\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"device\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"cpu\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"model\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"to\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"device\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"progress_bar \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" tqdm\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"range\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"num_training_steps\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"))\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"model\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"train\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"()\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"for\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" epoch \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"in\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" range\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"num_epochs\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"    for\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" batch \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"in\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" train_dataloader\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        batch \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" {\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"k\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" v\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"to\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"device\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" for\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" k\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" v \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"in\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" batch\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"items\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"()}\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        outputs \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" model\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"**\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"batch\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        loss \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" outputs\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"loss\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        loss\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"backward\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"()\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        optimizer\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"step\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"()\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        lr_scheduler\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"step\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"()\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        optimizer\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"zero_grad\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"()\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        progress_bar\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"update\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"1\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]})]})})}),\"\\n\",e(r.p,{children:\"The training flow is as follows:\"}),\"\\n\",n(r.ol,{children:[\"\\n\",e(r.li,{children:\"Calculate the loss\"}),\"\\n\",e(r.li,{children:\"Calculate the gradients during backpropagation\"}),\"\\n\",e(r.li,{children:\"Update the model parameters using the optimizer\"}),\"\\n\",e(r.li,{children:\"Tune the learning rate\"}),\"\\n\",e(r.li,{children:\"Initialize gradients to zero\"}),\"\\n\"]}),\"\\n\",e(r.p,{children:\"With the Accelerate library, which enables more efficient and faster training performance, we need to make some minor revisions to the code.\"}),\"\\n\",e(l,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(r.code,{children:[n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"accelerate \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" Accelerator\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"()\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",e(r.span,{className:\"line\",children:e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"...\"})}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"train_dataloader\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" eval_dataloader\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" model\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" optimizer \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" accelerator\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"prepare\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"    train_dataloader\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" eval_dataloader\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" model\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" optimizer\"})]}),\"\\n\",e(r.span,{className:\"line\",children:e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})}),\"\\n\",e(r.span,{className:\"line\",children:e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"...\"})}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"model\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"train\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"()\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"for\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" epoch \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"in\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" range\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"num_epochs\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"    for\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" batch \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"in\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" train_dataloader\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        outputs \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" model\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"**\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"batch\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        loss \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" outputs\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"loss\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        accelerator\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"backward\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"loss\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        optimizer\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"step\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"()\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        lr_scheduler\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"step\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"()\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        optimizer\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"zero_grad\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"()\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        progress_bar\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"update\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"1\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]})]})})}),\"\\n\",n(r.p,{children:[e(r.code,{children:\"accelerate.prepare()\"}),\" wraps these objects in the appropriate container to ensure your distributed training functions properly as intended.\"]}),\"\\n\",e(r.hr,{}),\"\\n\",e(r.h2,{children:\"Reference\"}),\"\\n\",n(r.p,{children:[e(r.a,{href:\"https://huggingface.co/learn/llm-course/chapter2/1?fw=pt\",children:\"https://huggingface.co/learn/llm-course/chapter2/1?fw=pt\"}),\"\\n\",e(r.a,{href:\"https://huggingface.co/learn/llm-course/chapter3/1?fw=pt\",children:\"https://huggingface.co/learn/llm-course/chapter3/1?fw=pt\"})]})]})}return{default:function(l={}){const{wrapper:n}=l.components||{};return n?e(n,{...l,children:e(_createMdxContent,{...l})}):_createMdxContent(l)}};",
    "permalink": "/development/huggingface-2"
  },
  {
    "title": "Huggingface LLM Course - Chapter5 (Datasets Library)",
    "description": "Read huggingface docs. Deep dive into datasets library!",
    "slug": "huggingface-3",
    "publishDate": "2025-04-16",
    "thumbnailUrl": "/development/huggingface-3/thum3.jpeg",
    "content": "const{Fragment:l,jsx:e,jsxs:n}=arguments[0];function _createMdxContent(s){const r={a:\"a\",blockquote:\"blockquote\",code:\"code\",h2:\"h2\",h3:\"h3\",hr:\"hr\",img:\"img\",li:\"li\",p:\"p\",pre:\"pre\",span:\"span\",table:\"table\",tbody:\"tbody\",td:\"td\",th:\"th\",thead:\"thead\",tr:\"tr\",ul:\"ul\",...s.components};return n(l,{children:[e(r.p,{children:\"In chapter 5, docs handles datasets library. Key questions is following:\"}),\"\\n\",n(r.ul,{children:[\"\\n\",e(r.li,{children:\"What do you do when your dataset is not on the Hub?\"}),\"\\n\",e(r.li,{children:\"How can you slice and dice a dataset? (And what if you really need to use Pandas?)\"}),\"\\n\",e(r.li,{children:\"What do you do when your dataset is huge and will melt your laptop’s RAM?\"}),\"\\n\",e(r.li,{children:\"What the heck are “memory mapping” and Apache Arrow?\"}),\"\\n\",e(r.li,{children:\"How can you create your own dataset and push it to the Hub?\"}),\"\\n\"]}),\"\\n\",e(r.h3,{children:\"Common data formats:\"}),\"\\n\",n(r.table,{children:[e(r.thead,{children:n(r.tr,{children:[e(r.th,{children:\"Data format\"}),e(r.th,{children:\"Loading script\"}),e(r.th,{children:\"Example\"})]})}),n(r.tbody,{children:[n(r.tr,{children:[e(r.td,{children:\"CSV & TSV\"}),e(r.td,{children:\"csv\"}),e(r.td,{children:'load_dataset(\"csv\", data_files=\"my_file.csv\")'})]}),n(r.tr,{children:[e(r.td,{children:\"Text files\"}),e(r.td,{children:\"text\"}),e(r.td,{children:'load_dataset(\"text\", data_files=\"my_file.txt\")'})]}),n(r.tr,{children:[e(r.td,{children:\"JSON & JSON Lines\"}),e(r.td,{children:\"json\"}),e(r.td,{children:'load_dataset(\"json\", data_files=\"my_file.jsonl\")'})]}),n(r.tr,{children:[e(r.td,{children:\"Pickled DataFrames\"}),e(r.td,{children:\"pandas\"}),e(r.td,{children:'load_dataset(\"pandas\", data_files=\"my_dataframe.pkl\")'})]})]})]}),\"\\n\",e(r.h3,{children:\"Load Datasets\"}),\"\\n\",e(l,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(r.code,{children:[n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"from\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" datasets \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"import\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" load_dataset\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"data_files \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" {\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"train\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:' \"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"SQuAD_it-train.json\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:' \"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"test\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:' \"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"SQuAD_it-test.json\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"squad_it_dataset \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" load_dataset\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"json\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" data_files\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"data_files\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" field\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"data\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]})]})})}),\"\\n\",e(r.p,{children:\"Or it is possible to put a raw string to data_files parameter.\"}),\"\\n\",e(r.h3,{children:\"Slice and dice\"}),\"\\n\",n(r.blockquote,{children:[\"\\n\",e(r.p,{children:\"A good practice when doing any sort of data analysis is to grab a small random sample to get a quick feel for the type of data you’re working with. In 🤗 Datasets, we can create a random sample by chaining the Dataset.shuffle() and Dataset.select() functions together:\"}),\"\\n\"]}),\"\\n\",e(l,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(r.code,{children:[n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"drug_sample \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" drug_dataset\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"train\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"].\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"shuffle\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\"seed\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"42\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\").\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"select\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"range\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"1000\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"))\"})]}),\"\\n\",e(r.span,{className:\"line\",children:e(r.span,{style:{color:\"#616E88\"},children:\"# Peek at the first few examples\"})}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"drug_sample\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"[:\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"3\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"]\"})]})]})})}),\"\\n\",e(r.p,{children:\"Shuffling and selecting small samples is quite a good practice!\"}),\"\\n\",n(r.p,{children:[e(r.code,{children:\"drug_dataset.unique('drugName')\"}),\" is a function to find the number of unique drug names. We can pass any column names as a parameter.\"]}),\"\\n\",e(l,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(r.code,{children:[n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"def\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" lowercase_condition\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\"example\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"    return\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" {\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"condition\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" example\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"condition\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"].\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"lower\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"()}\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"drug_dataset\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"map\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"lowercase_condition\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\">>>\"}),e(r.span,{style:{color:\"#8FBCBB\"},children:\" AttributeError\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"NoneType\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" object\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" has no attribute \"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"lower\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"})]})]})})}),\"\\n\",n(r.blockquote,{children:[\"\\n\",n(r.p,{children:[\"We can infer that some of the entires in the \",e(r.code,{children:\"condition\"}),\" column are \",e(r.code,{children:\"None\"}),\", which cannot be lowercased as they're not strings. Let's drop these rows using Dataset.filter(), which works in a similar way to \",e(r.code,{children:\"Dataset.map()\"}),\" and expects a function that receives a single example of the dataset.\"]}),\"\\n\"]}),\"\\n\",e(l,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:e(r.code,{children:n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"drug_dataset \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" drug_dataset\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"filter\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"lambda\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" x\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" x\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"condition\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"]\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" is\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" not\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" None\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]})})})}),\"\\n\",n(r.p,{children:[e(r.code,{children:\"filter\"}),\" and \",e(r.code,{children:\"map\"}),\" method are similar to Javascript's. Filter removes falsey elements and only keeps truthy elements.\\nBut what exactly is an element to which a method is applied?\"]}),\"\\n\",e(r.p,{children:\"For a single dataset, the method executes a task on each row. For a dataset dictionary, the method iterates through each split and performs a task on each row within that split.\"}),\"\\n\",e(l,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(r.code,{children:[n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"def\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" compute_review_length\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\"example\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"    return\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" {\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"review_length\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" len\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"example\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"review\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"].\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"split\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"())}\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"drug_dataset \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" drug_dataset\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"map\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"compute_review_length\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\",children:e(r.span,{style:{color:\"#616E88\"},children:\"# Inspect the first training example\"})}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"drug_dataset\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"train\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"][\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"0\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"]\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\">>>\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" {\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"patient_id\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 206461\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#ECEFF4\"},children:\"     '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"drugName\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"Valsartan\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#ECEFF4\"},children:\"     '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"condition\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"left ventricular dysfunction\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#ECEFF4\"},children:\"     '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"review\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:'\"It has no side effect, I take it in combination of Bystolic 5 Mg and Fish Oil\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#ECEFF4\"},children:\"     '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"rating\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 9.0\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#ECEFF4\"},children:\"     '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"date\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"May 20, 2012\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#ECEFF4\"},children:\"     '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"usefulCount\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 27\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#ECEFF4\"},children:\"     '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"review_length\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 17\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]})]})})}),\"\\n\",e(l,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(r.code,{children:[n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"drug_dataset \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" drug_dataset\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"filter\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"lambda\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" x\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" x\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"review_length\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"]\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" >\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 30\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"print\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"drug_dataset\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"num_rows\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\">>>\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"{\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"train\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 138514\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"test\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 46108\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]})]})})}),\"\\n\",e(r.h3,{children:\"The map() method’s superpowers\"}),\"\\n\",n(r.blockquote,{children:[\"\\n\",e(r.p,{children:\"The Dataset.map() method takes a batched argument that, if set to True, causes it to send a batch of examples to the map function at once (the batch size is configurable but defaults to 1,000).\"}),\"\\n\"]}),\"\\n\",e(r.p,{children:e(r.img,{src:\"/development/huggingface-3/1.png\",alt:\"\"})}),\"\\n\",e(r.p,{children:\"Wow, a false batch takes 5 times longer.\"}),\"\\n\",e(r.p,{children:\"Tokenizer also can process a batch.\"}),\"\\n\",e(l,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(r.code,{children:[n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"from\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" transformers \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"import\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" AutoTokenizer\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"tokenizer \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" AutoTokenizer\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"from_pretrained\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"bert-base-cased\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"def\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" tokenize_function\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\"examples\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"    return\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" tokenizer\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"examples\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"review\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"],\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" truncation\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=True\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]})]})})}),\"\\n\",e(r.h3,{children:\"Pandas\"}),\"\\n\",e(l,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:e(r.code,{children:n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"drug_dataset\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"set_format\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"pandas\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]})})})}),\"\\n\",e(r.h3,{children:\"Creating a validation set\"}),\"\\n\",n(r.blockquote,{children:[\"\\n\",e(r.p,{children:\"🤗 Datasets provides a Dataset.train_test_split() function that is based on the famous functionality from scikit-learn. Let’s use it to split our training set into train and validation splits (we set the seed argument for reproducibility):\"}),\"\\n\"]}),\"\\n\",e(l,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(r.code,{children:[n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"drug_dataset_clean \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" drug_dataset\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"train\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"].\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"train_test_split\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\"train_size\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"0.8\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" seed\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"42\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\",children:e(r.span,{style:{color:\"#616E88\"},children:'# Rename the default \"test\" split to \"validation\"'})}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"drug_dataset_clean\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"validation\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"]\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" =\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" drug_dataset_clean\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"pop\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"test\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\",children:e(r.span,{style:{color:\"#616E88\"},children:'# Add the \"test\" set to our `DatasetDict`'})}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"drug_dataset_clean\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"test\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"]\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" =\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" drug_dataset\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"test\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"]\"})]}),\"\\n\",e(r.span,{className:\"line\",children:e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"drug_dataset_clean\"})}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\">>>\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" DatasetDict\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"({\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        train\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" Dataset\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"({\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"            features\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" [\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"patient_id\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"drugName\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"condition\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"review\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"rating\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"date\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"usefulCount\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"review_length\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"review_clean\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"],\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"            num_rows\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 110811\"})]}),\"\\n\",e(r.span,{className:\"line\",children:e(r.span,{style:{color:\"#ECEFF4\"},children:\"        })\"})}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        validation\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" Dataset\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"({\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"            features\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" [\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"patient_id\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"drugName\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"condition\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"review\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"rating\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"date\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"usefulCount\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"review_length\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"review_clean\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"],\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"            num_rows\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 27703\"})]}),\"\\n\",e(r.span,{className:\"line\",children:e(r.span,{style:{color:\"#ECEFF4\"},children:\"        })\"})}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        test\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" Dataset\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"({\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"            features\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" [\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"patient_id\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"drugName\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"condition\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"review\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"rating\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"date\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"usefulCount\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"review_length\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"review_clean\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"],\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"            num_rows\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 46108\"})]}),\"\\n\",e(r.span,{className:\"line\",children:e(r.span,{style:{color:\"#ECEFF4\"},children:\"        })\"})}),\"\\n\",e(r.span,{className:\"line\",children:e(r.span,{style:{color:\"#ECEFF4\"},children:\"    })\"})})]})})}),\"\\n\",n(r.p,{children:[e(r.code,{children:\"pop('key')\"}),\" removes and returns the value associated with the specified key from the dictionary.\"]}),\"\\n\",e(r.h3,{children:\"Saving a dataset\"}),\"\\n\",n(r.table,{children:[e(r.thead,{children:n(r.tr,{children:[e(r.th,{children:\"Data format\"}),e(r.th,{children:\"Function\"})]})}),n(r.tbody,{children:[n(r.tr,{children:[e(r.td,{children:\"Arrow\"}),e(r.td,{children:\"Dataset.save_to_disk()\"})]}),n(r.tr,{children:[e(r.td,{children:\"CSV\"}),e(r.td,{children:\"Dataset.to_csv()\"})]}),n(r.tr,{children:[e(r.td,{children:\"JSON\"}),e(r.td,{children:\"Dataset.to_json()\"})]})]})]}),\"\\n\",e(r.h3,{children:\"Dealing with huge data\"}),\"\\n\",n(r.blockquote,{children:[\"\\n\",e(r.p,{children:\"the WebText corpus used to pretrain GPT-2 consists of over 8 million documents and 40 GB of text — loading this into your laptop’s RAM is likely to give it a heart attack!\\nFortunately, 🤗 Datasets has been designed to overcome these limitations. It frees you from memory management problems by treating datasets as memory-mapped files, and from hard drive limits by streaming the entries in a corpus.\"}),\"\\n\"]}),\"\\n\",n(r.blockquote,{children:[\"\\n\",e(r.p,{children:\"So how does 🤗 Datasets solve this memory management problem? 🤗 Datasets treats each dataset as a memory-mapped file, which provides a mapping between RAM and filesystem storage that allows the library to access and operate on elements of the dataset without needing to fully load it into memory.\"}),\"\\n\"]}),\"\\n\",e(r.h3,{children:\"Semantic search with FAISS\"}),\"\\n\",e(r.p,{children:\"There's a library called senetence-transformers that is dedicated to creating embeddings.\"}),\"\\n\",e(r.p,{children:\"Following an example from the documentation, we're going to implement asymmetric semantic search, which is characterized by typically short queries (like a questions or keywords), while the target documents are longer paragraphs or passages containing the answer.\"}),\"\\n\",e(l,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(r.code,{children:[n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"from\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" transformers \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"import\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" AutoTokenizer\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" AutoModel\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"model_ckpt \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:' \"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"sentence-transformers/multi-qa-mpnet-base-dot-v1\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"tokenizer \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" AutoTokenizer\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"from_pretrained\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"model_ckpt\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"model \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" AutoModel\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"from_pretrained\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"model_ckpt\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]})]})})}),\"\\n\",e(l,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(r.code,{children:[n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"import\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" torch\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"device \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" torch\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"device\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"cuda\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"model\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"to\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"device\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]})]})})}),\"\\n\",e(l,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(r.code,{children:[n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"def\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" cls_pooling\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\"model_output\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"    return\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" model_output\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"last_hidden_state\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"[:,\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 0\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"]\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"def\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" get_embeddings\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\"text_list\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"    encoded_input \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" tokenizer\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        text_list\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" padding\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=True\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" truncation\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=True\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" return_tensors\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"pt\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),\"\\n\",e(r.span,{className:\"line\",children:e(r.span,{style:{color:\"#ECEFF4\"},children:\"    )\"})}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"    encoded_input \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" {\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"k\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" v\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"to\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"device\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" for\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" k\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" v \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"in\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" encoded_input\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"items\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"()}\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"    model_output \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" model\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"**\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"encoded_input\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"    return\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" cls_pooling\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"model_output\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]})]})})}),\"\\n\",e(l,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(r.code,{children:[n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"embeddings_dataset \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" comments_dataset\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"map\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"    lambda\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" x\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" {\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"embeddings\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" get_embeddings\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"x\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"text\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"]).\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"detach\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"().\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"cpu\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"().\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"numpy\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"()[\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"0\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"]}\"})]}),\"\\n\",e(r.span,{className:\"line\",children:e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})})]})})}),\"\\n\",e(r.p,{children:\"After embedding, let's use FAISS (short for Facebook AI Similarity Search). FAISS is a library that provides efficient algorithms to quickly search and cluster embedding vectors.\"}),\"\\n\",e(l,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(r.code,{children:[n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"embeddings_dataset\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"add_faiss_index\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\"column\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"embeddings\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"question \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:' \"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"How can I load a dataset offline?\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"question_embedding \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" get_embeddings\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"([\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"question\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"]).\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"cpu\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"().\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"detach\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"().\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"numpy\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"()\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"question_embedding\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"shape\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"scores\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" samples \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" embeddings_dataset\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"get_nearest_examples\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#ECEFF4\"},children:'    \"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"embeddings\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" question_embedding\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" k\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"5\"})]}),\"\\n\",e(r.span,{className:\"line\",children:e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})})]})})}),\"\\n\",e(r.p,{children:\"sorting by score:\"}),\"\\n\",e(l,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(r.code,{children:[n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"import\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" pandas \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"as\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" pd\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"samples_df \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" pd\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"DataFrame\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"from_dict\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"samples\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"samples_df\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"scores\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"]\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" =\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" scores\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"samples_df\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"sort_values\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"scores\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" ascending\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=False\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" inplace\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=True\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]})]})})}),\"\\n\",e(l,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(r.code,{children:[n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"for\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" _\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" row \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"in\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" samples_df\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"iterrows\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"():\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"    print\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"f\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:'\"COMMENT: '}),e(r.span,{style:{color:\"#EBCB8B\"},children:\"{\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"row\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"comments\"}),e(r.span,{style:{color:\"#EBCB8B\"},children:\"}\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"    print\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"f\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:'\"SCORE: '}),e(r.span,{style:{color:\"#EBCB8B\"},children:\"{\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"row\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"scores\"}),e(r.span,{style:{color:\"#EBCB8B\"},children:\"}\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"    print\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"f\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:'\"TITLE: '}),e(r.span,{style:{color:\"#EBCB8B\"},children:\"{\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"row\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"title\"}),e(r.span,{style:{color:\"#EBCB8B\"},children:\"}\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"    print\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"f\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:'\"URL: '}),e(r.span,{style:{color:\"#EBCB8B\"},children:\"{\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"row\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"html_url\"}),e(r.span,{style:{color:\"#EBCB8B\"},children:\"}\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"    print\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"=\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#81A1C1\"},children:\" *\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 50\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"    print\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"()\"})]})]})})}),\"\\n\",e(r.hr,{}),\"\\n\",e(r.h2,{children:\"Reference\"}),\"\\n\",e(r.p,{children:e(r.a,{href:\"https://huggingface.co/learn/llm-course/chapter5/1?fw=pt\",children:\"https://huggingface.co/learn/llm-course/chapter5/1?fw=pt\"})})]})}return{default:function(l={}){const{wrapper:n}=l.components||{};return n?e(n,{...l,children:e(_createMdxContent,{...l})}):_createMdxContent(l)}};",
    "permalink": "/development/huggingface-3"
  },
  {
    "title": "Huggingface LLM Course - Chapter7 (Classical NLP tasks)",
    "description": "Read huggingface docs. This time, let's cover to know classical NLP tasks.",
    "slug": "huggingface-4",
    "publishDate": "2025-04-24",
    "thumbnailUrl": "/development/huggingface-1/thum4.jpeg",
    "content": "const{Fragment:l,jsx:e,jsxs:n}=arguments[0];function _createMdxContent(s){const r={a:\"a\",blockquote:\"blockquote\",code:\"code\",h2:\"h2\",h3:\"h3\",hr:\"hr\",li:\"li\",p:\"p\",pre:\"pre\",span:\"span\",ul:\"ul\",...s.components};return n(l,{children:[e(r.p,{children:\"Each section of this chapter is independent. The sections are following:\"}),\"\\n\",n(r.ul,{children:[\"\\n\",e(r.li,{children:\"Token classification\"}),\"\\n\",e(r.li,{children:\"Masked language modeling (like BERT)\"}),\"\\n\",e(r.li,{children:\"Summarization\"}),\"\\n\",e(r.li,{children:\"Translation\"}),\"\\n\",e(r.li,{children:\"Causal language modeling pretraining (like GPT-2)\"}),\"\\n\",e(r.li,{children:\"Question answering\"}),\"\\n\"]}),\"\\n\",e(r.p,{children:\"it is good chance to know an information about each task!\"}),\"\\n\",e(r.p,{children:\"In the introduction, there is short sentence about Trainer API:\"}),\"\\n\",n(r.blockquote,{children:[\"\\n\",e(r.p,{children:\"the Trainer API is great for fine-tuning or training your model without worrying about what’s going on behind the scenes, while the training loop with Accelerate will let you customize any part you want more easily.\"}),\"\\n\"]}),\"\\n\",e(r.h3,{children:\"Token classification\"}),\"\\n\",e(r.p,{children:'Token classification encompasses any problem that can be formulated as \"attributing a label to each token in a sentence\", such as:'}),\"\\n\",n(r.ul,{children:[\"\\n\",e(r.li,{children:\"Named entity recognition (NER): Find the entities (such as persons, locations or organizations) in a sentence.\"}),\"\\n\",e(r.li,{children:\"Part-of-speech tagging (POS): Mark each word in a sentence as corresponding to a particular part of speech (such as noun, verb, adjective, etc.)\"}),\"\\n\",e(r.li,{children:\"Chunking\"}),\"\\n\"]}),\"\\n\",e(l,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(r.code,{children:[n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"from\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" datasets \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"import\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" load_dataset\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"raw_datasets \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" load_dataset\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"conll2003\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\",children:e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"raw_datasets\"})}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\">>>\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" DatasetDict\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"({\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        train\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" Dataset\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"({\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"            features\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" [\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"chunk_tags\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"id\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"ner_tags\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"pos_tags\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"tokens\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"],\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"            num_rows\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 14041\"})]}),\"\\n\",e(r.span,{className:\"line\",children:e(r.span,{style:{color:\"#ECEFF4\"},children:\"        })\"})}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        validation\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" Dataset\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"({\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"            features\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" [\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"chunk_tags\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"id\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"ner_tags\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"pos_tags\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"tokens\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"],\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"            num_rows\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 3250\"})]}),\"\\n\",e(r.span,{className:\"line\",children:e(r.span,{style:{color:\"#ECEFF4\"},children:\"        })\"})}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        test\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" Dataset\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"({\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"            features\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" [\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"chunk_tags\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"id\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"ner_tags\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"pos_tags\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"tokens\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"],\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"            num_rows\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 3453\"})]}),\"\\n\",e(r.span,{className:\"line\",children:e(r.span,{style:{color:\"#ECEFF4\"},children:\"        })\"})}),\"\\n\",e(r.span,{className:\"line\",children:e(r.span,{style:{color:\"#ECEFF4\"},children:\"    })\"})})]})})}),\"\\n\",e(r.p,{children:\"Let's have a look at the first element of the training set:\"}),\"\\n\",e(l,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(r.code,{children:[n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"raw_datasets\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"train\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"][\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"0\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"][\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"tokens\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"]\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\">>>\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" [\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"EU\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"rejects\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"German\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"call\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"to\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"boycott\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"British\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"lamb\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\".\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"]\"})]})]})})}),\"\\n\",e(l,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(r.code,{children:[n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"raw_datasets\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"train\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"][\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"0\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"][\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"ner_tags\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"]\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\">>>\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" [\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"3\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 0\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 7\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 0\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 0\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 0\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 7\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 0\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 0\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"]\"})]})]})})}),\"\\n\",e(r.p,{children:\"what are these numbers?\"}),\"\\n\",e(l,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(r.code,{children:[n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"ner_feature \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" raw_datasets\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"train\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"].\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"features\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"ner_tags\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"]\"})]}),\"\\n\",e(r.span,{className:\"line\",children:e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"ner_feature\"})}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\">>>\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" Sequence\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\"feature\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"ClassLabel\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\"num_classes\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"9\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" names\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"O\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"B-PER\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"I-PER\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"B-ORG\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"I-ORG\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"B-LOC\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"I-LOC\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"B-MISC\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"I-MISC\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"],\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" names_file\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=None\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" id\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=None\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"),\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" length\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=-\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"1\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" id\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=None\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]})]})})}),\"\\n\",e(r.p,{children:\"They are classes.\"}),\"\\n\",n(r.blockquote,{children:[\"\\n\",e(r.p,{children:\"We already saw these labels when digging into the token-classification pipeline in Chapter 6, but for a quick refresher:\"}),\"\\n\",n(r.ul,{children:[\"\\n\",e(r.li,{children:\"O means the word doesn’t correspond to any entity.\"}),\"\\n\",e(r.li,{children:\"B-PER/I-PER means the word corresponds to the beginning of/is inside a person entity.\"}),\"\\n\",e(r.li,{children:\"B-ORG/I-ORG means the word corresponds to the beginning of/is inside an organization entity.\"}),\"\\n\",e(r.li,{children:\"B-LOC/I-LOC means the word corresponds to the beginning of/is inside a location entity.\"}),\"\\n\",e(r.li,{children:\"B-MISC/I-MISC means the word corresponds to the beginning of/is inside a miscellaneous entity.\"}),\"\\n\"]}),\"\\n\"]}),\"\\n\",e(r.p,{children:\"Check them more visible output:\"}),\"\\n\",e(l,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(r.code,{children:[n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"words \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" raw_datasets\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"train\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"][\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"0\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"][\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"tokens\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"]\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"labels \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" raw_datasets\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"train\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"][\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"0\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"][\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"ner_tags\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:'\"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"]\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"line1 \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:' \"\"'})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"line2 \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:' \"\"'})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"for\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" word\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" label \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"in\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" zip\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"words\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" labels\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"    full_label \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" label_names\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"label\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"]\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"    max_length \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" max\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"len\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"word\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"),\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" len\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"full_label\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"))\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"    line1 \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"+=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" word \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"+\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:' \"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:' \"'}),e(r.span,{style:{color:\"#81A1C1\"},children:\" *\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" (\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"max_length \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"-\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" len\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"word\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" +\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 1\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"    line2 \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"+=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" full_label \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"+\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:' \"'}),e(r.span,{style:{color:\"#ECEFF4\"},children:' \"'}),e(r.span,{style:{color:\"#81A1C1\"},children:\" *\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" (\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"max_length \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"-\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" len\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"full_label\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" +\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 1\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"print\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"line1\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"print\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"line2\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\">>>\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"EU    rejects German call to boycott British lamb .\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#ECEFF4\"},children:\"    '\"}),e(r.span,{style:{color:\"#A3BE8C\"},children:\"B-ORG O       B-MISC O    O  O       B-MISC  O    O\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"'\"})]})]})})}),\"\\n\",e(r.p,{children:\"The following content is all related to the training and evaluation of Tokenizers, and since it's more of a guide on how to use the Huggingface library, it will be omitted.\"}),\"\\n\",e(r.hr,{}),\"\\n\",e(r.h2,{children:\"Reference\"}),\"\\n\",e(r.p,{children:e(r.a,{href:\"https://huggingface.co/learn/llm-course/chapter6/1?fw=pt\",children:\"https://huggingface.co/learn/llm-course/chapter6/1?fw=pt\"})})]})}return{default:function(l={}){const{wrapper:n}=l.components||{};return n?e(n,{...l,children:e(_createMdxContent,{...l})}):_createMdxContent(l)}};",
    "permalink": "/development/huggingface-4"
  },
  {
    "title": "Reading papers - MT-DNN, MASS, UNILM, XLNet, RoBERTa, ALBERT,",
    "description": "reading reading~",
    "slug": "reading-papers",
    "publishDate": "2025-04-27",
    "thumbnailUrl": "/development/reading-papers-1/thum.jpeg",
    "content": "const{Fragment:e,jsx:n,jsxs:t}=arguments[0];function _createMdxContent(r){const i={a:\"a\",blockquote:\"blockquote\",hr:\"hr\",img:\"img\",p:\"p\",...r.components};return t(e,{children:[n(i.p,{children:\"During my previous studies, I examined research papers on various language models, including seq2seq, Transformer, and BERT (though I didn't write about BERT). My objective is gaining knowledge in the LLM field and also have an assignment requiring me to create a video presentation explaining the concepts I've learned in class to my peers. Previous posts are the result of the assignment. Therefore, this post will be too. :D\"}),\"\\n\",n(i.p,{children:\"This post covers MT-DNN, MASS, UNILM, XLNet, RoBERTa and ALBERT. I won't describe the details of each model, but rather focus on the fundamental concepts (due to my schedule :p).\"}),\"\\n\",n(i.hr,{}),\"\\n\",t(i.p,{children:[n(i.a,{href:\"https://arxiv.org/abs/1901.11504\",children:\"MT-DNN\"}),\" (Multi-Task Deep Neural Networks for natural language understanding)\"]}),\"\\n\",n(i.p,{children:n(i.img,{src:\"/development/reading-papers-1/1.png\",alt:\"\"})}),\"\\n\",n(i.p,{children:\"In abstract, there is a key purpose of MT-DNN.\"}),\"\\n\",t(i.blockquote,{children:[\"\\n\",n(i.p,{children:\"MT-DNN not only leverages large amounts of cross-task data, but also benefits from a regularization effect that leads to more general representations to help adapt to new tasks and domains.\"}),\"\\n\"]}),\"\\n\",n(i.p,{children:\"And in the introduction, they explain the motivation behind MT-DNN, which is the basic principle of transfer learning.\"}),\"\\n\",t(i.blockquote,{children:[\"\\n\",n(i.p,{children:\"Multi-Task Learning (MTL) is inspired by human learning activities where people often apply the knowledge learned from previous tasks to help learn a new task (Caruana, 1997; Zhang and Yang, 2017). For example, it is easier for a person who knows how to ski to learn skating than the one who does not.\"}),\"\\n\"]}),\"\\n\",n(i.p,{children:\"They propose a diverse range of tasks to train the model:\"}),\"\\n\",n(i.p,{children:n(i.img,{src:\"/development/reading-papers-1/2.png\",alt:\"\"})}),\"\\n\",n(i.p,{children:\"However, I think the intricate details of these tasks are not essential for my current understanding. At this point, I'm focused on grasping the fundamental concepts rather than delving too deeply into the specifics.\"}),\"\\n\",t(i.p,{children:[\"The benchmark is following:\\n\",n(i.img,{src:\"/development/reading-papers-1/3.png\",alt:\"\"})]}),\"\\n\",n(i.hr,{}),\"\\n\",t(i.p,{children:[n(i.a,{href:\"https://arxiv.org/abs/1905.02450\",children:\"MASS\"}),\" (MAsked Sequence to Sequence learning)\"]}),\"\\n\",n(i.p,{children:\"In abstract:\"}),\"\\n\",t(i.blockquote,{children:[\"\\n\",n(i.p,{children:\"its encoder takes a sentence with randomly masked fragment (several consecutive tokens) as input, and its decoder tries to predict this masked fragment. In this way, MASS can jointly train the encoder and decoder to develop the capability of representation extraction and language modeling. In this paper, inspired by BERT, we propose a novel objective for pre-training: MAsked Sequence to Sequence learning (MASS) for language generation.\"}),\"\\n\"]}),\"\\n\",t(i.p,{children:[\"What does that mean? See the figure below:\\n\",n(i.img,{src:\"/development/reading-papers-1/4.png\",alt:\"\"})]}),\"\\n\",n(i.p,{children:\"MASS masks continuous sequences of tokens within the source sentence. Subsequently, the decoder predicts these masked tokens, generating the output seqeuntially, one token at a time.\"}),\"\\n\",t(i.p,{children:[\"This provides a detailed mathematical formulation representing the loss function derived from the log-likelihood function:\\n\",n(i.img,{src:\"/development/reading-papers-1/5.png\",alt:\"\"})]}),\"\\n\",t(i.p,{children:[\"Researchers assert that, under specific constraint condtions, MASS can effectively function as both BERT and GPT architectures.\\n\",n(i.img,{src:\"/development/reading-papers-1/6.png\",alt:\"\"})]}),\"\\n\",n(i.p,{children:\"However, MASS is the encoder-decoder framework to generate tokens and there is a cross-attention between the encoder and decoder. It is the fundamental difference from BERT (which is a single encoder architecture) and GPT (which is a single decoder architecture).\"}),\"\\n\",n(i.hr,{}),\"\\n\",t(i.p,{children:[n(i.a,{href:\"https://arxiv.org/abs/1905.03197\",children:\"UNILM\"}),\" (UNIfied Language Model pre-training for natural language understanding and generation)\"]}),\"\\n\",n(i.p,{children:n(i.img,{src:\"/development/reading-papers-1/7.png\",alt:\"\"})}),\"\\n\",n(i.p,{children:\"The authors describe UNILM's foundational architecture as a 'multi-layer Transformer network'.\"}),\"\\n\",n(i.p,{children:\"However, upon examination of Figure 1, it appears identical to the encoder layer of a standard Transformer. (In fact, its architecture is precisely that of BERT Large.)\"}),\"\\n\",n(i.p,{children:n(i.img,{src:\"/development/reading-papers-1/8.png\",alt:\"\"})}),\"\\n\",n(i.p,{children:\"They implement a strategy that emulates language modeling techniques through the strategic manipulation of self-attention masks.\"}),\"\\n\",t(i.blockquote,{children:[\"\\n\",n(i.p,{children:\"Specifically, within one training batch, 1/3 of the time we use the bidirectional LM objective, 1/3 of the time we employ the sequence-to-sequence LM objective, and both left-to-right and right-to-left LM objectives are sampled with rate of 1/6.\"}),\"\\n\"]}),\"\\n\",n(i.hr,{}),\"\\n\",t(i.p,{children:[n(i.a,{href:\"https://arxiv.org/abs/1906.08237\",children:\"XLNet\"}),\" (XLNet: Generalized Autoregressive Pretraining for Language Understanding)\"]}),\"\\n\",n(i.p,{children:n(i.img,{src:\"/development/reading-papers-1/9.png\",alt:\"\"})}),\"\\n\",n(i.p,{children:\"The name 'XLNet does not appear explicitly in the paper's title. However, the authors clarify the origin of this designation in the abstract.\"}),\"\\n\",t(i.blockquote,{children:[\"\\n\",n(i.p,{children:\"XLNet integrates ideas from Transformer-XL, the state-of-the-art autoregressive model, into pretraining.\"}),\"\\n\"]}),\"\\n\",n(i.p,{children:\"The nomenclature derives from their inspiration by Transformer-XL\"}),\"\\n\",n(i.p,{children:\"What are the distinctive characteristics of this approach?\"}),\"\\n\",t(i.blockquote,{children:[\"\\n\",n(i.p,{children:\"we propose XLNet, a generalized autoregressive pretraining method that (1) enables learning bidirectional contexts by maximizing the expected likelihood over all permutations of the factorization order and (2) overcomes the limitations of BERT thanks to its autoregressive formulation.\"}),\"\\n\"]}),\"\\n\",n(i.p,{children:\"They propose an enhanced pre-training methodology that leverages permutations of token order. How exactly does this mechanism function?\"}),\"\\n\",n(i.p,{children:n(i.img,{src:\"/development/reading-papers-1/10.png\",alt:\"\"})}),\"\\n\",n(i.p,{children:\"(a) shows the normal self-attention mechanism, and (b) shows the permutation self-attention what the researchers claim.\"}),\"\\n\",n(i.p,{children:\"For instance, consider the sentence 'New York is a city' which would be masked as '[Mask] [Mask] is a city' in traditional pre-training. BERT's approach involves predicting 'New' and 'York' independently, calculating p(New | is a city) and p(York | is a city) separately. In contrast, XLNet employs a sequential prediction method: first calculating p(New | is a city), then p(York | New, is a city), thereby effectively capturing the relationship between 'New' and 'York'.\\\"\"}),\"\\n\",n(i.p,{children:n(i.img,{src:\"/development/reading-papers-1/12.png\",alt:\"\"})}),\"\\n\",n(i.p,{children:\"For those familiar with the inherent limitations of transformer architectures, particularly their substantial computational overhead, it comes as no surprise that XLNet inherits these same challenges. The authors were acutely aware of this computational burden.\"}),\"\\n\",t(i.blockquote,{children:[\"\\n\",n(i.p,{children:\"While the permutation language modeling objective (3) has several benefits, it is a much more challenging optimization problem due to the permutation and causes slow convergence in preliminary experiments. To reduce the optimization difficulty, we choose to only predict the last tokens in a factorization order.\"}),\"\\n\"]}),\"\\n\",n(i.p,{children:n(i.img,{src:\"/development/reading-papers-1/11.png\",alt:\"\"})}),\"\\n\",n(i.p,{children:\"To mitigate this issue, they strategically implemented the permutation method on only a subset of the sequence, rather than applying it exhaustively.\"}),\"\\n\",n(i.hr,{}),\"\\n\",n(i.p,{children:n(i.a,{href:\"https://arxiv.org/abs/1907.11692\",children:\"RoBERTa\"})}),\"\\n\",n(i.p,{children:n(i.img,{src:\"/development/reading-papers-1/13.png\",alt:\"\"})}),\"\\n\",n(i.p,{children:\"In abstract:\"}),\"\\n\",t(i.blockquote,{children:[\"\\n\",n(i.p,{children:\"hyperparameter choices have significant impact on the final results. We present a replication study of BERT pretraining (Devlin et al., 2019) that carefully measures the impact of many key hyperparameters and training data size.\"}),\"\\n\"]}),\"\\n\",n(i.p,{children:\"So... the RoBERTa paper represents the better hyperparameter optimization. Our professor emphasized that despite its seemingly straightforward tuning methodology, this research emerged during a period saturated with numerous approaches and architectural innovations aimed at enhancing LLM performance. I concur with this assessment, as my review of several related papers reveals a predominant focus on architectural innovations.\"}),\"\\n\",n(i.p,{children:\"From this perspective, the authors assert the following:\"}),\"\\n\",t(i.blockquote,{children:[\"\\n\",n(i.p,{children:\"We find that BERT was significantly undertrained, and can match or exceed the performance of every model published after it.\"}),\"\\n\"]}),\"\\n\",n(i.p,{children:\"They also implement an masking strategy called dynamic masking, which randomly masks tokens throughout the training process rather than consistently masking identical token positions.\"}),\"\\n\",n(i.p,{children:\"Intuitively, as most would likely concur, dynamic masking appears inherently more effective than static masking approaches. However, the empirical results indicate:\"}),\"\\n\",n(i.p,{children:n(i.img,{src:\"/development/reading-papers-1/14.png\",alt:\"\"})}),\"\\n\",t(i.blockquote,{children:[\"\\n\",n(i.p,{children:\"We find that our reimplementation with static masking performs similar to the original BERT model, and dynamic masking is comparable or slightly better than static masking.\"}),\"\\n\"]}),\"\\n\",n(i.p,{children:\":D\"}),\"\\n\",n(i.p,{children:\"The followings are all approaches:\"}),\"\\n\",t(i.blockquote,{children:[\"\\n\",n(i.p,{children:\"Specifically, RoBERTa is trained with\\ndynamic masking (Section 4.1)\\nFULL-SENTENCES without NSP loss (Section 4.2)\\nlarge mini-batches (Section 4.3)\\na larger byte-level BPE (Section 4.4)\"}),\"\\n\"]}),\"\\n\",n(i.p,{children:n(i.img,{src:\"/development/reading-papers-1/15.png\",alt:\"\"})}),\"\\n\",n(i.p,{children:\"And they assert that BPE has advantages although it doesn't show a better performance.\"}),\"\\n\",t(i.blockquote,{children:[\"\\n\",n(i.p,{children:\"Early experiments revealed only slight differences between these encodings, with the Radford et al. (2019) BPE achieving slightly worse end-task performance on some tasks. Nevertheless, we believe the advantages of a universal encoding scheme outweighs the minor degredation in performance and use this encoding in the remainder of our experiments. A more detailed comparison of these encodings is left to future work.\"}),\"\\n\"]}),\"\\n\",n(i.hr,{}),\"\\n\",n(i.p,{children:n(i.a,{href:\"https://arxiv.org/abs/1909.11942\",children:\"ALBERT\"})}),\"\\n\",n(i.p,{children:n(i.img,{src:\"/development/reading-papers-1/16.png\",alt:\"\"})}),\"\\n\",n(i.p,{children:\"In abstract:\"}),\"\\n\",t(i.blockquote,{children:[\"\\n\",n(i.p,{children:\"we present two parameter reduction techniques to lower memory consumption and increase the training speed of BERT (Devlin et al., 2019). Comprehensive empirical evidence shows that our proposed methods lead to models that scale much better compared to the original BERT.\"}),\"\\n\"]}),\"\\n\",n(i.p,{children:\"I'll just introduce the methodologies of ALBERT brifely.\"}),\"\\n\",t(i.blockquote,{children:[\"\\n\",n(i.p,{children:\"The first one is a factorized embedding parameterization. By decomposing the large vocabulary embedding matrix into two small matrices, we separate the size of the hidden layers from the size of vocabulary embedding.\"}),\"\\n\"]}),\"\\n\",t(i.blockquote,{children:[\"\\n\",n(i.p,{children:\"The second technique is cross-layer parameter sharing. This technique prevents the parameter from growing with the depth of the network.\"}),\"\\n\"]}),\"\\n\",n(i.p,{children:\"These approaches yield efficiency gains:\"}),\"\\n\",t(i.blockquote,{children:[\"\\n\",n(i.p,{children:\"An ALBERT configuration similar to BERT-large has 18x fewer parameters and can be trained about 1.7x faster.\"}),\"\\n\"]}),\"\\n\",t(i.p,{children:[\"The first one:\\n\",n(i.img,{src:\"/development/reading-papers-1/18.png\",alt:\"\"})]}),\"\\n\",t(i.blockquote,{children:[\"\\n\",n(i.p,{children:\"Therefore, for ALBERT we use a factorization of the embedding parameters, decomposing them into two smaller matrices. Instead of projecting the one-hot vectors directly into the hidden space of size H, we first project them into a lower dimensional embedding space of size E, and then project it to the hidden space. By using this decomposition, we reduce the embedding parameters from O(V × H) to O(V × E + E × H).\"}),\"\\n\"]}),\"\\n\",t(i.p,{children:[\"The second:\\n\",n(i.img,{src:\"/development/reading-papers-1/17.png\",alt:\"\"})]}),\"\\n\",t(i.blockquote,{children:[\"\\n\",n(i.p,{children:\"We observe that the transitions from layer to layer are much smoother for ALBERT than for BERT. These results show that weight-sharing has an effect on stabilizing network parameters. Although there is a drop for both metrics compared to BERT, they nevertheless do not converge to 0 even after 24 layers. This shows that the solution space for ALBERT parameters is very different from the one found by DQE. Although there is a drop for both metrics compared to BERT, they nevertheless do not converge to 0 even after 24 layers. This shows that the solution space for ALBERT parameters is very different from the one found by DQE.\"}),\"\\n\"]}),\"\\n\",n(i.hr,{})]})}return{default:function(e={}){const{wrapper:t}=e.components||{};return t?n(t,{...e,children:n(_createMdxContent,{...e})}):_createMdxContent(e)}};",
    "permalink": "/development/reading-papers"
  },
  {
    "title": "Next.js 앱 CI/CD 구축하기",
    "description": "Github Actions와 AWS CodeDeploy를 이용해 CI/CD를 구축합니다.",
    "slug": "setup-ci-cd-with-codedeploy-github-actions",
    "publishDate": "2025-03-03",
    "thumbnailUrl": "/development/setup-ci-cd-with-codedeploy-github-actions/1.png",
    "content": "const{Fragment:l,jsx:n,jsxs:e}=arguments[0];function _createMdxContent(s){const c={a:\"a\",code:\"code\",h3:\"h3\",h5:\"h5\",hr:\"hr\",img:\"img\",li:\"li\",ol:\"ol\",p:\"p\",pre:\"pre\",span:\"span\",ul:\"ul\",...s.components};return e(l,{children:[n(c.p,{children:\"수정 사항이 있을 때마다 매번 EC2 인스턴스에 들어가 레포지토리를 클론하고 빌드하는 건 번거로운 과정이다. 그래서 배포를 자동화해 주는 작업을 통해 수고로움을 덜 수 있다. 흔히 CI/CD로 부르는데 용어가 뭔지 간단하게 살펴보자.\"}),\"\\n\",n(c.p,{children:\"Continuous Integration\"}),\"\\n\",e(c.ul,{children:[\"\\n\",n(c.li,{children:\"코드의 변경사항을 합쳐서 빌드하고 테스트하는 과정을 말한다. 수정 사항이 애플리케이션을 터친다면 CI에서 막히는 셈이다.\"}),\"\\n\"]}),\"\\n\",n(c.p,{children:\"Continuous Delivery & Deployment\"}),\"\\n\",e(c.ul,{children:[\"\\n\",n(c.li,{children:\"CI 단계를 통과한 수정 사항을 배포한다. 최종 배포를 수동으로 트리거하면 Delivery, 자동으로 하면 Deployment라 부른다.\"}),\"\\n\"]}),\"\\n\",n(c.p,{children:\"CI/CD는 다음과 같은 파이프라인으로 구성된다.\"}),\"\\n\",e(c.ol,{children:[\"\\n\",n(c.li,{children:\"코드 변경\"}),\"\\n\",n(c.li,{children:\"빌드\"}),\"\\n\",n(c.li,{children:\"테스트\"}),\"\\n\",n(c.li,{children:\"배포 준비\"}),\"\\n\",n(c.li,{children:\"배포\"}),\"\\n\"]}),\"\\n\",n(c.p,{children:\"이번 포스트에서는 위 파이프라인 작업들을 자동화할 것이다. 내 프로젝트는 Bun을 이용해 진행하므로 npm이나 yarn 패키지 관리를 쓰고 런타임 환경을 node.js로 쓴다면 적절하게 바꿔줘야 한다!\"}),\"\\n\",n(c.hr,{}),\"\\n\",n(c.h3,{children:\"YAML\"}),\"\\n\",n(c.p,{children:\"YAML은 JSON의 상위 호환 문법으로 보통 configuration 작업에 많이 쓰인다. 자동 배포를 위해 설정해 주는 데이터 파일도 전부 YAML 문법으로 쓰인다. 간단하게 YAML 문법에 대해 소개하자면...\"}),\"\\n\",n(l,{children:n(c.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:e(c.code,{children:[n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#616E88\"},children:\"# 주석을 지원한다!\"})}),\"\\n\",n(c.span,{className:\"line\"}),\"\\n\",n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#616E88\"},children:\"# '', \\\"\\\" 모두 지원한다. \\\\n같은 이스케이프 문자나 :같은 yaml 문법에 쓰이는 기호를 쓸 땐 quote로 감싸야 한다.\"})}),\"\\n\",n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#616E88\"},children:\"# 프로퍼티 이름에 띄어쓰기도 가능하다.\"})}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"example:\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\"with quotes\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\"'\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"example:\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" without\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" quotes\"})]}),\"\\n\",n(c.span,{className:\"line\"}),\"\\n\",n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#616E88\"},children:\"# >, | 를 사용해 긴 문장을 표현할 수 있다. >는 space, |는 \\\\n 역할이다.\"})}),\"\\n\",n(c.span,{className:\"line\"}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"한글도:\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" 지원한다는\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" 사실\"})]}),\"\\n\",n(c.span,{className:\"line\"}),\"\\n\",n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#616E88\"},children:\"# null을 사용 가능하며, ~ 기호로 단축 표현할 수 있다.\"})}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"null\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" value:\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" null\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"null\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" shorthand:\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" ~\"})]}),\"\\n\",n(c.span,{className:\"line\"}),\"\\n\",n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#616E88\"},children:\"# 배열은 - 로 구분한다.\"})}),\"\\n\",n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#88C0D0\"},children:\"array:\"})}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"    -\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" apple\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"    -\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" banana\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"    -\"}),n(c.span,{style:{color:\"#B48EAD\"},children:\" 12345\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"    -\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" a:\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" b\"})]}),\"\\n\",n(c.span,{className:\"line\"}),\"\\n\",n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#616E88\"},children:\"# json 스타일도 가능하다. 그러나 json의 배열 기능을 보완하는데 있어 yaml의 장점이 있다는 사실.\"})}),\"\\n\",n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#616E88\"},children:\"# 따옴표나 쉼표를 쓰지 않기 위해 yaml이 하이픈을 만들었으니 위처럼 사용하자.\"})}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"json\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" style\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" array:\"}),n(c.span,{style:{color:\"#D8DEE9FF\"},children:\" [\"})]}),\"\\n\",n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#88C0D0\"},children:\"    apple,\"})}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"    'banana'\"}),n(c.span,{style:{color:\"#88C0D0\"},children:\",\"})]}),\"\\n\",n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#88C0D0\"},children:\"    12345,\"})}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"    a:\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" b,\"})]}),\"\\n\",n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#D8DEE9FF\"},children:\"]\"})}),\"\\n\",n(c.span,{className:\"line\"}),\"\\n\",n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#616E88\"},children:\"# 객체는 들여쓰기와 :로 구분\"})}),\"\\n\",n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#88C0D0\"},children:\"object:\"})}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"    name:\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" namu\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" wiki\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"    type\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\":\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" dictionary\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"    primary\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" color:\"})]}),\"\\n\",n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#88C0D0\"},children:\"        gradient:\"})}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"            start:\"}),n(c.span,{style:{color:\"#B48EAD\"},children:\" 0x00A495\"})]}),\"\\n\",n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#D8DEE9FF\"},children:\"            end: 0x13AD65\"})}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"        header:\"}),n(c.span,{style:{color:\"#B48EAD\"},children:\" 0x008275\"})]}),\"\\n\",n(c.span,{className:\"line\"}),\"\\n\",n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#616E88\"},children:\"# 마찬가지로 따옴표와 쉼표, 중괄호같은 낭비를 없애기 위해 yaml이 있으니 위처럼 쓰도록 하자.\"})}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"json\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" style\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" object:\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" {\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"    name:\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" namu\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" wiki,\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:'    \"type\"'}),n(c.span,{style:{color:\"#88C0D0\"},children:\":\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:' \"'}),n(c.span,{style:{color:\"#A3BE8C\"},children:\"dictionary\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:'\"'}),n(c.span,{style:{color:\"#A3BE8C\"},children:\",\"})]}),\"\\n\",n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#D8DEE9FF\"},children:\"}\"})}),\"\\n\",n(c.span,{className:\"line\"}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"implicit\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" null:\"}),n(c.span,{style:{color:\"#616E88\"},children:\" # 이러면 암묵적으로 null이 들어간다.\"})]})]})})}),\"\\n\",n(c.p,{children:\"이 외에는 공식문서를 참고하면 된다! 아니면 나무위키에도 잘 설명 되어있으니 참고하길...\"}),\"\\n\",n(c.hr,{}),\"\\n\",n(c.h3,{children:\"GitHub Actions\"}),\"\\n\",e(c.p,{children:[\"GitHub Actions는 CI/CD를 도와주는 도구다. 어떤 식으로 쓰는지 \",n(c.a,{href:\"https://docs.github.com/ko/actions/writing-workflows/quickstart\",children:\"https://docs.github.com/ko/actions/writing-workflows/quickstart\"}),\" 를 따라 하면 바로 느낌이 온다!\"]}),\"\\n\",e(c.p,{children:[\"GitHub Actions와 YAML에 대해 작성한 글이 있으니 궁금하면 보시길~ (\",n(c.a,{href:\"https://hyeokrani.tistory.com/117\",children:\"https://hyeokrani.tistory.com/117\"}),\")\"]}),\"\\n\",n(c.p,{children:\"한 번 CI를 위한 파일을 만들고 레포지토리에 push 해보자.\"}),\"\\n\",n(l,{children:n(c.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:e(c.code,{children:[e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"name\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" ci\"})]}),\"\\n\",n(c.span,{className:\"line\"}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#81A1C1\"},children:\"on\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"  pull_request\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"    branches\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#ECEFF4\"},children:\"      -\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" main\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"  push\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"    branches\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#ECEFF4\"},children:\"      -\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" main\"})]}),\"\\n\",n(c.span,{className:\"line\"}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"jobs\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"  ci\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"    runs-on\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" ubuntu-latest\"})]}),\"\\n\",n(c.span,{className:\"line\"}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"    steps\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#ECEFF4\"},children:\"      -\"}),n(c.span,{style:{color:\"#8FBCBB\"},children:\" uses\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" actions/checkout@v4\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#ECEFF4\"},children:\"      -\"}),n(c.span,{style:{color:\"#8FBCBB\"},children:\" name\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" Setup Bun\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"        run\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\" |\"})]}),\"\\n\",n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#A3BE8C\"},children:\"          curl -fsSL https://bun.sh/install | bash\"})}),\"\\n\",n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#A3BE8C\"},children:'          echo \"BUN_INSTALL=$HOME/.bun\" >> $GITHUB_ENV'})}),\"\\n\",n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#A3BE8C\"},children:'          echo \"PATH=$HOME/.bun/bin:$PATH\" >> $GITHUB_ENV'})}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#ECEFF4\"},children:\"      -\"}),n(c.span,{style:{color:\"#8FBCBB\"},children:\" name\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" Install dependencies\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"        run\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" bun install\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#ECEFF4\"},children:\"      -\"}),n(c.span,{style:{color:\"#8FBCBB\"},children:\" name\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" Check\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"        run\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" bun check\"})]})]})})}),\"\\n\",n(c.p,{children:\"이 workflow는 main 브랜치로의 push나 PR에 작동한다. 어떤 작업들이 시행되는지 보면,\"}),\"\\n\",e(c.ol,{children:[\"\\n\",n(c.li,{children:\"레포지토리를 클론 한다.\"}),\"\\n\",n(c.li,{children:\"Bun을 설치한다.\"}),\"\\n\",n(c.li,{children:\"Bun으로 의존성을 설치한다.\"}),\"\\n\",n(c.li,{children:\"코드를 검사한다.\"}),\"\\n\"]}),\"\\n\",n(c.p,{children:\"위 과정이 잘 일어나는지 브랜치를 생성해 PR을 올려보자.\"}),\"\\n\",e(c.p,{children:[n(c.img,{src:\"/development/setup-ci-cd-with-codedeploy-github-actions/1.png\",alt:\"\"}),\"\\n\",n(c.img,{src:\"/development/setup-ci-cd-with-codedeploy-github-actions/2.png\",alt:\"\"})]}),\"\\n\",n(c.p,{children:\"workflow가 잘 작동했고, 코드 검사도 성공적으로 잘 끝난 걸 볼 수 있다.\\n이제 앞으로 main 브랜치에 PR로 올려주면 CI 성공 여부를 보고 합칠 수 있다.\"}),\"\\n\",n(c.hr,{}),\"\\n\",n(c.p,{children:\"수정한 코드가 기존 애플리케이션을 터칠 가능성을 확인했으니, 이제 수정된 코드를 인스턴스에 올려 배포하는 과정을 자동화하면 된다.\"}),\"\\n\",n(c.p,{children:\"자동 배포의 파이프라인은 어떻게 될까?\"}),\"\\n\",e(c.p,{children:[n(c.img,{src:\"/development/setup-ci-cd-with-codedeploy-github-actions/3.png\",alt:\"\"}),\"\\n첫 시작은 GitHub repository의 main 브랜치에 변경사항이 생기면 GitHub Actions를 트리거하도록 설정한다.\"]}),\"\\n\",n(c.p,{children:\"이후 GitHub Actions는\"}),\"\\n\",e(c.ol,{children:[\"\\n\",n(c.li,{children:\"프로젝트 파일을 빌드하고\"}),\"\\n\",n(c.li,{children:\"빌드 파일을 압축 후 S3 Bucket에 업로드한 뒤\"}),\"\\n\",n(c.li,{children:\"CodeDeploy가 정해진 동작을 하도록 트리거한다.\"}),\"\\n\"]}),\"\\n\",n(c.p,{children:\"CodeDeploy는 EC2 instance 내에 Code Deploy Agent라는 이름으로 실행되어\"}),\"\\n\",e(c.ol,{children:[\"\\n\",n(c.li,{children:\"S3에 올라온 파일을 다운로드하고\"}),\"\\n\",n(c.li,{children:\"압축을 해제해 프로젝트 루트 디렉토리에 설치한 뒤\"}),\"\\n\",n(c.li,{children:\"정해진 스크립트를 실행한다.\"}),\"\\n\"]}),\"\\n\",n(c.p,{children:\"이때 스크립트는 설치 전 후로 정의해 줄 수 있음!\"}),\"\\n\",n(c.p,{children:\"여기서 생기는 궁금점이 두 개 있다.\"}),\"\\n\",n(c.p,{children:\"Q1. 왜 의존성 설치부터 빌드하는 과정을 EC2 인스턴스가 직접 하지 않고, GitHub Actions의 가상 머신에서 실행할까?\\nQ2. 빌드한 파일을 압축한 뒤 곧장 EC2 인스턴스로 보내지 않고, S3로 올리는 이유가 뭘까?\"}),\"\\n\",n(c.p,{children:\"Q1번에 대해서 AI에게 얻어낸 답은 이렇다. (틀린 게 있다면 지적해 주세요!)\"}),\"\\n\",n(c.p,{children:\"A1-1) 의존성 설치 및 빌드 과정을 GitHub Actions runner의 통일된 환경에서 실행해 일관성을 높인다. 로컬이나 서버 환경은 상황마다 달라질 수 있으므로! (대신 이건 도커를 활용하면 훨씬 좋을 듯)\\nA1-2) 우리의 인스턴스는 서버 업무용! 서버 돌리는 데 쓰이는 메모리를 굳이 레포지토리 클론하고 프로젝트 빌드하는 데 쓸 이유가 없다. 서버용 컴퓨터는 서버 업무에만 집중하게 해서 메모리 부담도 줄이고, 관리 측면에서도 책임 소재를 확실히 하자. (그리고 우리의 계정은 프리티어! 아기자기한 메모리와 CPU를 위해서 최대한 부담을 줄여야 한다.)\"}),\"\\n\",n(c.p,{children:\"Q2번에 대해서 우선 압축 파일을 보내는 이유는 인스턴스의 네트워크 부하를 줄이기 위함도 있지만, 기본적으로는 압축 알고리즘이 효율적이기 때문이다. 압축과 해제에 소요되는 작업 시간과 부하가 생 파일을 네트워크로 전송하는 것보다 더 낫다!\"}),\"\\n\",n(c.p,{children:\"A2-1) 빌드된 배포 파일(Artifact)을 개인적인 공간인 인스턴스에서 관리하기보다, 중앙화된 저장소인 S3 Bucket에 놓아 관리를 용이하게 한다. 일관성이나 재사용성, 실패 시 복구 등을 훨씬 안정적으로 실행할 수 있다. (중요한 파일을 하드디스크에 저장하는 것처럼!)\\nA2-2) 빌드와 배포 단계를 분리한다. 중간에 S3를 두고 업로드 전까지는 빌드 및 테스트 과정, 업로드 후에는 EC2 인스턴스가 실행하는 배포 과정으로 명확히 나눌 수 있다.\"}),\"\\n\",n(c.p,{children:\"이제 이유를 알았으니 실행하러 가보자!\"}),\"\\n\",n(c.hr,{}),\"\\n\",n(c.h3,{children:\"1. Bucket 생성 및 GitHub Actions가 사용할 IAM 계정 생성\"}),\"\\n\",n(c.p,{children:\"우선 압축한 빌드 파일을 올릴 bucket을 생성하자.\"}),\"\\n\",n(c.p,{children:n(c.img,{src:\"/development/setup-ci-cd-with-codedeploy-github-actions/4.png\",alt:\"\"})}),\"\\n\",n(c.p,{children:\"rookie-review-ci-cd라는 이름으로 만들었다.\"}),\"\\n\",n(c.p,{children:\"그리고 GitHub Actions가 사용할 IAM 계정을 만들어야 한다. 이 계정은 S3와 CodeDeploy에 접근할 수 있는 권한이 있어야 한다.\"}),\"\\n\",n(c.p,{children:n(c.img,{src:\"/development/setup-ci-cd-with-codedeploy-github-actions/5.png\",alt:\"\"})}),\"\\n\",n(c.p,{children:\"AmazonS3FullAccess, AWSCodeDeployFullAccess 두 정책을 할당한 뒤, GitHub Actions가 이 계정에 접근할 수 있도록 Access key를 발급받자.\"}),\"\\n\",n(c.p,{children:\"어떤 블로그에서는 EC2에도 접근할 수 있는 정책을 할당했는데, GitHub Actions는 직접적으로 EC2에 접근하지 않는다. EC2에는 CodeDeploy가 접근하므로 이 계정에는 CodeDeploy에 대한 정책만 할당해 주면 된다.\"}),\"\\n\",n(c.p,{children:\"이후 GitHub 레포지토리의 Setting > Secrets and variables > Actions로 이동해 Access key를 Repository Secrets을 등록하자.\"}),\"\\n\",n(c.p,{children:n(c.img,{src:\"/development/setup-ci-cd-with-codedeploy-github-actions/6.png\",alt:\"\"})}),\"\\n\",n(c.hr,{}),\"\\n\",n(c.h3,{children:\"2. EC2와 CodeDeploy에 할당할 역할 생성\"}),\"\\n\",n(c.p,{children:\"EC2와 CodeDeploy가 AWS 내에서 활동하기 위해 정책을 할당받아야 한다. 정책들을 모아놓은 역할을 만들어 지정해 주면 된다.\"}),\"\\n\",n(c.p,{children:\"EC2는 어떤 정책이 필요할까?\"}),\"\\n\",e(c.ol,{children:[\"\\n\",n(c.li,{children:\"S3에 업로드된 아티팩트를 다운로드 받아야 한다. -> AmazonS3ReadOnlyAccess\"}),\"\\n\",n(c.li,{children:\"EC2 인스턴스에서 CodeDeploy Agent가 작동할 때 필요한 권한이 있어야 한다. -> AmazonEC2RoleforAWSCodeDeploy\"}),\"\\n\"]}),\"\\n\",e(c.p,{children:[n(c.img,{src:\"/development/setup-ci-cd-with-codedeploy-github-actions/7.png\",alt:\"\"}),\"\\n\",n(c.img,{src:\"/development/setup-ci-cd-with-codedeploy-github-actions/8.png\",alt:\"\"})]}),\"\\n\",n(c.p,{children:\"그리고 CodeDeploy에 필요한 역할도 만들어주자.\"}),\"\\n\",n(c.p,{children:n(c.img,{src:\"/development/setup-ci-cd-with-codedeploy-github-actions/9.png\",alt:\"\"})}),\"\\n\",n(c.p,{children:\"얘는 요거 하나만 있으면 된다.\"}),\"\\n\",n(c.hr,{}),\"\\n\",e(c.ol,{start:\"3\",children:[\"\\n\",n(c.li,{children:\"CodeDeploy 애플리케이션 및 배포 그룹 생성\"}),\"\\n\"]}),\"\\n\",e(c.p,{children:[\"CodeDeploy에 들어가 애플리케이션을 생성하자.\\n\",n(c.img,{src:\"/development/setup-ci-cd-with-codedeploy-github-actions/10.png\",alt:\"\"})]}),\"\\n\",n(c.p,{children:\"CodeDeplooy를 이용해 EC2에 배포할 것이므로 EC2/On-premises로 플랫폼을 지정하자.\"}),\"\\n\",n(c.p,{children:\"배포 그룹을 생성하자.\"}),\"\\n\",e(c.p,{children:[n(c.img,{src:\"/development/setup-ci-cd-with-codedeploy-github-actions/11.png\",alt:\"\"}),\"\\n\",n(c.img,{src:\"/development/setup-ci-cd-with-codedeploy-github-actions/12.png\",alt:\"\"}),\"\\n\",n(c.img,{src:\"/development/setup-ci-cd-with-codedeploy-github-actions/13.png\",alt:\"\"})]}),\"\\n\",n(c.p,{children:\"그룹에 아까 생성한 역할을 지정해 주고, 인스턴스를 연결해 주자. 로드 밸런서는 우선 체크 해제해 주자! (비용 절감)\"}),\"\\n\",n(c.p,{children:\"이후 GitHub Actions에 필요한 사항들을 secrets에 등록해 주자.\"}),\"\\n\",n(c.p,{children:n(c.img,{src:\"/development/setup-ci-cd-with-codedeploy-github-actions/14.png\",alt:\"\"})}),\"\\n\",n(c.hr,{}),\"\\n\",n(c.h3,{children:\"4. EC2 인스턴스에 CodeDeploy Agent 설치\"}),\"\\n\",n(c.p,{children:\"인스턴스에 접속한 뒤 다음 명령어를 실행하자.\"}),\"\\n\",n(l,{children:n(c.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:e(c.code,{children:[e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"sudo\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" apt\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" update\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"sudo\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" apt\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" install\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" ruby-full\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"sudo\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" apt\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" install\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" wget\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"cd\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" /home/ubuntu\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"wget\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" https://aws-codedeploy-ap-northeast-2.s3.ap-northeast-2.amazonaws.com/latest/install\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"chmod\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" +x\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" ./install\"})]}),\"\\n\",n(c.span,{className:\"line\"}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"sudo\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" ./install\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" auto\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\" >\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" /tmp/logfile\"}),n(c.span,{style:{color:\"#D8DEE9FF\"},children:\" (20.04 \"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\"버전\"}),n(c.span,{style:{color:\"#D8DEE9FF\"},children:\")\"})]})]})})}),\"\\n\",n(c.p,{children:\"CodeDeploy 설치 및 실행을 위해 ruby-full, wget을 설치해야 한다. 그전에 둘의 패키지 목록을 최신 상태로 업데이트해준다.\"}),\"\\n\",n(c.p,{children:\"최신 버전인 ubuntu 20.04 버전의 경우 출력 로그 저장 경로를 지정하는 > /tmp/logfile 명령어를 추가하라고 공식 문서에 나와있다.\"}),\"\\n\",n(c.p,{children:\"아래 명령어를 통해 정상적으로 작동하는지 확인할 수 있다.\"}),\"\\n\",n(l,{children:n(c.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(c.code,{children:e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"sudo\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" service\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" codedeploy-agent\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" status\"})]})})})}),\"\\n\",n(c.p,{children:\"Active: active (running) -> 정상적으로 CodeDeploy Agent가 작동 중에 있다!\"}),\"\\n\",n(c.hr,{}),\"\\n\",n(c.h3,{children:\"5. GitHub Actions와 CodeDeploy 설정하기\"}),\"\\n\",n(c.p,{children:\"이제 GitHub Actions가 실행해 줄 작업을 정의하자.\"}),\"\\n\",n(c.p,{children:\".github/workflows/deploy.yml\"}),\"\\n\",n(l,{children:n(c.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:e(c.code,{children:[e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"name\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" deploy to S3\"})]}),\"\\n\",n(c.span,{className:\"line\"}),\"\\n\",n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#616E88\"},children:\"# main 브랜치로 push 할 때 workflow 실행\"})}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#81A1C1\"},children:\"on\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"  push\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"    branches\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#ECEFF4\"},children:\"      -\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" main\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"  workflow_dispatch\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"})]}),\"\\n\",n(c.span,{className:\"line\"}),\"\\n\",n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#616E88\"},children:\"# 환경 변수 설정\"})}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"env\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"  S3_BUCKET_NAME\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" ${{ secrets.S3_BUCKET_NAME }}\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"  CODE_DEPLOY_APPLICATION_NAME\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" ${{ secrets.CODE_DEPLOY_APPLICATION_NAME }}\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"  CODE_DEPLOY_DEPLOYMENT_GROUP_NAME\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" ${{ secrets.CODE_DEPLOY_DEPLOYMENT_GROUP_NAME }}\"})]}),\"\\n\",n(c.span,{className:\"line\"}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"jobs\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"  build\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"    runs-on\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" ubuntu-latest\"})]}),\"\\n\",n(c.span,{className:\"line\"}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"    steps\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"})]}),\"\\n\",n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#616E88\"},children:\"      # 레포지토리 clone\"})}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#ECEFF4\"},children:\"      -\"}),n(c.span,{style:{color:\"#8FBCBB\"},children:\" name\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" Checkout\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"        uses\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" actions/checkout@v4\"})]}),\"\\n\",n(c.span,{className:\"line\"}),\"\\n\",n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#616E88\"},children:\"      # Bun 설치 및 관련 환경 변수 설정\"})}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#ECEFF4\"},children:\"      -\"}),n(c.span,{style:{color:\"#8FBCBB\"},children:\" name\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" Setup Bun\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"        run\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\" |\"})]}),\"\\n\",n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#A3BE8C\"},children:\"          curl -fsSL https://bun.sh/install | bash\"})}),\"\\n\",n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#A3BE8C\"},children:'          echo \"BUN_INSTALL=$HOME/.bun\" >> $GITHUB_ENV'})}),\"\\n\",n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#A3BE8C\"},children:'          echo \"PATH=$HOME/.bun/bin:$PATH\" >> $GITHUB_ENV'})}),\"\\n\",n(c.span,{className:\"line\"}),\"\\n\",n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#616E88\"},children:\"      # 프로젝트 의존성 설치\"})}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#ECEFF4\"},children:\"      -\"}),n(c.span,{style:{color:\"#8FBCBB\"},children:\" name\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" Install dependencies\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"        run\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" bun install\"})]}),\"\\n\",n(c.span,{className:\"line\"}),\"\\n\",n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#616E88\"},children:\"      # Next.js 앱 빌드\"})}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#ECEFF4\"},children:\"      -\"}),n(c.span,{style:{color:\"#8FBCBB\"},children:\" name\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" Build next app\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"        run\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" bun run build\"})]}),\"\\n\",n(c.span,{className:\"line\"}),\"\\n\",n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#616E88\"},children:\"      # 빌드한 파일과 프로젝트 소스를 압축해 .zip 파일로 만들기\"})}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#ECEFF4\"},children:\"      -\"}),n(c.span,{style:{color:\"#8FBCBB\"},children:\" name\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" Make zip file\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"        run\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:' zip -qq -r ./rookie_review.zip . -x \".git/*\"'})]}),\"\\n\",n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#616E88\"},children:\"        # -qq: quit 모드로 실행 (에러나 경고메세지만 출력하도록 함)\"})}),\"\\n\",n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#616E88\"},children:\"        # -r: 지정된 디렉토리를 재귀적으로 압축 (하위 디렉토리와 파일들 모두 압축)\"})}),\"\\n\",n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#616E88\"},children:\"        # -x: 지정한 파일들 압축 과정에서 제외하기\"})}),\"\\n\",n(c.span,{className:\"line\"}),\"\\n\",n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#616E88\"},children:\"      # Github Action에서 AWS의 권한 자격을 얻어오는 단계\"})}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#ECEFF4\"},children:\"      -\"}),n(c.span,{style:{color:\"#8FBCBB\"},children:\" name\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" Configure AWS credentials\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"        uses\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" aws-actions/configure-aws-credentials@v2\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"        with\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"          aws-access-key-id\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" ${{ secrets.AWS_ACCESS_KEY_ID }}\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"          aws-secret-access-key\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" ${{ secrets.AWS_SECRET_ACCESS_KEY }}\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"          aws-region\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" ${{ secrets.AWS_REGION }}\"})]}),\"\\n\",n(c.span,{className:\"line\"}),\"\\n\",n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#616E88\"},children:\"      # 압축된 파일을 S3에 업로드\"})}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#ECEFF4\"},children:\"      -\"}),n(c.span,{style:{color:\"#8FBCBB\"},children:\" name\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" Upload to S3\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"        run\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" aws s3 cp --region ap-northeast-2 ./rookie_review.zip s3://${{ env.S3_BUCKET_NAME }}/rookie_review.zip\"})]}),\"\\n\",n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#616E88\"},children:\"        # aws s3 cp: AWS CLI 명령어로 파일 복사\"})}),\"\\n\",n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#616E88\"},children:\"        # --region ap-northeast-2: 업로드 대상 리전 설정\"})}),\"\\n\",n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#616E88\"},children:\"        # 파일을 S3 버킷의 루트 디렉토리에 업로드.\"})}),\"\\n\",n(c.span,{className:\"line\"}),\"\\n\",n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#616E88\"},children:\"      # S3에 업로드 된 빌드 파일을 이용해 CodeDeploy가 정의된 동작을 하도록 트리거\"})}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#ECEFF4\"},children:\"      -\"}),n(c.span,{style:{color:\"#8FBCBB\"},children:\" name\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" Code Deploy\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"        run\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\" |\"})]}),\"\\n\",n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#A3BE8C\"},children:\"          aws deploy create-deployment \\\\\"})}),\"\\n\",n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#A3BE8C\"},children:\"          --application-name ${{ env.CODE_DEPLOY_APPLICATION_NAME }} \\\\\"})}),\"\\n\",n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#A3BE8C\"},children:\"          --deployment-config-name CodeDeployDefault.AllAtOnce \\\\\"})}),\"\\n\",n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#A3BE8C\"},children:\"          --deployment-group-name ${{ env.CODE_DEPLOY_DEPLOYMENT_GROUP_NAME }} \\\\\"})}),\"\\n\",n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#A3BE8C\"},children:\"          --s3-location bucket=$S3_BUCKET_NAME,bundleType=zip,key=rookie_review.zip\"})})]})})}),\"\\n\",n(c.p,{children:\"appspec.yml은 CodeDeploy가 실행할 작업 설정 파일이다.\"}),\"\\n\",n(c.p,{children:\"appspec.yml\"}),\"\\n\",n(l,{children:n(c.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:e(c.code,{children:[e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"version\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#B48EAD\"},children:\" 0.0\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"os\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" linux\"})]}),\"\\n\",n(c.span,{className:\"line\"}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"files\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#ECEFF4\"},children:\"  -\"}),n(c.span,{style:{color:\"#8FBCBB\"},children:\" source\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" /\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"    destination\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" /home/ubuntu/waffle_rookie_review\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"    overwrite\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\" yes\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"permissions\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#ECEFF4\"},children:\"  -\"}),n(c.span,{style:{color:\"#8FBCBB\"},children:\" object\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" /home/ubuntu/waffle_rookie_review\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"    owner\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" ubuntu\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"    group\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" ubuntu\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"    mode\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#B48EAD\"},children:\" 755\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"hooks\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"  BeforeInstall\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#ECEFF4\"},children:\"    -\"}),n(c.span,{style:{color:\"#8FBCBB\"},children:\" location\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" scripts/before-install.sh\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"      timeout\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#B48EAD\"},children:\" 300\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"      runas\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" ubuntu\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"  AfterInstall\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#ECEFF4\"},children:\"    -\"}),n(c.span,{style:{color:\"#8FBCBB\"},children:\" location\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" scripts/after-install.sh\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"      timeout\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#B48EAD\"},children:\" 300\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"      runas\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" ubuntu\"})]})]})})}),\"\\n\",n(c.p,{children:\"여기서 나는 before-install.sh를 생성해 자동배포 전, 프로젝트 파일을 전부 지워버리고 새로 설치하도록 했다.\"}),\"\\n\",n(c.p,{children:\"scripts/before-install.sh\"}),\"\\n\",n(l,{children:n(c.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:e(c.code,{children:[e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#D8DEE9\"},children:\"REPOSITORY\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\"/home/ubuntu/waffle_rookie_review\"})]}),\"\\n\",n(c.span,{className:\"line\"}),\"\\n\",n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#616E88\"},children:\"# 모든 파일과 숨김 파일 삭제\"})}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"find\"}),n(c.span,{style:{color:\"#D8DEE9\"},children:\" $REPOSITORY\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" -mindepth\"}),n(c.span,{style:{color:\"#B48EAD\"},children:\" 1\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" -delete\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"echo\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:' \"'}),n(c.span,{style:{color:\"#A3BE8C\"},children:\"Cleanup completed.\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:'\"'})]})]})})}),\"\\n\",n(c.p,{children:\"이유는 다음과 같은 에러가 발생해서인데,\"}),\"\\n\",n(l,{children:n(c.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:e(c.code,{children:[n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#88C0D0\"},children:\"Message\"})}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"The\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" deployment\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" failed\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" because\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" a\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" specified\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" file\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" already\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" exists\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" at\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" this\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" location:\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" /home/ubuntu/waffle_rookie_review/.gitignore\"})]})]})})}),\"\\n\",n(c.p,{children:\"배포 과정에서 CodeDeploy가 파일을 덮어씌우지 않고 에러를 뱉었기 때문. overwrite: yes 임에도 .gitignore 같은 민감한 파일들은 덮어쓰지 않는 걸까. 정확히는 잘 모르겠다. 어차피 기존 파일과 충돌할 수도 있으므로 완전히 삭제하고 새로 프로젝트를 깔아주는 게 좋기도 하고.\"}),\"\\n\",n(c.p,{children:\"그리고 after-install.sh를 생성해 배포 이후 정상적으로 pm2가 애플리케이션을 재실행하도록 설정했다.\"}),\"\\n\",n(c.p,{children:\"scripts/after-install.sh\"}),\"\\n\",n(l,{children:n(c.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:e(c.code,{children:[e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#D8DEE9\"},children:\"REPOSITORY\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\"/home/ubuntu/waffle_rookie_review\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#D8DEE9\"},children:\"BUN_PATH\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\"/home/ubuntu/.bun/bin/bun\"})]}),\"\\n\",n(c.span,{className:\"line\"}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"cd\"}),n(c.span,{style:{color:\"#D8DEE9\"},children:\" $REPOSITORY\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\" ||\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\" {\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"  echo\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:' \"'}),n(c.span,{style:{color:\"#A3BE8C\"},children:\"Error: Failed to navigate to project directory.\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"  exit\"}),n(c.span,{style:{color:\"#B48EAD\"},children:\" 1\"})]}),\"\\n\",n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#ECEFF4\"},children:\"}\"})}),\"\\n\",n(c.span,{className:\"line\"}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#D8DEE9\"},children:\"$BUN_PATH\"}),n(c.span,{style:{color:\"#D8DEE9FF\"},children:\" run deploy\"})]})]})})}),\"\\n\",n(c.p,{children:\"그리고 bun run deploy 명령어를 package.json에 추가하면 된다.\"}),\"\\n\",n(l,{children:n(c.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(c.code,{children:e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:'\"deploy\"'}),n(c.span,{style:{color:\"#88C0D0\"},children:\":\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:' \"'}),n(c.span,{style:{color:\"#A3BE8C\"},children:\"pm2 start ecosystem.config.js --env production\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:'\"'})]})})})}),\"\\n\",n(c.p,{children:\"마지막으로 CodeDeploy의 동작 이후 pm2가 정상적으로 애플리케이션을 재실행하도록 설정해 주면 된다.\"}),\"\\n\",n(c.p,{children:\"ecosystem.config.js\"}),\"\\n\",n(l,{children:n(c.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:e(c.code,{children:[e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#8FBCBB\"},children:\"module\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),n(c.span,{style:{color:\"#8FBCBB\"},children:\"exports\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\" =\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\" {\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"  apps\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#D8DEE9FF\"},children:\" [\"})]}),\"\\n\",n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#ECEFF4\"},children:\"    {\"})}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"      name\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\"waffle_rookie_review\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),n(c.span,{style:{color:\"#616E88\"},children:\" // 앱의 이름\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"      script\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\"./node_modules/next/dist/bin/next\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),n(c.span,{style:{color:\"#616E88\"},children:\" // Next.js 스크립트 경로\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"      args\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\"start\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),n(c.span,{style:{color:\"#616E88\"},children:\" // Next.js 앱을 시작할 때 사용할 인수\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"      exec_mode\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\"fork\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),n(c.span,{style:{color:\"#616E88\"},children:\" // 실행 모드: cluster 또는 fork 중 선택\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"      instances\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\"1\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),n(c.span,{style:{color:\"#616E88\"},children:\" // 클러스터 모드에서 실행할 인스턴스 수 (CPU 코어 수만큼)\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"      autorestart\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\" true\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),n(c.span,{style:{color:\"#616E88\"},children:\" // 프로세스 자동 재시작 활성화\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"      watch\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\" true\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),n(c.span,{style:{color:\"#616E88\"},children:\" // 파일 변경 감지 활성화 (개발 중에만 활용)\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"      max_memory_restart\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\"1G\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),n(c.span,{style:{color:\"#616E88\"},children:\" // 1GB 이상 메모리 사용 시 재시작\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"      interpreter\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\"/home/ubuntu/.bun/bin/bun\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"      env\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\" {\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"        NODE_ENV\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\"production\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),n(c.span,{style:{color:\"#616E88\"},children:\" // Node.js 환경 변수\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"        PATH\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\":\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\" `\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\"${\"}),n(c.span,{style:{color:\"#D8DEE9\"},children:\"process\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),n(c.span,{style:{color:\"#D8DEE9\"},children:\"env\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),n(c.span,{style:{color:\"#D8DEE9\"},children:\"HOME\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\"}\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\"/.bun/bin:\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\"${\"}),n(c.span,{style:{color:\"#D8DEE9\"},children:\"process\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),n(c.span,{style:{color:\"#D8DEE9\"},children:\"env\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),n(c.span,{style:{color:\"#D8DEE9\"},children:\"PATH\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\"}\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\"`\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),\"\\n\",n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#ECEFF4\"},children:\"      },\"})}),\"\\n\",n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#ECEFF4\"},children:\"    },\"})}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#D8DEE9FF\"},children:\"  ]\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#ECEFF4\"},children:\"}\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\";\"})]})]})})}),\"\\n\",n(c.p,{children:\"이러면 끝!....인 줄 알았으나 CodeDeploy에서 에러가 발생했다.\"}),\"\\n\",n(l,{children:n(c.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:e(c.code,{children:[e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"LifecycleEvent\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" -\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" AfterInstall\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"Script\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" -\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" scripts/after-install.sh\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),n(c.span,{style:{color:\"#D8DEE9FF\"},children:\"stderr\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\"]\"}),n(c.span,{style:{color:\"#D8DEE9FF\"},children:\"$ pm2 start ecosystem.config.js --env production\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),n(c.span,{style:{color:\"#D8DEE9FF\"},children:\"stderr\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\"]\"}),n(c.span,{style:{color:\"#D8DEE9FF\"},children:\"/usr/bin/bash: line 1: pm2: command not found\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),n(c.span,{style:{color:\"#D8DEE9FF\"},children:\"stderr\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\"]\"}),n(c.span,{style:{color:\"#D8DEE9FF\"},children:\"error: script \"}),n(c.span,{style:{color:\"#ECEFF4\"},children:'\"'}),n(c.span,{style:{color:\"#A3BE8C\"},children:\"deploy\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:'\"'}),n(c.span,{style:{color:\"#D8DEE9FF\"},children:\" exited with code 127\"})]})]})})}),\"\\n\",n(c.p,{children:\"scripts에 적힌 pm2 명령어를 사용하는데 pm2를 찾지 못해 에러가 발생했다.\"}),\"\\n\",n(c.p,{children:\"다음과 같이 심볼릭 링크를 지정해 주면 시스템 PATH 환경 변수에 추가할 수 있다.\"}),\"\\n\",n(l,{children:n(c.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:e(c.code,{children:[e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"sudo\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" ln\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" -s\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" /home/ubuntu/.bun/bin/pm2\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" /usr/bin/pm2\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"sudo\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" ln\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" -s\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" /home/ubuntu/.bun/bin/pm2\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" /usr/local/bin/pm2\"})]})]})})}),\"\\n\",n(c.p,{children:\"pm2 경로는 설정마다 다를 수 있으니 which pm2로 확인하고 적절하게 바꿔주자.\"}),\"\\n\",n(c.hr,{}),\"\\n\",n(c.h3,{children:\"6. 문제 해결하기\"}),\"\\n\",n(c.h5,{children:\"1) 환경변수 파일\"}),\"\\n\",n(c.p,{children:\"환경변수를 지정하는 .env 파일은 보안상의 이유로 .gitignore에 지정되어 있다. 민감한 파일들은 쏙 빼놓고 빌드하기 때문에 EC2 인스턴스의 프로젝트 디렉토리에 존재하지 않는다. 그래서 직접 원격 서버로 안전하게 전송하는 Secure Copy Protocol(SCP)를 사용해 옮겨주면 된다.\"}),\"\\n\",n(l,{children:n(c.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(c.code,{children:e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"scp\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" -i\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\" <\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\"key.pe\"}),n(c.span,{style:{color:\"#D8DEE9FF\"},children:\"m\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\">\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" .env\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\" <\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\"ec2-use\"}),n(c.span,{style:{color:\"#D8DEE9FF\"},children:\"r\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\">\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\"@\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\"<\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\"EC2_PUBLIC_I\"}),n(c.span,{style:{color:\"#D8DEE9FF\"},children:\"P\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\">\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\":/\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\"<\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\"target_director\"}),n(c.span,{style:{color:\"#D8DEE9FF\"},children:\"y\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\">\"})]})})})}),\"\\n\",n(c.p,{children:\"key.pem에는 인스턴스에 접속할 때 쓰는 키의 경로,\"}),\"\\n\",n(c.p,{children:\"ec2-user는 ubuntu, target_directory는 내 경우 /home/ubuntu/waffle_rookie_review 다.\"}),\"\\n\",n(c.p,{children:\"그런데..! 뭔가 이상함을 느꼈다면 👍\"}),\"\\n\",n(c.p,{children:\"바로 CodeDeploy에서 before-install.sh에 프로젝트를 전부 밀어버리는 명령어가 있다! 그래서 .env 파일도 함께 지워지므로 다른 방법을 사용해야 한다.\"}),\"\\n\",n(c.p,{children:\"/home/ubuntu/env_backups 디렉토리를 만들어주고 이곳에 .env 파일을 옮겨주자.\"}),\"\\n\",n(l,{children:n(c.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(c.code,{children:e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"mv\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" /home/ubuntu/waffle_rookie_review/.env.local\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" /home/ubuntu/env_backups\"})]})})})}),\"\\n\",n(c.p,{children:\"그리고 after-install.sh에 백업 폴더에서 설치된 프로젝트 디렉토리로 .env 파일을 옮기는 명령어를 추가한다.\"}),\"\\n\",n(l,{children:n(c.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:e(c.code,{children:[e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#81A1C1\"},children:\"if\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\" [\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\" -f\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:' \"'}),n(c.span,{style:{color:\"#A3BE8C\"},children:\"/home/ubuntu/env-backups/.env.local\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:'\"'}),n(c.span,{style:{color:\"#ECEFF4\"},children:\" ]\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\";\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\" then\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"  echo\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:' \"'}),n(c.span,{style:{color:\"#A3BE8C\"},children:\"> Restoring .env.local file...\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"  cp\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" /home/ubuntu/env-backups/.env.local\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" /home/ubuntu/waffle_rookie_review/.env.local\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\" ||\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\" {\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"    echo\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:' \"'}),n(c.span,{style:{color:\"#A3BE8C\"},children:\"Error: Failed to restore .env.local file.\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"    exit\"}),n(c.span,{style:{color:\"#B48EAD\"},children:\" 1\"})]}),\"\\n\",n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#ECEFF4\"},children:\"  }\"})}),\"\\n\",n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#81A1C1\"},children:\"else\"})}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"  echo\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:' \"'}),n(c.span,{style:{color:\"#A3BE8C\"},children:\"Warning: No backup .env.local file found. Skipping restoration.\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),\"\\n\",n(c.span,{className:\"line\",children:n(c.span,{style:{color:\"#81A1C1\"},children:\"fi\"})})]})})}),\"\\n\",n(c.h5,{children:\"2) 메모리 부족\"}),\"\\n\",n(l,{children:n(c.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(c.code,{children:e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"No\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" space\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" left\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" on\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" device\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" @\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" io_write\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" -\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" /opt/codedeploy-agent/deployment-root/a9949aba-cefa-4167-bc1b-0b0498d28232/d-1KKQEAKKA/bundle.tar\"})]})})})}),\"\\n\",n(c.p,{children:\"프리티어의 눈물... df -h를 보면 메모리를 전부 사용 중인 걸 확인할 수 있다. 메모리를 최적화하는 것도 방법이겠지만... 그냥 메모리를 늘려주자.\"}),\"\\n\",n(c.p,{children:\"인스턴스로 들어가 volume에서 현재 우리가 배포한 인스턴스가 사용 중인 volume의 크기를 늘려주자.\"}),\"\\n\",n(c.p,{children:n(c.img,{src:\"/development/setup-ci-cd-with-codedeploy-github-actions/15.png\",alt:\"\"})}),\"\\n\",n(c.p,{children:\"그리고 인스턴스에서 디스크의 첫 번째 파티션 크기를 늘려준다.\"}),\"\\n\",n(l,{children:n(c.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(c.code,{children:e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"sudo\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" growpart\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" /dev/xvda\"}),n(c.span,{style:{color:\"#B48EAD\"},children:\" 1\"})]})})})}),\"\\n\",n(c.p,{children:\"다시 df -h로 확인해 보면 메모리가 여유롭여진 걸 볼 수 있다. 💰\"}),\"\\n\",n(c.h5,{children:\"3) CodeDeploy의 무한 로딩\"}),\"\\n\",n(c.p,{children:\"처음 CodeDeploy를 설정하고 배포를 기다리는데 3분이 넘도록 pending 상태였다. 어떤 에러가 발생하면 고치기라도 하지만 이 경우는 답이 없다. 컴퓨터가 멈추면 어떻게 하시나요? 저는 껐다 켭니다.\"}),\"\\n\",n(l,{children:n(c.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:e(c.code,{children:[e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"sudo\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" systemctl\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" stop\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" codedeploy-agent\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"sudo\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" systemctl\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" start\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" codedeploy-agent\"})]})]})})}),\"\\n\",n(c.p,{children:\"음음. 잘 작동하네요.\"}),\"\\n\",n(c.hr,{}),\"\\n\",n(c.h3,{children:\"7. 이모저모\"}),\"\\n\",n(c.p,{children:\"지금까지 대부분 WebStorm에서 코드를 작성하고, main branch로 PR 한 뒤 ci를 거쳐 정상적인 코드만 병합했다. 자잘한 오타 같은 건 로컬에서 prettier를 통해 잡기도 하고, GitHub Actions에서도 이중으로 잡아주기에 오타는 전혀 신경 쓰지 않았는데... 이번엔 그런 거 없다. 오타로 처절하게 무너졌다.\"}),\"\\n\",e(c.ol,{children:[\"\\n\",n(c.li,{children:\"CodeDeploy의 작동을 설정하는 appspec.yml을 appsepc.yml로 잘못 적음\"}),\"\\n\",n(c.li,{children:\"프로젝트 루트 디렉토리인 waffle_rookie_review가 아니라 rookie_review로 잘못 지정함\"}),\"\\n\",n(c.li,{children:\"Region인 ap-northeast-2를 ap-northeas-2로 오타냄\"}),\"\\n\"]}),\"\\n\",n(c.p,{children:\"이 외에도 기억하지 못하는 숱한 오타가 나를 괴롭혔다. 후...\"}),\"\\n\",n(c.p,{children:\"그리고 패키지 매니저 겸 런타임 환경으로 Bun을 사용하며 어려움이 있었다. 대부분의 블로그들이 npm을 이용하다 보니 설정이나 명령어들이 대부분 npm 기준이었다.\"}),\"\\n\",n(c.p,{children:\"자잘하게 명령어를 고친 것 외에 가장 시간을 많이 먹었던 에러는 자동 배포 후 pm2 동작을 설정하는 ecosystem.config.js의 문제였다. 아무 생각 없이 node.js 환경에서 실행하도록 만들어진 설정을 갖다 쓰니 CI/CD가 끝날 때마다 서버가 터졌다. 로그를 살펴보면\"}),\"\\n\",n(l,{children:n(c.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:e(c.code,{children:[e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"0\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\"|\"}),n(c.span,{style:{color:\"#88C0D0\"},children:\"waffle_r\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\" |\"}),n(c.span,{style:{color:\"#88C0D0\"},children:\"     at\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" TracingChannel.traceSync\"}),n(c.span,{style:{color:\"#D8DEE9FF\"},children:\" (node:diagnostics_channel:322:14)\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"0\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\"|\"}),n(c.span,{style:{color:\"#88C0D0\"},children:\"waffle_r\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\" |\"}),n(c.span,{style:{color:\"#88C0D0\"},children:\"     at\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" wrapModuleLoad\"}),n(c.span,{style:{color:\"#D8DEE9FF\"},children:\" (node:internal/modules/cjs/loader:220:24)\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"0\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\"|\"}),n(c.span,{style:{color:\"#88C0D0\"},children:\"waffle_r\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\" |\"}),n(c.span,{style:{color:\"#88C0D0\"},children:\"     at\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" Module.require\"}),n(c.span,{style:{color:\"#D8DEE9FF\"},children:\" (node:internal/modules/cjs/loader:1311:12)\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"0\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\"|\"}),n(c.span,{style:{color:\"#88C0D0\"},children:\"waffle_r\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\" |\"}),n(c.span,{style:{color:\"#88C0D0\"},children:\"     at\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" require\"}),n(c.span,{style:{color:\"#D8DEE9FF\"},children:\" (node:internal/modules/helpers:136:16)\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"0\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\"|\"}),n(c.span,{style:{color:\"#88C0D0\"},children:\"waffle_r\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\" |\"}),n(c.span,{style:{color:\"#88C0D0\"},children:\"     at\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" Object.\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\"<\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\"anonymou\"}),n(c.span,{style:{color:\"#D8DEE9FF\"},children:\"s\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\">\"}),n(c.span,{style:{color:\"#D8DEE9FF\"},children:\" (/home/ubuntu/waffle_rookie_review/node_modules/.bin/next:6:1)\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"0\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\"|\"}),n(c.span,{style:{color:\"#88C0D0\"},children:\"waffle_r\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\" |\"}),n(c.span,{style:{color:\"#88C0D0\"},children:\"     at\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" Module._compile\"}),n(c.span,{style:{color:\"#D8DEE9FF\"},children:\" (node:internal/modules/cjs/loader:1554:14)\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"0\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\"|\"}),n(c.span,{style:{color:\"#88C0D0\"},children:\"waffle_r\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\" |\"}),n(c.span,{style:{color:\"#88C0D0\"},children:\"     at\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" Object..js\"}),n(c.span,{style:{color:\"#D8DEE9FF\"},children:\" (node:internal/modules/cjs/loader:1706:10)\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"0\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\"|\"}),n(c.span,{style:{color:\"#88C0D0\"},children:\"waffle_r\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\" |\"}),n(c.span,{style:{color:\"#88C0D0\"},children:\"     at\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" Module.load\"}),n(c.span,{style:{color:\"#D8DEE9FF\"},children:\" (node:internal/modules/cjs/loader:1289:32) \"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"0\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\"|\"}),n(c.span,{style:{color:\"#88C0D0\"},children:\"waffle_r\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\" |\"}),n(c.span,{style:{color:\"#88C0D0\"},children:\"   code:\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\" '\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\"MODULE_NOT_FOUND\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\",\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"0\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\"|\"}),n(c.span,{style:{color:\"#88C0D0\"},children:\"waffle_r\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\" |\"}),n(c.span,{style:{color:\"#88C0D0\"},children:\"   requireStack:\"}),n(c.span,{style:{color:\"#D8DEE9FF\"},children:\" [ \"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\"/home/ubuntu/waffle_rookie_review/node_modules/.bin/next\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" ]\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"0\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\"|\"}),n(c.span,{style:{color:\"#88C0D0\"},children:\"waffle_r\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\" |\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:\" }\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"0\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\"|\"}),n(c.span,{style:{color:\"#88C0D0\"},children:\"waffle_r\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\" |\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"0\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\"|\"}),n(c.span,{style:{color:\"#88C0D0\"},children:\"waffle_r\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\" |\"}),n(c.span,{style:{color:\"#88C0D0\"},children:\" Node.js\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" v22.14.0\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"0\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\"|\"}),n(c.span,{style:{color:\"#88C0D0\"},children:\"waffle_r\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\" |\"}),n(c.span,{style:{color:\"#88C0D0\"},children:\" error:\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" script\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:' \"'}),n(c.span,{style:{color:\"#A3BE8C\"},children:\"start\"}),n(c.span,{style:{color:\"#ECEFF4\"},children:'\"'}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" exited\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" with\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" code\"}),n(c.span,{style:{color:\"#B48EAD\"},children:\" 1\"})]}),\"\\n\",e(c.span,{className:\"line\",children:[n(c.span,{style:{color:\"#88C0D0\"},children:\"0\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\"|\"}),n(c.span,{style:{color:\"#88C0D0\"},children:\"waffle_r\"}),n(c.span,{style:{color:\"#81A1C1\"},children:\" |\"}),n(c.span,{style:{color:\"#88C0D0\"},children:\" $\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" next\"}),n(c.span,{style:{color:\"#A3BE8C\"},children:\" start\"})]})]})})}),\"\\n\",n(c.p,{children:\"이런 식으로 node.js의 모듈을 찾을 수 없다고 나타났다. 처음에는\\n'아, pm2가 node.js 환경을 필요로 했었지. 그런데 버전이 22.14네. 뭐야! deploy.yml에는 20.11.1 버전으로 빌드하잖아.'\\n하고 곧장 인스턴스의 node.js 버전을 20.11.1로 지정했다.\"}),\"\\n\",n(c.p,{children:\"그런데도 여전히 문제가 있었다.\"}),\"\\n\",n(c.p,{children:\"프로젝트 루트 디렉토리에서 bun install을 한 뒤 pm2 restart 0으로 애플리케이션을 다시 실행하면 정상 작동되었다. 그럼 의존성 문제인가? 싶은데 node.js 버전을 이야기하고... 하다가 순간 아차 싶었다. 내 런타임 환경은 Bun인데!! interpreter를 bun 경로로 지정해 주니 말끔하게 다시 작동했다.\"}),\"\\n\",n(c.p,{children:\"지나고 보면 너무 당연하고 쉬운 문제인데... 왜 이렇게 오래 돌아갔을까. 그래도 기가막히게 실수하고 시간 낭비하며 제대로 깨우쳤다. 내가 정확히 무슨 환경에서 어떤 명령어로 무엇을 작동시키는지 알게 되었음! 지금처럼 직접 서버까지 건드려보고 시행착오한 뒤에 토이프로젝트를 했으면 훨씬 잘 참여할 수 있었을텐데. 문제가 발생하면 이게 서버쪽 문제인지 프론트쪽 문제인지 알아보려는 노력이라도 할 수 있었을텐데.\"}),\"\\n\",n(c.p,{children:\"그래도 억지로 Bun을 써보며 부딪힌 게 참 잘한 선택인 듯했다. 이게 아니었다면 서버쪽이 어떤 방식으로 돌아가는지 이해하게 만들어준 에러들을 못 만났을테니!\"}),\"\\n\",n(c.hr,{}),\"\\n\",n(c.p,{children:\"이후로 도메인 구매해서 연결하고 https 접속 연결하기... 는 간단할 듯하고 Docker를 한 번 써볼 생각인데, 그 전에 기능을 몇 개 개발한 뒤에 할 생각이다. 간단한 블로그를 구축해보고 싶은데 시간이 되려나 모르겠네.\"})]})}return{default:function(l={}){const{wrapper:e}=l.components||{};return e?n(e,{...l,children:n(_createMdxContent,{...l})}):_createMdxContent(l)}};",
    "permalink": "/development/setup-ci-cd-with-codedeploy-github-actions"
  },
  {
    "title": "Let's learn seq2seq!",
    "description": "Learn how to use seq2seq models using PyTorch",
    "slug": "tutorial-seq2seq",
    "publishDate": "2025-04-12",
    "thumbnailUrl": "/development/tutorial-seq2seq/thum.jpeg",
    "content": "const{Fragment:l,jsx:e,jsxs:n}=arguments[0];function _createMdxContent(s){const c={a:\"a\",code:\"code\",hr:\"hr\",img:\"img\",p:\"p\",pre:\"pre\",span:\"span\",...s.components};return n(l,{children:[e(c.p,{children:\"Recently, I've been studying large language models(LLMs). I understand the algorithms behind what they are and how they work, but I don't have a precise understanding of their implementation.\"}),\"\\n\",e(c.p,{children:\"I'm still pondering the necessity of understanding the basics of LLMs, such as implementation details, architecture, and so on. Since there is so much to learn in the field of LLMs, It's impossible to study everything in depth. However, as an undergraduate student without any immediate obligation to apply them for quick results, I plan to take my time and study step by step - starting with seq2seq, transformer, and other language models.\"}),\"\\n\",n(c.p,{children:[\"This post focuses on the seq2seq model. For learning purposes, I referred to \",e(c.a,{href:\"https://github.com/bentrevett/pytorch-seq2seq\",children:\"seq2seq tutorial link\"}),\".\"]}),\"\\n\",e(c.hr,{}),\"\\n\",e(c.p,{children:\"LSTM is more advanced type of RNN that can retain long-term information better than the original RNN. Unlike RNNs, which only have a hidden state, LSTMs include a cell state - a vector that stores information about the previous state of the LSTM cell.\"}),\"\\n\",e(c.p,{children:\"Leveraging LSTMs, many researchers have developed various techniques for translating one language to another.\"}),\"\\n\",e(c.p,{children:e(c.img,{src:\"/development/tutorial-seq2seq/rnn1.png\",alt:\"\"})}),\"\\n\",e(c.p,{children:\"This is the original RNN architecture. The gray boxes represent cells, which take an input and produce an output, a hidden state, and a cell state.\\nThe mathematical expression is as follows:\"}),\"\\n\",e(c.p,{children:\"(h_t, c_t) = LSTM(e(x_t), h_t-1, c_t-1)\"}),\"\\n\",e(c.p,{children:\"However, the architecture above has a limitation: the dimensions of the inputs and outputs are fixed and identical. This poses a significant challenge for translation tasks, as most languages vary in length when expressing the same meaning.\"}),\"\\n\",n(c.p,{children:[e(c.img,{src:\"/development/tutorial-seq2seq/lstm1.png\",alt:\"\"}),\"\\n\",e(c.img,{src:\"/development/tutorial-seq2seq/lstm2.png\",alt:\"\"})]}),\"\\n\",e(c.p,{children:\"But this paper separates LSTM to two parts: encoder and decoder. Encoder LSTM takes the input sequence and produces a context vector, which has a information about the input sequence. Decoder LSTM takes the context vector and produces output one token at a time.\"}),\"\\n\",e(c.p,{children:e(c.img,{src:\"/development/tutorial-seq2seq/seq2seq1.png\",alt:\"\"})}),\"\\n\",e(c.p,{children:\"the code implementing the paper is as follows (be cautious about the dimensions):\"}),\"\\n\",e(c.p,{children:\"Encoder\"}),\"\\n\",e(l,{children:e(c.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(c.code,{children:[n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"class\"}),e(c.span,{style:{color:\"#8FBCBB\"},children:\" Encoder\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#8FBCBB\",fontWeight:\"bold\"},children:\"nn\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#8FBCBB\",fontWeight:\"bold\"},children:\"Module\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"    def\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\" __init__\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9\"},children:\" input_dim\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9\"},children:\" embedding_dim\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9\"},children:\" hidden_dim\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9\"},children:\" n_layers\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9\"},children:\" dropout\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#88C0D0\"},children:\"        super\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"().\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"__init__\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"()\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"hidden_dim \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" hidden_dim\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"n_layers \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" n_layers\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"embedding \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" nn\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"Embedding\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"input_dim\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" embedding_dim\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"rnn \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" nn\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"LSTM\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"embedding_dim\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" hidden_dim\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" n_layers\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9\"},children:\" dropout\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"dropout\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"dropout \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" nn\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"Dropout\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"dropout\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(c.span,{className:\"line\"}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"    def\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\" forward\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9\"},children:\" src\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # src = [src length, batch size]\"})}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"        embedded \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"dropout\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"embedding\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"src\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"))\"})]}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # embedded = [src length, batch size, embedding dim]\"})}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"        outputs\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\" (\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"hidden\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" cell\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\")\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\" =\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"rnn\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"embedded\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # outputs = [src length, batch size, hidden dim * n directions]\"})}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # hidden = [n layers * n directions, batch size, hidden dim]\"})}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # cell = [n layers * n directions, batch size, hidden dim]\"})}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # outputs are always from the top hidden layer\"})}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"        return\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" hidden\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" cell\"})]})]})})}),\"\\n\",n(c.p,{children:[e(c.code,{children:\"outputs, (hidden, cell) = self.rnn(embedded)\"}),\" represents an input and an output of LSTM structure.\"]}),\"\\n\",e(c.p,{children:\"Decoder\"}),\"\\n\",e(l,{children:e(c.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(c.code,{children:[n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"class\"}),e(c.span,{style:{color:\"#8FBCBB\"},children:\" Decoder\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#8FBCBB\",fontWeight:\"bold\"},children:\"nn\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#8FBCBB\",fontWeight:\"bold\"},children:\"Module\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"    def\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\" __init__\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9\"},children:\" output_dim\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9\"},children:\" embedding_dim\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9\"},children:\" hidden_dim\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9\"},children:\" n_layers\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9\"},children:\" dropout\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#88C0D0\"},children:\"        super\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"().\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"__init__\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"()\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"output_dim \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" output_dim\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"hidden_dim \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" hidden_dim\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"n_layers \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" n_layers\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"embedding \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" nn\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"Embedding\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"output_dim\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" embedding_dim\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"rnn \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" nn\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"LSTM\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"embedding_dim\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" hidden_dim\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" n_layers\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9\"},children:\" dropout\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"dropout\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"fc_out \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" nn\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"Linear\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"hidden_dim\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" output_dim\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"dropout \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" nn\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"Dropout\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"dropout\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(c.span,{className:\"line\"}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"    def\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\" forward\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9\"},children:\" input\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9\"},children:\" hidden\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9\"},children:\" cell\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # input = [batch size]\"})}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # hidden = [n layers * n directions, batch size, hidden dim]\"})}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # cell = [n layers * n directions, batch size, hidden dim]\"})}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # n directions in the decoder will both always be 1, therefore:\"})}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # hidden = [n layers, batch size, hidden dim]\"})}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # context = [n layers, batch size, hidden dim]\"})}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#88C0D0\"},children:\"        input\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\" =\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\" input\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"unsqueeze\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#B48EAD\"},children:\"0\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # input = [1, batch size]\"})}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"        embedded \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"dropout\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"embedding\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"input\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"))\"})]}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # embedded = [1, batch size, embedding dim]\"})}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"        output\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\" (\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"hidden\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" cell\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\")\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\" =\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"rnn\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"embedded\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\" (\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"hidden\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" cell\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"))\"})]}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # output = [seq length, batch size, hidden dim * n directions]\"})}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # hidden = [n layers * n directions, batch size, hidden dim]\"})}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # cell = [n layers * n directions, batch size, hidden dim]\"})}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # seq length and n directions will always be 1 in this decoder, therefore:\"})}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # output = [1, batch size, hidden dim]\"})}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # hidden = [n layers, batch size, hidden dim]\"})}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # cell = [n layers, batch size, hidden dim]\"})}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"        prediction \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"fc_out\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"output\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"squeeze\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#B48EAD\"},children:\"0\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"))\"})]}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # prediction = [batch size, output dim]\"})}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"        return\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" prediction\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" hidden\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" cell\"})]})]})})}),\"\\n\",n(c.p,{children:[e(c.code,{children:\"output, (hidden, cell) = self.rnn(embedded, (hidden, cell))\"}),\" is similar to the one of encoder.\"]}),\"\\n\",e(c.p,{children:\"Model\"}),\"\\n\",e(l,{children:e(c.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(c.code,{children:[n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"class\"}),e(c.span,{style:{color:\"#8FBCBB\"},children:\" Seq2Seq\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#8FBCBB\",fontWeight:\"bold\"},children:\"nn\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#8FBCBB\",fontWeight:\"bold\"},children:\"Module\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"    def\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\" __init__\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9\"},children:\" encoder\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9\"},children:\" decoder\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9\"},children:\" device\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#88C0D0\"},children:\"        super\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"().\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"__init__\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"()\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"encoder \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" encoder\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"decoder \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" decoder\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"device \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" device\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"        assert\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\" (\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"            encoder\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"hidden_dim \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"==\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" decoder\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"hidden_dim\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#ECEFF4\"},children:\"        ),\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:' \"'}),e(c.span,{style:{color:\"#A3BE8C\"},children:\"Hidden dimensions of encoder and decoder must be equal!\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"        assert\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\" (\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"            encoder\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"n_layers \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"==\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" decoder\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"n_layers\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#ECEFF4\"},children:\"        ),\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:' \"'}),e(c.span,{style:{color:\"#A3BE8C\"},children:\"Encoder and decoder must have equal number of layers!\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),\"\\n\",e(c.span,{className:\"line\"}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"    def\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\" forward\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9\"},children:\" src\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9\"},children:\" trg\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9\"},children:\" teacher_forcing_ratio\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # src = [src length, batch size]\"})}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # trg = [trg length, batch size]\"})}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # teacher_forcing_ratio is probability to use teacher forcing\"})}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # e.g. if teacher_forcing_ratio is 0.75 we use ground-truth inputs 75% of the time\"})}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"        batch_size \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" trg\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"shape\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),e(c.span,{style:{color:\"#B48EAD\"},children:\"1\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"]\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"        trg_length \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" trg\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"shape\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),e(c.span,{style:{color:\"#B48EAD\"},children:\"0\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"]\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"        trg_vocab_size \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"decoder\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"output_dim\"})]}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # tensor to store decoder outputs\"})}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"        outputs \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" torch\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"zeros\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"trg_length\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" batch_size\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" trg_vocab_size\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\").\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"to\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"device\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # last hidden state of the encoder is used as the initial hidden state of the decoder\"})}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"        hidden\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" cell \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"encoder\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"src\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # hidden = [n layers * n directions, batch size, hidden dim]\"})}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # cell = [n layers * n directions, batch size, hidden dim]\"})}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # first input to the decoder is the <sos> tokens\"})}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#88C0D0\"},children:\"        input\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\" =\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" trg\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),e(c.span,{style:{color:\"#B48EAD\"},children:\"0\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\" :]\"})]}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # input = [batch size]\"})}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"        for\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" t \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"in\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\" range\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#B48EAD\"},children:\"1\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" trg_length\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"            # insert input token embedding, previous hidden and previous cell states\"})}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"            # receive output tensor (predictions) and new hidden and cell states\"})}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"            output\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" hidden\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" cell \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"decoder\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"input\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" hidden\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" cell\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"            # output = [batch size, output dim]\"})}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"            # hidden = [n layers, batch size, hidden dim]\"})}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"            # cell = [n layers, batch size, hidden dim]\"})}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"            # place predictions in a tensor holding predictions for each token\"})}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"            outputs\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"t\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"]\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\" =\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" output\"})]}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"            # decide if we are going to use teacher forcing or not\"})}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"            teacher_force \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" random\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"random\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"()\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\" <\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" teacher_forcing_ratio\"})]}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"            # get the highest predicted token from our predictions\"})}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"            top1 \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" output\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"argmax\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#B48EAD\"},children:\"1\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"            # if teacher forcing, use actual next token as next input\"})}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"            # if not, use predicted token\"})}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#88C0D0\"},children:\"            input\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\" =\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" trg\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"t\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"]\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\" if\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" teacher_force \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"else\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" top1\"})]}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"            # input = [batch size]\"})}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"        return\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" outputs\"})]})]})})}),\"\\n\",e(c.p,{children:\"I would recommend you to read minutely about the flow of the code, if you are begginer of Neural Network and Language model.\"}),\"\\n\",e(c.hr,{})]})}return{default:function(l={}){const{wrapper:n}=l.components||{};return n?e(n,{...l,children:e(_createMdxContent,{...l})}):_createMdxContent(l)}};",
    "permalink": "/development/tutorial-seq2seq"
  }
]