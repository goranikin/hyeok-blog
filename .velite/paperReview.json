[
  {
    "title": "Attention is all you need",
    "description": "Deep dive into the Transformer architecture, especially the implementation in each layers.",
    "slug": "attention-is-all-you-need",
    "publishDate": "2025-04-13",
    "thumbnailUrl": "/development/attention-is-all-you-need/thum.jpeg",
    "content": "const{Fragment:l,jsx:e,jsxs:n}=arguments[0];function _createMdxContent(s){const r={a:\"a\",code:\"code\",hr:\"hr\",img:\"img\",li:\"li\",ol:\"ol\",p:\"p\",pre:\"pre\",span:\"span\",...s.components};return n(l,{children:[n(r.p,{children:[\"In this post, I will explain the \",e(r.a,{href:\"https://arxiv.org/abs/1706.03762\",children:\"transformer\"}),\" architecture and its implementation at the code level. I referred to a \",e(r.a,{href:\"https://github.com/jadore801120/attention-is-all-you-need-pytorch\",children:\"scratch\"}),\" implementation for the PyTorch code!\"]}),\"\\n\",e(r.p,{children:e(r.img,{src:\"/development/attention-is-all-you-need/1.png\",alt:\"\"})}),\"\\n\",e(r.p,{children:\"The authors of the paper all left Google and founded their own companies, except for Lukasz Kaiser, who joined OpenAI. Five out of the 7 companies have become unicorns, with a combined valuation exceeding $17 billion. It's quite impressive.\"}),\"\\n\",e(r.p,{children:e(r.img,{src:\"/development/attention-is-all-you-need/2.png\",alt:\"\"})}),\"\\n\",e(r.p,{children:\"This is Figure 1 from the paper. It illustrates the overall architecture of the Transformer.\"}),\"\\n\",e(r.p,{children:\"They designed the operation, called Scaled Dot-Product Attention, which calculates the attention scores between query and key vectors to reflect the context information between the tokens.\"}),\"\\n\",e(r.p,{children:\"They represented the formula like this.\"}),\"\\n\",e(r.p,{children:e(r.img,{src:\"/development/attention-is-all-you-need/3.png\",alt:\"\"})}),\"\\n\",e(r.p,{children:\"How can we implement Scaled Dot-Product Attention in PyTorch? Let's start from scratch.\"}),\"\\n\",e(l,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(r.code,{children:[n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"class\"}),e(r.span,{style:{color:\"#8FBCBB\"},children:\" ScaledDotProductAttention\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#8FBCBB\",fontWeight:\"bold\"},children:\"nn\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#8FBCBB\",fontWeight:\"bold\"},children:\"Module\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"    def\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" __init__\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" temperature\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" attn_dropout\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"0.1\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"        super\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"().\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"__init__\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"()\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"temperature \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" temperature\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"dropout \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" nn\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"Dropout\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"attn_dropout\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"    def\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" forward\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" q\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" k\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" v\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" mask\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=None\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",e(r.span,{className:\"line\",children:e(r.span,{style:{color:\"#616E88\"},children:\"        # q = [batch_size, n_head, len_q, d_k]\"})}),\"\\n\",e(r.span,{className:\"line\",children:e(r.span,{style:{color:\"#616E88\"},children:\"        # k = [batch_size, n_head, len_k, d_k]\"})}),\"\\n\",e(r.span,{className:\"line\",children:e(r.span,{style:{color:\"#616E88\"},children:\"        # v = [batch_size, n_head, len_k, d_v]\"})}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        attn \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" torch\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"matmul\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"q \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"/\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"temperature\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" k\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"transpose\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"2\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 3\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"))\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        if\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" mask \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"is\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" not\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" None\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"            attn \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" attn\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"masked_fill\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"mask \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"==\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 0\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" -\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"1e9\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        attn \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"dropout\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"F\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"softmax\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"attn\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" dim\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=-\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"1\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"))\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        output \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" torch\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"matmul\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"attn\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" v\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        return\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" output\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" attn\"})]})]})})}),\"\\n\",n(r.p,{children:[\"The original method uses the square root of \",e(r.code,{children:\"d_model\"}),\" for normalization, but this approach uses a learnable temperature parameter during training. A higher temperature value results in a more uniform attention distribution.\"]}),\"\\n\",n(r.p,{children:[e(r.code,{children:\"attn\"}),\" has a shape \",e(r.code,{children:\"[batch_size, n_head, len_q, len_k]\"}),\", which represents the attention scores between query and key vectors. For example, \",e(r.code,{children:\"a[:,:,1,2]\"}),\" is the attention score between the first query vector and the second key vector.\"]}),\"\\n\",e(r.p,{children:\"A mask is applied to ignore padding tokens in the sequence for efficiency and to ensure that self-attention in the decoder does not reference future tokens.\"}),\"\\n\",n(r.p,{children:[\"The output has a shape of \",e(r.code,{children:\"[batch_size, n_head, len_q, d_v]\"})]}),\"\\n\",e(r.p,{children:\"This is just one module used in the Multi-Head attention mechanism.\"}),\"\\n\",e(r.p,{children:e(r.img,{src:\"/development/attention-is-all-you-need/4.png\",alt:\"\"})}),\"\\n\",e(l,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(r.code,{children:[n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"class\"}),e(r.span,{style:{color:\"#8FBCBB\"},children:\" MultiHeadAttention\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#8FBCBB\",fontWeight:\"bold\"},children:\"nn\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#8FBCBB\",fontWeight:\"bold\"},children:\"Module\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"    def\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" __init__\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" n_head\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" d_model\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" d_k\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" d_v\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" dropout\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"0.1\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"        super\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"().\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"__init__\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"()\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"n_head \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" n_head\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"d_k \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" d_k\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"d_v \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" d_v\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"w_qs \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" nn\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"Linear\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"d_model\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" n_head \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"*\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" d_k\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" bias\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=False\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"w_ks \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" nn\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"Linear\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"d_model\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" n_head \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"*\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" d_k\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" bias\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=False\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"w_vs \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" nn\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"Linear\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"d_model\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" n_head \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"*\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" d_v\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" bias\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=False\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"fc \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" nn\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"Linear\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"n_head \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"*\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" d_v\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" d_model\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" bias\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=False\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"attention \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" ScaledDotProductAttention\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\"temperature\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"d_k \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"**\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 0.5\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"dropout \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" nn\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"Dropout\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"dropout\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"layer_norm \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" nn\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"LayerNorm\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"d_model\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" eps\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"1e-6\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"    def\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" forward\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" q\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" k\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" v\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" mask\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=None\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",e(r.span,{className:\"line\",children:e(r.span,{style:{color:\"#616E88\"},children:\"        # q = [batch_size, len_q, d_model]\"})}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        d_k\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" d_v\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" n_head \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"d_k\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"d_v\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"n_head\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        sz_b\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" len_q\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" len_k\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" len_v \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" q\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"size\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"0\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"),\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" q\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"size\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"1\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"),\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" k\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"size\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"1\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"),\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" v\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"size\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"1\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        residual \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" q \"}),e(r.span,{style:{color:\"#616E88\"},children:\"# enc_input\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",e(r.span,{className:\"line\",children:e(r.span,{style:{color:\"#616E88\"},children:\"        # Separate different heads: [batch, len, n_head, d] (d_model / n_head = d_k)\"})}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        q \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"w_qs\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"q\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\").\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"view\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"sz_b\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" len_q\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" n_head\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" d_k\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        k \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"w_ks\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"k\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\").\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"view\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"sz_b\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" len_k\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" n_head\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" d_k\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        v \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"w_vs\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"v\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\").\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"view\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"sz_b\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" len_v\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" n_head\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" d_v\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",e(r.span,{className:\"line\",children:e(r.span,{style:{color:\"#616E88\"},children:\"        # Transpose for attention dot product: [batch, len, n_head, d]\"})}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        q\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" k\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" v \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" q\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"transpose\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"1\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 2\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"),\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" k\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"transpose\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"1\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 2\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"),\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" v\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"transpose\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"1\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 2\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        if\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" mask \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"is\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" not\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" None\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\":\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"            mask \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" mask\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"unsqueeze\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"1\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        q\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" attn \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"attention\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"q\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" k\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" v\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" mask\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"mask\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",e(r.span,{className:\"line\",children:e(r.span,{style:{color:\"#616E88\"},children:\"        # Transpose to move the head dimension back: b x lq x n x dv\"})}),\"\\n\",e(r.span,{className:\"line\",children:e(r.span,{style:{color:\"#616E88\"},children:\"        # Combine the last two dimensions to concatenate all the heads together: b x lq x (n*dv)\"})}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        q \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" q\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"transpose\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"1\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\" 2\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\").\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"contiguous\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"().\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"view\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"sz_b\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" len_q\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" -\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"1\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        q \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"dropout\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"fc\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"q\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"))\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",e(r.span,{className:\"line\",children:e(r.span,{style:{color:\"#616E88\"},children:\"        # LayerNorm(x + Sublayer(x))\"})}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        q \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"+=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" residual\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        q \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"layer_norm\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"q\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        return\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" q\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" attn\"})]})]})})}),\"\\n\",n(r.p,{children:[\"Wait, what is the layer function? And what does \",e(r.code,{children:\"fc\"}),\" mean? I recommend reading \",e(r.a,{href:\"https://thecho7.tistory.com/entry/PyTorch-nnLinear%EC%97%90-%EB%8C%80%ED%95%9C-%EC%A7%88%EB%AC%B8\",children:\"pytorch layer\"}),\" (this is a Korean blog), which provides a concise explanation.\"]}),\"\\n\",n(r.p,{children:[\"The Multi-Head Attention mechanism takes parameters \",e(r.code,{children:\"q\"}),\", \",e(r.code,{children:\"k\"}),\", and \",e(r.code,{children:\"v\"}),\". In practice, all of them are derived from the same input \",e(r.code,{children:\"x\"}),\". This is why the residual connection is applied to \",e(r.code,{children:\"q\"}),\".\"]}),\"\\n\",n(r.p,{children:[\"After performing Scaled Dot-Product attention and applying \",e(r.code,{children:\"transpose(1, 2).contiguous().view(sz_b, len_q, -1)\"}),\", \",e(r.code,{children:\"q\"}),\" has a shape of \",e(r.code,{children:\"[sz_batch, len_q, n_head * d_v]\"}),\". In the original architecture, \",e(r.code,{children:\"d_v = d_k\"}),\", but when \",e(r.code,{children:\"d_v != d_k\"}),\", it ensures that the output and input dimensions of the \",e(r.code,{children:\"fc\"}),\" layer remain consistent.\"]}),\"\\n\",e(l,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(r.code,{children:[n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"class\"}),e(r.span,{style:{color:\"#8FBCBB\"},children:\" PositionwiseFeedForward\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#8FBCBB\",fontWeight:\"bold\"},children:\"nn\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#8FBCBB\",fontWeight:\"bold\"},children:\"Module\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"    def\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" __init__\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" d_in\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" d_hid\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" dropout\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"0.1\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"        super\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"().\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"__init__\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"()\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"w_1 \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" nn\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"Linear\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"d_in\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" d_hid\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"w_2 \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" nn\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"Linear\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"d_hid\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" d_in\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"layer_norm \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" nn\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"LayerNorm\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"d_in\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" eps\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"1e-6\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"dropout \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" nn\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"Dropout\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"dropout\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"    def\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" forward\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" x\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        residual \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" x\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        x \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"w_2\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"F\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"relu\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"w_1\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"x\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")))\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        x \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"dropout\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"x\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        x \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"+=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" residual\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        x \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"layer_norm\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"x\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        return\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" x\"})]})]})})}),\"\\n\",e(r.p,{children:\"This is Feed Forward Network. It is a simple linear transformation followed by a ReLU activation function and a dropout layer.\"}),\"\\n\",e(l,{children:e(r.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(r.code,{children:[n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"class\"}),e(r.span,{style:{color:\"#8FBCBB\"},children:\" EncoderLayer\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#8FBCBB\",fontWeight:\"bold\"},children:\"nn\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#8FBCBB\",fontWeight:\"bold\"},children:\"Module\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"    def\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" __init__\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" d_model\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" d_inner\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" n_head\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" d_k\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" d_v\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" dropout\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"0.1\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"        super\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"().\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"__init__\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"()\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"slf_attn \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" MultiHeadAttention\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"n_head\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" d_model\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" d_k\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" d_v\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" dropout\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"dropout\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"pos_ffn \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" PositionwiseFeedForward\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"d_model\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" d_inner\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" dropout\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"dropout\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"    def\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" forward\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" enc_input\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" slf_attn_mask\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=None\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        enc_output\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" enc_slf_attn \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"slf_attn\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"            enc_input\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" enc_input\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" enc_input\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" mask\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"slf_attn_mask\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        enc_output \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"pos_ffn\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"enc_output\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        return\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" enc_output\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" enc_slf_attn\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"class\"}),e(r.span,{style:{color:\"#8FBCBB\"},children:\" DecoderLayer\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#8FBCBB\",fontWeight:\"bold\"},children:\"nn\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#8FBCBB\",fontWeight:\"bold\"},children:\"Module\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"    def\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" __init__\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" d_model\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" d_inner\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" n_head\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" d_k\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" d_v\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" dropout\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#B48EAD\"},children:\"0.1\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#88C0D0\"},children:\"        super\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"().\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"__init__\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"()\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"slf_attn \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" MultiHeadAttention\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"n_head\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" d_model\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" d_k\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" d_v\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" dropout\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"dropout\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"enc_attn \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" MultiHeadAttention\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"n_head\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" d_model\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" d_k\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" d_v\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" dropout\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"dropout\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"pos_ffn \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" PositionwiseFeedForward\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"d_model\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" d_inner\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" dropout\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"dropout\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"    def\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\" forward\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" dec_input\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" enc_output\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" self_attn_mask\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=None\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" dec_enc_attn_mask\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=None\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        dec_output\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" dec_slf_attn \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"slf_attn\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"            dec_input\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" dec_input\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" dec_input\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" mask\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"self_attn_mask\"})]}),\"\\n\",e(r.span,{className:\"line\",children:e(r.span,{style:{color:\"#ECEFF4\"},children:\"        )\"})}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        dec_output\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" dec_enc_attn \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"enc_attn\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"})]}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"            dec_output\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" enc_output\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" enc_output\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9\"},children:\" mask\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"dec_enc_attn_mask\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"        dec_output \"}),e(r.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(r.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(r.span,{style:{color:\"#88C0D0\"},children:\"pos_ffn\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\"dec_output\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(r.span,{className:\"line\"}),\"\\n\",n(r.span,{className:\"line\",children:[e(r.span,{style:{color:\"#81A1C1\"},children:\"        return\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" dec_output\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" dec_slf_attn\"}),e(r.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(r.span,{style:{color:\"#D8DEE9FF\"},children:\" dec_enc_attn\"})]})]})})}),\"\\n\",n(r.p,{children:[\"In fact, the Encoder and Decoder are straightforward implementations of their respective layers. It's more an algorithmic problem - determining where to provide the input and how to obtain the output. Therefore, I'll skip the following code snippets. If you want to a deeper dive into the Transformer code, please refer to the \",e(r.a,{href:\"https://github.com/jadore801120/attention-is-all-you-need-pytorch\",children:\"scratch\"}),\".\"]}),\"\\n\",e(r.hr,{}),\"\\n\",e(r.p,{children:\"reference\"}),\"\\n\",n(r.ol,{children:[\"\\n\",n(r.li,{children:[\"Attention is all you need: \",e(r.a,{href:\"https://arxiv.org/abs/1706.03762\",children:\"https://arxiv.org/abs/1706.03762\"})]}),\"\\n\",n(r.li,{children:[\"transformer code: \",e(r.a,{href:\"https://github.com/jadore801120/attention-is-all-you-need-pytorch\",children:\"https://github.com/jadore801120/attention-is-all-you-need-pytorch\"})]}),\"\\n\"]}),\"\\n\",e(r.hr,{})]})}return{default:function(l={}){const{wrapper:n}=l.components||{};return n?e(n,{...l,children:e(_createMdxContent,{...l})}):_createMdxContent(l)}};",
    "permalink": "/study/paper-review/attention-is-all-you-need"
  },
  {
    "title": "Reading papers",
    "description": "Read papers about MT-DNN, MASS, UNILM, XLNet, RoBERTa, ALBERT.",
    "slug": "reading-papers",
    "publishDate": "2025-04-27",
    "thumbnailUrl": "/development/reading-papers-1/thum.jpeg",
    "content": "const{Fragment:e,jsx:n,jsxs:t}=arguments[0];function _createMdxContent(r){const i={a:\"a\",blockquote:\"blockquote\",hr:\"hr\",img:\"img\",p:\"p\",...r.components};return t(e,{children:[n(i.p,{children:\"During my previous studies, I examined research papers on various language models, including seq2seq, Transformer, and BERT (though I didn't write about BERT). My objective is gaining knowledge in the LLM field and also have an assignment requiring me to create a video presentation explaining the concepts I've learned in class to my peers. Previous posts are the result of the assignment. Therefore, this post will be too. :D\"}),\"\\n\",n(i.p,{children:\"This post covers MT-DNN, MASS, UNILM, XLNet, RoBERTa and ALBERT. I won't describe the details of each model, but rather focus on the fundamental concepts (due to my schedule :p).\"}),\"\\n\",n(i.hr,{}),\"\\n\",t(i.p,{children:[n(i.a,{href:\"https://arxiv.org/abs/1901.11504\",children:\"MT-DNN\"}),\" (Multi-Task Deep Neural Networks for natural language understanding)\"]}),\"\\n\",n(i.p,{children:n(i.img,{src:\"/development/reading-papers-1/1.png\",alt:\"\"})}),\"\\n\",n(i.p,{children:\"In abstract, there is a key purpose of MT-DNN.\"}),\"\\n\",t(i.blockquote,{children:[\"\\n\",n(i.p,{children:\"MT-DNN not only leverages large amounts of cross-task data, but also benefits from a regularization effect that leads to more general representations to help adapt to new tasks and domains.\"}),\"\\n\"]}),\"\\n\",n(i.p,{children:\"And in the introduction, they explain the motivation behind MT-DNN, which is the basic principle of transfer learning.\"}),\"\\n\",t(i.blockquote,{children:[\"\\n\",n(i.p,{children:\"Multi-Task Learning (MTL) is inspired by human learning activities where people often apply the knowledge learned from previous tasks to help learn a new task (Caruana, 1997; Zhang and Yang, 2017). For example, it is easier for a person who knows how to ski to learn skating than the one who does not.\"}),\"\\n\"]}),\"\\n\",n(i.p,{children:\"They propose a diverse range of tasks to train the model:\"}),\"\\n\",n(i.p,{children:n(i.img,{src:\"/development/reading-papers-1/2.png\",alt:\"\"})}),\"\\n\",n(i.p,{children:\"However, I think the intricate details of these tasks are not essential for my current understanding. At this point, I'm focused on grasping the fundamental concepts rather than delving too deeply into the specifics.\"}),\"\\n\",t(i.p,{children:[\"The benchmark is following:\\n\",n(i.img,{src:\"/development/reading-papers-1/3.png\",alt:\"\"})]}),\"\\n\",n(i.hr,{}),\"\\n\",t(i.p,{children:[n(i.a,{href:\"https://arxiv.org/abs/1905.02450\",children:\"MASS\"}),\" (MAsked Sequence to Sequence learning)\"]}),\"\\n\",n(i.p,{children:\"In abstract:\"}),\"\\n\",t(i.blockquote,{children:[\"\\n\",n(i.p,{children:\"its encoder takes a sentence with randomly masked fragment (several consecutive tokens) as input, and its decoder tries to predict this masked fragment. In this way, MASS can jointly train the encoder and decoder to develop the capability of representation extraction and language modeling. In this paper, inspired by BERT, we propose a novel objective for pre-training: MAsked Sequence to Sequence learning (MASS) for language generation.\"}),\"\\n\"]}),\"\\n\",t(i.p,{children:[\"What does that mean? See the figure below:\\n\",n(i.img,{src:\"/development/reading-papers-1/4.png\",alt:\"\"})]}),\"\\n\",n(i.p,{children:\"MASS masks continuous sequences of tokens within the source sentence. Subsequently, the decoder predicts these masked tokens, generating the output seqeuntially, one token at a time.\"}),\"\\n\",t(i.p,{children:[\"This provides a detailed mathematical formulation representing the loss function derived from the log-likelihood function:\\n\",n(i.img,{src:\"/development/reading-papers-1/5.png\",alt:\"\"})]}),\"\\n\",t(i.p,{children:[\"Researchers assert that, under specific constraint condtions, MASS can effectively function as both BERT and GPT architectures.\\n\",n(i.img,{src:\"/development/reading-papers-1/6.png\",alt:\"\"})]}),\"\\n\",n(i.p,{children:\"However, MASS is the encoder-decoder framework to generate tokens and there is a cross-attention between the encoder and decoder. It is the fundamental difference from BERT (which is a single encoder architecture) and GPT (which is a single decoder architecture).\"}),\"\\n\",n(i.hr,{}),\"\\n\",t(i.p,{children:[n(i.a,{href:\"https://arxiv.org/abs/1905.03197\",children:\"UNILM\"}),\" (UNIfied Language Model pre-training for natural language understanding and generation)\"]}),\"\\n\",n(i.p,{children:n(i.img,{src:\"/development/reading-papers-1/7.png\",alt:\"\"})}),\"\\n\",n(i.p,{children:\"The authors describe UNILM's foundational architecture as a 'multi-layer Transformer network'.\"}),\"\\n\",n(i.p,{children:\"However, upon examination of Figure 1, it appears identical to the encoder layer of a standard Transformer. (In fact, its architecture is precisely that of BERT Large.)\"}),\"\\n\",n(i.p,{children:n(i.img,{src:\"/development/reading-papers-1/8.png\",alt:\"\"})}),\"\\n\",n(i.p,{children:\"They implement a strategy that emulates language modeling techniques through the strategic manipulation of self-attention masks.\"}),\"\\n\",t(i.blockquote,{children:[\"\\n\",n(i.p,{children:\"Specifically, within one training batch, 1/3 of the time we use the bidirectional LM objective, 1/3 of the time we employ the sequence-to-sequence LM objective, and both left-to-right and right-to-left LM objectives are sampled with rate of 1/6.\"}),\"\\n\"]}),\"\\n\",n(i.hr,{}),\"\\n\",t(i.p,{children:[n(i.a,{href:\"https://arxiv.org/abs/1906.08237\",children:\"XLNet\"}),\" (XLNet: Generalized Autoregressive Pretraining for Language Understanding)\"]}),\"\\n\",n(i.p,{children:n(i.img,{src:\"/development/reading-papers-1/9.png\",alt:\"\"})}),\"\\n\",n(i.p,{children:\"The name 'XLNet does not appear explicitly in the paper's title. However, the authors clarify the origin of this designation in the abstract.\"}),\"\\n\",t(i.blockquote,{children:[\"\\n\",n(i.p,{children:\"XLNet integrates ideas from Transformer-XL, the state-of-the-art autoregressive model, into pretraining.\"}),\"\\n\"]}),\"\\n\",n(i.p,{children:\"The nomenclature derives from their inspiration by Transformer-XL\"}),\"\\n\",n(i.p,{children:\"What are the distinctive characteristics of this approach?\"}),\"\\n\",t(i.blockquote,{children:[\"\\n\",n(i.p,{children:\"we propose XLNet, a generalized autoregressive pretraining method that (1) enables learning bidirectional contexts by maximizing the expected likelihood over all permutations of the factorization order and (2) overcomes the limitations of BERT thanks to its autoregressive formulation.\"}),\"\\n\"]}),\"\\n\",n(i.p,{children:\"They propose an enhanced pre-training methodology that leverages permutations of token order. How exactly does this mechanism function?\"}),\"\\n\",n(i.p,{children:n(i.img,{src:\"/development/reading-papers-1/10.png\",alt:\"\"})}),\"\\n\",n(i.p,{children:\"(a) shows the normal self-attention mechanism, and (b) shows the permutation self-attention what the researchers claim.\"}),\"\\n\",n(i.p,{children:\"For instance, consider the sentence 'New York is a city' which would be masked as '[Mask] [Mask] is a city' in traditional pre-training. BERT's approach involves predicting 'New' and 'York' independently, calculating p(New | is a city) and p(York | is a city) separately. In contrast, XLNet employs a sequential prediction method: first calculating p(New | is a city), then p(York | New, is a city), thereby effectively capturing the relationship between 'New' and 'York'.\\\"\"}),\"\\n\",n(i.p,{children:n(i.img,{src:\"/development/reading-papers-1/12.png\",alt:\"\"})}),\"\\n\",n(i.p,{children:\"For those familiar with the inherent limitations of transformer architectures, particularly their substantial computational overhead, it comes as no surprise that XLNet inherits these same challenges. The authors were acutely aware of this computational burden.\"}),\"\\n\",t(i.blockquote,{children:[\"\\n\",n(i.p,{children:\"While the permutation language modeling objective (3) has several benefits, it is a much more challenging optimization problem due to the permutation and causes slow convergence in preliminary experiments. To reduce the optimization difficulty, we choose to only predict the last tokens in a factorization order.\"}),\"\\n\"]}),\"\\n\",n(i.p,{children:n(i.img,{src:\"/development/reading-papers-1/11.png\",alt:\"\"})}),\"\\n\",n(i.p,{children:\"To mitigate this issue, they strategically implemented the permutation method on only a subset of the sequence, rather than applying it exhaustively.\"}),\"\\n\",n(i.hr,{}),\"\\n\",n(i.p,{children:n(i.a,{href:\"https://arxiv.org/abs/1907.11692\",children:\"RoBERTa\"})}),\"\\n\",n(i.p,{children:n(i.img,{src:\"/development/reading-papers-1/13.png\",alt:\"\"})}),\"\\n\",n(i.p,{children:\"In abstract:\"}),\"\\n\",t(i.blockquote,{children:[\"\\n\",n(i.p,{children:\"hyperparameter choices have significant impact on the final results. We present a replication study of BERT pretraining (Devlin et al., 2019) that carefully measures the impact of many key hyperparameters and training data size.\"}),\"\\n\"]}),\"\\n\",n(i.p,{children:\"So... the RoBERTa paper represents the better hyperparameter optimization. Our professor emphasized that despite its seemingly straightforward tuning methodology, this research emerged during a period saturated with numerous approaches and architectural innovations aimed at enhancing LLM performance. I concur with this assessment, as my review of several related papers reveals a predominant focus on architectural innovations.\"}),\"\\n\",n(i.p,{children:\"From this perspective, the authors assert the following:\"}),\"\\n\",t(i.blockquote,{children:[\"\\n\",n(i.p,{children:\"We find that BERT was significantly undertrained, and can match or exceed the performance of every model published after it.\"}),\"\\n\"]}),\"\\n\",n(i.p,{children:\"They also implement an masking strategy called dynamic masking, which randomly masks tokens throughout the training process rather than consistently masking identical token positions.\"}),\"\\n\",n(i.p,{children:\"Intuitively, as most would likely concur, dynamic masking appears inherently more effective than static masking approaches. However, the empirical results indicate:\"}),\"\\n\",n(i.p,{children:n(i.img,{src:\"/development/reading-papers-1/14.png\",alt:\"\"})}),\"\\n\",t(i.blockquote,{children:[\"\\n\",n(i.p,{children:\"We find that our reimplementation with static masking performs similar to the original BERT model, and dynamic masking is comparable or slightly better than static masking.\"}),\"\\n\"]}),\"\\n\",n(i.p,{children:\":D\"}),\"\\n\",n(i.p,{children:\"The followings are all approaches:\"}),\"\\n\",t(i.blockquote,{children:[\"\\n\",n(i.p,{children:\"Specifically, RoBERTa is trained with\\ndynamic masking (Section 4.1)\\nFULL-SENTENCES without NSP loss (Section 4.2)\\nlarge mini-batches (Section 4.3)\\na larger byte-level BPE (Section 4.4)\"}),\"\\n\"]}),\"\\n\",n(i.p,{children:n(i.img,{src:\"/development/reading-papers-1/15.png\",alt:\"\"})}),\"\\n\",n(i.p,{children:\"And they assert that BPE has advantages although it doesn't show a better performance.\"}),\"\\n\",t(i.blockquote,{children:[\"\\n\",n(i.p,{children:\"Early experiments revealed only slight differences between these encodings, with the Radford et al. (2019) BPE achieving slightly worse end-task performance on some tasks. Nevertheless, we believe the advantages of a universal encoding scheme outweighs the minor degredation in performance and use this encoding in the remainder of our experiments. A more detailed comparison of these encodings is left to future work.\"}),\"\\n\"]}),\"\\n\",n(i.hr,{}),\"\\n\",n(i.p,{children:n(i.a,{href:\"https://arxiv.org/abs/1909.11942\",children:\"ALBERT\"})}),\"\\n\",n(i.p,{children:n(i.img,{src:\"/development/reading-papers-1/16.png\",alt:\"\"})}),\"\\n\",n(i.p,{children:\"In abstract:\"}),\"\\n\",t(i.blockquote,{children:[\"\\n\",n(i.p,{children:\"we present two parameter reduction techniques to lower memory consumption and increase the training speed of BERT (Devlin et al., 2019). Comprehensive empirical evidence shows that our proposed methods lead to models that scale much better compared to the original BERT.\"}),\"\\n\"]}),\"\\n\",n(i.p,{children:\"I'll just introduce the methodologies of ALBERT brifely.\"}),\"\\n\",t(i.blockquote,{children:[\"\\n\",n(i.p,{children:\"The first one is a factorized embedding parameterization. By decomposing the large vocabulary embedding matrix into two small matrices, we separate the size of the hidden layers from the size of vocabulary embedding.\"}),\"\\n\"]}),\"\\n\",t(i.blockquote,{children:[\"\\n\",n(i.p,{children:\"The second technique is cross-layer parameter sharing. This technique prevents the parameter from growing with the depth of the network.\"}),\"\\n\"]}),\"\\n\",n(i.p,{children:\"These approaches yield efficiency gains:\"}),\"\\n\",t(i.blockquote,{children:[\"\\n\",n(i.p,{children:\"An ALBERT configuration similar to BERT-large has 18x fewer parameters and can be trained about 1.7x faster.\"}),\"\\n\"]}),\"\\n\",t(i.p,{children:[\"The first one:\\n\",n(i.img,{src:\"/development/reading-papers-1/18.png\",alt:\"\"})]}),\"\\n\",t(i.blockquote,{children:[\"\\n\",n(i.p,{children:\"Therefore, for ALBERT we use a factorization of the embedding parameters, decomposing them into two smaller matrices. Instead of projecting the one-hot vectors directly into the hidden space of size H, we first project them into a lower dimensional embedding space of size E, and then project it to the hidden space. By using this decomposition, we reduce the embedding parameters from O(V  H) to O(V  E + E  H).\"}),\"\\n\"]}),\"\\n\",t(i.p,{children:[\"The second:\\n\",n(i.img,{src:\"/development/reading-papers-1/17.png\",alt:\"\"})]}),\"\\n\",t(i.blockquote,{children:[\"\\n\",n(i.p,{children:\"We observe that the transitions from layer to layer are much smoother for ALBERT than for BERT. These results show that weight-sharing has an effect on stabilizing network parameters. Although there is a drop for both metrics compared to BERT, they nevertheless do not converge to 0 even after 24 layers. This shows that the solution space for ALBERT parameters is very different from the one found by DQE. Although there is a drop for both metrics compared to BERT, they nevertheless do not converge to 0 even after 24 layers. This shows that the solution space for ALBERT parameters is very different from the one found by DQE.\"}),\"\\n\"]}),\"\\n\",n(i.hr,{})]})}return{default:function(e={}){const{wrapper:t}=e.components||{};return t?n(t,{...e,children:n(_createMdxContent,{...e})}):_createMdxContent(e)}};",
    "permalink": "/study/paper-review/reading-papers"
  },
  {
    "title": "Let's learn seq2seq!",
    "description": "Learn how to use seq2seq models using PyTorch",
    "slug": "tutorial-seq2seq",
    "publishDate": "2025-04-12",
    "thumbnailUrl": "/development/tutorial-seq2seq/thum.jpeg",
    "content": "const{Fragment:l,jsx:e,jsxs:n}=arguments[0];function _createMdxContent(s){const c={a:\"a\",code:\"code\",hr:\"hr\",img:\"img\",p:\"p\",pre:\"pre\",span:\"span\",...s.components};return n(l,{children:[e(c.p,{children:\"Recently, I've been studying large language models(LLMs). I understand the algorithms behind what they are and how they work, but I don't have a precise understanding of their implementation.\"}),\"\\n\",e(c.p,{children:\"I'm still pondering the necessity of understanding the basics of LLMs, such as implementation details, architecture, and so on. Since there is so much to learn in the field of LLMs, It's impossible to study everything in depth. However, as an undergraduate student without any immediate obligation to apply them for quick results, I plan to take my time and study step by step - starting with seq2seq, transformer, and other language models.\"}),\"\\n\",n(c.p,{children:[\"This post focuses on the seq2seq model. For learning purposes, I referred to \",e(c.a,{href:\"https://github.com/bentrevett/pytorch-seq2seq\",children:\"seq2seq tutorial link\"}),\".\"]}),\"\\n\",e(c.hr,{}),\"\\n\",e(c.p,{children:\"LSTM is more advanced type of RNN that can retain long-term information better than the original RNN. Unlike RNNs, which only have a hidden state, LSTMs include a cell state - a vector that stores information about the previous state of the LSTM cell.\"}),\"\\n\",e(c.p,{children:\"Leveraging LSTMs, many researchers have developed various techniques for translating one language to another.\"}),\"\\n\",e(c.p,{children:e(c.img,{src:\"/development/tutorial-seq2seq/rnn1.png\",alt:\"\"})}),\"\\n\",e(c.p,{children:\"This is the original RNN architecture. The gray boxes represent cells, which take an input and produce an output, a hidden state, and a cell state.\\nThe mathematical expression is as follows:\"}),\"\\n\",e(c.p,{children:\"(h_t, c_t) = LSTM(e(x_t), h_t-1, c_t-1)\"}),\"\\n\",e(c.p,{children:\"However, the architecture above has a limitation: the dimensions of the inputs and outputs are fixed and identical. This poses a significant challenge for translation tasks, as most languages vary in length when expressing the same meaning.\"}),\"\\n\",n(c.p,{children:[e(c.img,{src:\"/development/tutorial-seq2seq/lstm1.png\",alt:\"\"}),\"\\n\",e(c.img,{src:\"/development/tutorial-seq2seq/lstm2.png\",alt:\"\"})]}),\"\\n\",e(c.p,{children:\"But this paper separates LSTM to two parts: encoder and decoder. Encoder LSTM takes the input sequence and produces a context vector, which has a information about the input sequence. Decoder LSTM takes the context vector and produces output one token at a time.\"}),\"\\n\",e(c.p,{children:e(c.img,{src:\"/development/tutorial-seq2seq/seq2seq1.png\",alt:\"\"})}),\"\\n\",e(c.p,{children:\"the code implementing the paper is as follows (be cautious about the dimensions):\"}),\"\\n\",e(c.p,{children:\"Encoder\"}),\"\\n\",e(l,{children:e(c.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(c.code,{children:[n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"class\"}),e(c.span,{style:{color:\"#8FBCBB\"},children:\" Encoder\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#8FBCBB\",fontWeight:\"bold\"},children:\"nn\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#8FBCBB\",fontWeight:\"bold\"},children:\"Module\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"    def\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\" __init__\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9\"},children:\" input_dim\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9\"},children:\" embedding_dim\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9\"},children:\" hidden_dim\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9\"},children:\" n_layers\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9\"},children:\" dropout\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#88C0D0\"},children:\"        super\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"().\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"__init__\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"()\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"hidden_dim \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" hidden_dim\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"n_layers \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" n_layers\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"embedding \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" nn\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"Embedding\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"input_dim\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" embedding_dim\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"rnn \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" nn\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"LSTM\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"embedding_dim\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" hidden_dim\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" n_layers\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9\"},children:\" dropout\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"dropout\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"dropout \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" nn\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"Dropout\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"dropout\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(c.span,{className:\"line\"}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"    def\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\" forward\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9\"},children:\" src\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # src = [src length, batch size]\"})}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"        embedded \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"dropout\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"embedding\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"src\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"))\"})]}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # embedded = [src length, batch size, embedding dim]\"})}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"        outputs\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\" (\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"hidden\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" cell\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\")\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\" =\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"rnn\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"embedded\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # outputs = [src length, batch size, hidden dim * n directions]\"})}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # hidden = [n layers * n directions, batch size, hidden dim]\"})}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # cell = [n layers * n directions, batch size, hidden dim]\"})}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # outputs are always from the top hidden layer\"})}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"        return\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" hidden\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" cell\"})]})]})})}),\"\\n\",n(c.p,{children:[e(c.code,{children:\"outputs, (hidden, cell) = self.rnn(embedded)\"}),\" represents an input and an output of LSTM structure.\"]}),\"\\n\",e(c.p,{children:\"Decoder\"}),\"\\n\",e(l,{children:e(c.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(c.code,{children:[n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"class\"}),e(c.span,{style:{color:\"#8FBCBB\"},children:\" Decoder\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#8FBCBB\",fontWeight:\"bold\"},children:\"nn\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#8FBCBB\",fontWeight:\"bold\"},children:\"Module\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"    def\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\" __init__\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9\"},children:\" output_dim\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9\"},children:\" embedding_dim\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9\"},children:\" hidden_dim\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9\"},children:\" n_layers\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9\"},children:\" dropout\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#88C0D0\"},children:\"        super\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"().\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"__init__\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"()\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"output_dim \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" output_dim\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"hidden_dim \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" hidden_dim\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"n_layers \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" n_layers\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"embedding \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" nn\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"Embedding\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"output_dim\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" embedding_dim\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"rnn \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" nn\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"LSTM\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"embedding_dim\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" hidden_dim\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" n_layers\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9\"},children:\" dropout\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"dropout\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"fc_out \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" nn\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"Linear\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"hidden_dim\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" output_dim\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"dropout \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" nn\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"Dropout\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"dropout\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(c.span,{className:\"line\"}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"    def\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\" forward\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9\"},children:\" input\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9\"},children:\" hidden\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9\"},children:\" cell\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # input = [batch size]\"})}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # hidden = [n layers * n directions, batch size, hidden dim]\"})}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # cell = [n layers * n directions, batch size, hidden dim]\"})}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # n directions in the decoder will both always be 1, therefore:\"})}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # hidden = [n layers, batch size, hidden dim]\"})}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # context = [n layers, batch size, hidden dim]\"})}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#88C0D0\"},children:\"        input\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\" =\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\" input\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"unsqueeze\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#B48EAD\"},children:\"0\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # input = [1, batch size]\"})}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"        embedded \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"dropout\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"embedding\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"input\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"))\"})]}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # embedded = [1, batch size, embedding dim]\"})}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"        output\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\" (\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"hidden\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" cell\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\")\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\" =\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"rnn\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"embedded\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\" (\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"hidden\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" cell\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"))\"})]}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # output = [seq length, batch size, hidden dim * n directions]\"})}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # hidden = [n layers * n directions, batch size, hidden dim]\"})}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # cell = [n layers * n directions, batch size, hidden dim]\"})}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # seq length and n directions will always be 1 in this decoder, therefore:\"})}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # output = [1, batch size, hidden dim]\"})}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # hidden = [n layers, batch size, hidden dim]\"})}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # cell = [n layers, batch size, hidden dim]\"})}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"        prediction \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"fc_out\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"output\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"squeeze\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#B48EAD\"},children:\"0\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"))\"})]}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # prediction = [batch size, output dim]\"})}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"        return\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" prediction\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" hidden\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" cell\"})]})]})})}),\"\\n\",n(c.p,{children:[e(c.code,{children:\"output, (hidden, cell) = self.rnn(embedded, (hidden, cell))\"}),\" is similar to the one of encoder.\"]}),\"\\n\",e(c.p,{children:\"Model\"}),\"\\n\",e(l,{children:e(c.pre,{className:\"shiki nord\",style:{backgroundColor:\"#2e3440ff\",color:\"#d8dee9ff\"},tabIndex:\"0\",children:n(c.code,{children:[n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"class\"}),e(c.span,{style:{color:\"#8FBCBB\"},children:\" Seq2Seq\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#8FBCBB\",fontWeight:\"bold\"},children:\"nn\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#8FBCBB\",fontWeight:\"bold\"},children:\"Module\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"    def\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\" __init__\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9\"},children:\" encoder\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9\"},children:\" decoder\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9\"},children:\" device\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#88C0D0\"},children:\"        super\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"().\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"__init__\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"()\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"encoder \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" encoder\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"decoder \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" decoder\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"        self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"device \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" device\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"        assert\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\" (\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"            encoder\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"hidden_dim \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"==\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" decoder\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"hidden_dim\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#ECEFF4\"},children:\"        ),\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:' \"'}),e(c.span,{style:{color:\"#A3BE8C\"},children:\"Hidden dimensions of encoder and decoder must be equal!\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"        assert\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\" (\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"            encoder\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"n_layers \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"==\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" decoder\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"n_layers\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#ECEFF4\"},children:\"        ),\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:' \"'}),e(c.span,{style:{color:\"#A3BE8C\"},children:\"Encoder and decoder must have equal number of layers!\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),\"\\n\",e(c.span,{className:\"line\"}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"    def\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\" forward\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9\"},children:\" src\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9\"},children:\" trg\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9\"},children:\" teacher_forcing_ratio\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # src = [src length, batch size]\"})}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # trg = [trg length, batch size]\"})}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # teacher_forcing_ratio is probability to use teacher forcing\"})}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # e.g. if teacher_forcing_ratio is 0.75 we use ground-truth inputs 75% of the time\"})}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"        batch_size \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" trg\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"shape\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),e(c.span,{style:{color:\"#B48EAD\"},children:\"1\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"]\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"        trg_length \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" trg\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"shape\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),e(c.span,{style:{color:\"#B48EAD\"},children:\"0\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"]\"})]}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"        trg_vocab_size \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"decoder\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"output_dim\"})]}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # tensor to store decoder outputs\"})}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"        outputs \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" torch\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"zeros\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"trg_length\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" batch_size\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" trg_vocab_size\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\").\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"to\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"device\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # last hidden state of the encoder is used as the initial hidden state of the decoder\"})}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"        hidden\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" cell \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"encoder\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"src\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # hidden = [n layers * n directions, batch size, hidden dim]\"})}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # cell = [n layers * n directions, batch size, hidden dim]\"})}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # first input to the decoder is the <sos> tokens\"})}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#88C0D0\"},children:\"        input\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\" =\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" trg\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),e(c.span,{style:{color:\"#B48EAD\"},children:\"0\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\" :]\"})]}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"        # input = [batch size]\"})}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"        for\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" t \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"in\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\" range\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#B48EAD\"},children:\"1\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" trg_length\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"):\"})]}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"            # insert input token embedding, previous hidden and previous cell states\"})}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"            # receive output tensor (predictions) and new hidden and cell states\"})}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"            output\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" hidden\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" cell \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\" self\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"decoder\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"input\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" hidden\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\",\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" cell\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"            # output = [batch size, output dim]\"})}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"            # hidden = [n layers, batch size, hidden dim]\"})}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"            # cell = [n layers, batch size, hidden dim]\"})}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"            # place predictions in a tensor holding predictions for each token\"})}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"            outputs\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"t\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"]\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\" =\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" output\"})]}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"            # decide if we are going to use teacher forcing or not\"})}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"            teacher_force \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" random\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"random\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"()\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\" <\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" teacher_forcing_ratio\"})]}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"            # get the highest predicted token from our predictions\"})}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"            top1 \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"=\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" output\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\".\"}),e(c.span,{style:{color:\"#88C0D0\"},children:\"argmax\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),e(c.span,{style:{color:\"#B48EAD\"},children:\"1\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"            # if teacher forcing, use actual next token as next input\"})}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"            # if not, use predicted token\"})}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#88C0D0\"},children:\"            input\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\" =\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" trg\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\"t\"}),e(c.span,{style:{color:\"#ECEFF4\"},children:\"]\"}),e(c.span,{style:{color:\"#81A1C1\"},children:\" if\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" teacher_force \"}),e(c.span,{style:{color:\"#81A1C1\"},children:\"else\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" top1\"})]}),\"\\n\",e(c.span,{className:\"line\",children:e(c.span,{style:{color:\"#616E88\"},children:\"            # input = [batch size]\"})}),\"\\n\",n(c.span,{className:\"line\",children:[e(c.span,{style:{color:\"#81A1C1\"},children:\"        return\"}),e(c.span,{style:{color:\"#D8DEE9FF\"},children:\" outputs\"})]})]})})}),\"\\n\",e(c.p,{children:\"I would recommend you to read minutely about the flow of the code, if you are begginer of Neural Network and Language model.\"}),\"\\n\",e(c.hr,{})]})}return{default:function(l={}){const{wrapper:n}=l.components||{};return n?e(n,{...l,children:e(_createMdxContent,{...l})}):_createMdxContent(l)}};",
    "permalink": "/study/paper-review/tutorial-seq2seq"
  },
  {
    "title": "ViT and MLP-Mixer",
    "description": "What is inductive bias? Then, what is the key difference between ViT and CNN?",
    "slug": "vit-mlpmixer",
    "publishDate": "2025-05-02",
    "thumbnailUrl": "/development/vit-mlpmixer/2.png",
    "content": "const{Fragment:e,jsx:i,jsxs:t}=arguments[0];function _createMdxContent(n){const r={a:\"a\",blockquote:\"blockquote\",code:\"code\",hr:\"hr\",img:\"img\",p:\"p\",...n.components};return t(e,{children:[i(r.p,{children:\"NLP  , Vision       !\"}),\"\\n\",i(r.p,{children:\"NLP    ViT .      ViT CNN     .         Vision field   image processing    .\"}),\"\\n\",t(r.p,{children:[\" \",i(r.code,{children:\"CNN filter size  convolution  , ViT transformer     .  context window   .\"}),\"  . (      .)\"]}),\"\\n\",t(r.p,{children:[\" 2  \",i(r.code,{children:\" transformer input context size   CNN    ?   context size   ViT CNN  ?\"}),\"  .          . Convolution       ,    CNN   .    ViT         transformer   .\"]}),\"\\n\",i(r.p,{children:\"  Query, Key, Value attention operation . convolution operation filter    relationship       ,   context size deep neural network   Transformer   filter size   parameter   .   Q, K, V        . (    inductive bias  locality   .)  Cross-attention ...  Encoder, Decoder           .\"}),\"\\n\",t(r.p,{children:[\"       \",i(r.code,{children:\" .\"}),\" .    ,    \",i(r.code,{children:\"Multi-head attention\"}),\"   '' . Transformer  head       ,    AI    Head  latent representation       . Convolution   image natural language     ''  .     .\"]}),\"\\n\",i(r.p,{children:\"   ViT MLP-Mixer       .       Context size    inductive bias .  context size        .  MLP-Mixer   .  inductive bias multi-head attention      .\"}),\"\\n\",i(r.p,{children:\"  implicit       ?   ,         ,     .      !\"}),\"\\n\",i(r.hr,{}),\"\\n\",t(r.p,{children:[\"Before diving into this topic, I'd like to highlight an exceptional \",i(r.a,{href:\"https://www.youtube.com/watch?v=Y-isY31Thkw\",children:\"YouTube Video\"}),\" that brilliantly illustrates the concepts of image processing and what is 'inductive bias'.\"]}),\"\\n\",t(r.p,{children:[\"Initially, I'll examine the groundbreaking \",i(r.a,{href:\"https://arxiv.org/pdf/2010.11929.pdf\",children:\"Vit Paper\"}),\".\"]}),\"\\n\",i(r.p,{children:i(r.img,{src:\"/development/vit-mlpmixer/1.png\",alt:\"\"})}),\"\\n\",i(r.p,{children:\"In abstract,\"}),\"\\n\",t(r.blockquote,{children:[\"\\n\",i(r.p,{children:\"When pre-trained on large amounts of data and transferred to multiple mid-sized or small image recognition benchmarks (ImageNet, CIFAR-100, VTAB, etc.), Vision Transformer (ViT) attains excellent results compared to state-of-the-art convolutional networks while requiring substantially fewer computational resources to train.\"}),\"\\n\"]}),\"\\n\",i(r.p,{children:\"A critical factor in this approach is the necessity for training on extensive datasets. Due to the nature of inductive bias, transformer architectures require substantial amounts of data to achieve optimal performance.\"}),\"\\n\",i(r.p,{children:\"Following the transformer's remarkable success in NLP, numerous attempts have been made to adapt this architecture to the image processing domain.\"}),\"\\n\",i(r.p,{children:\"However, these initial efforts yielded disappointing results that fell short of expectations. The researchers of ViT attributed this underperformance to a fundamental architectural difference:\"}),\"\\n\",t(r.blockquote,{children:[\"\\n\",i(r.p,{children:\"Transformers lack some of the inductive biases inherent to CNNs, such as translation equivariance and locality, and therefore do not generalize well when trained on insufficient amounts of data.\"}),\"\\n\"]}),\"\\n\",i(r.p,{children:\"This analysis led to a pivotal breakthrough in their research:\"}),\"\\n\",t(r.blockquote,{children:[\"\\n\",i(r.p,{children:\"We find that large scale training trumps inductive bias.\"}),\"\\n\"]}),\"\\n\",i(r.p,{children:\"So, what does this actually imply? what precisely is 'inductive bias', and why is a substantial volume of data necessary?\"}),\"\\n\",i(r.p,{children:\"Before exploring these questions, let's first understand the ViT architecture.\"}),\"\\n\",i(r.p,{children:i(r.img,{src:\"/development/vit-mlpmixer/2.png\",alt:\"\"})}),\"\\n\",i(r.p,{children:\"ViT requires the input to be divided into fixed-size segments, known as PxP patches.\"}),\"\\n\",i(r.p,{children:\"The original image dimensions are represented as (H, W, C), corresponding to Height, Width, and Channel respectively. The N patches each have dimensions of (P, P, C), where N = H*W/P^2\"}),\"\\n\",i(r.p,{children:\"After splitting the image into the patches:\"}),\"\\n\",t(r.blockquote,{children:[\"\\n\",i(r.p,{children:\"The Transformer uses constant latent vector size D through all of its layers, so we flatten the patches and map to Ddimensions with a trainable linear projection (Eq. 1). We refer to the output of this projection as the patch embeddings.\"}),\"\\n\"]}),\"\\n\",i(r.p,{children:i(r.img,{src:\"/development/vit-mlpmixer/3.png\",alt:\"\"})}),\"\\n\",i(r.p,{children:\"In equation (1), xE represents the embedding vector that serves as input for the self-attention operation. Furthermore, the subsequent equations elucidate the operation performed by the architecture, as illustrated in Figure 1.\"}),\"\\n\",i(r.p,{children:\"For those already familiar with 'self-attention' mechanisms, the fundamental distinction between CNN and ViT becomes evident: context scope. While ViT computes relationships across all patches simultaneously during self-attention, CNNs only process interactions between adjacent patches during convolution. This distinction represents the essence of inductive bias.\"}),\"\\n\",i(r.p,{children:\"Inductive bias refers to the inherent predispositions or assumptions within a model that facilitate generalization, thereby enhancing performance. How does this mechanism function? In machine learning contexts, the objective is to identify a predictor that minimizes loss. Throughout this optimization process, inductive bias serves a vital function in mitigating overfitting. Calibrating an appropriate degree of inductive bias is crucial, as suboptimal values can either lead to overfitting or compromise overall performance.\"}),\"\\n\",i(r.p,{children:i(r.img,{src:\"/development/vit-mlpmixer/4.png\",alt:\"\"})}),\"\\n\",t(r.blockquote,{children:[\"\\n\",i(r.p,{children:\"In CNNs, locality, two-dimensional neighborhood structure, and translation equivariance are baked into each layer throughout the whole model. In ViT, only MLP layers are local and translationally equivariant, while the self-attention layers are global.\"}),\"\\n\"]}),\"\\n\",i(r.p,{children:\"The authors explain that CNNs inherently possess locality and translation inductive biases, while ViT lacks these specific predispositions. At this point, this distinction prompts a crucial question: Is transformer completely devoid of inductive bias?\"}),\"\\n\",i(r.p,{children:\"Well, I explained inductive bias as 'predispositions or assumptions within a model'. It means that inductive bias enhance a model's predictive capabilities when confronted with novel scenarios-situations the model hasn't encountered during its training phase. Following this rationale, both CNNs and transformers inherently possess inductive biases, although the former has structural inductive bias, while the latter has global inductive bias.\"}),\"\\n\",i(r.p,{children:i(r.img,{src:\"/development/vit-mlpmixer/5.png\",alt:\"\"})}),\"\\n\",i(r.p,{children:\"Structural inductive bias can be effectively learned from comparatively smaller datasets than those required for global inductive bias. This distinction is intuitively comprehensible: establishing meaningful correlations across all input elements and identifying appropriate patterns for model generalization presents a substantially more complex challenge.\"}),\"\\n\",i(r.p,{children:\"MLP-Mixer effectively exemplifies this intuition through its linear computational complexity processes: Token-mixing MLP and Channel-mixing MLP.\"}),\"\\n\",i(r.p,{children:i(r.img,{src:\"/development/vit-mlpmixer/6.png\",alt:\"\"})}),\"\\n\",i(r.p,{children:\"This architecture represents not merely a novel approach that is considerably more streamlined than either ViT or CNNs, but also an evolutionary synthesis derived from both CNNs and transformers. The authors characterize MLP-Mixer as an expanded conceptualization of CNNs.\"}),\"\\n\",i(r.p,{children:\"Through this architectural attempt, the presence of inductive bias becomes evident, enabling us to understand its attributes.\"}),\"\\n\",t(r.blockquote,{children:[\"\\n\",i(r.p,{children:\"we would like to understand the inductive biases hidden in these various features and eventually their role in generalization\"}),\"\\n\"]}),\"\\n\",i(r.hr,{}),\"\\n\",i(r.p,{children:\"Reference\"}),\"\\n\",t(r.p,{children:[\"Paper Review MLP-Mixer: An all-MLP Architecture for Vision - \",i(r.a,{href:\"https://www.youtube.com/watch?v=Y-isY31Thkw\",children:\"https://www.youtube.com/watch?v=Y-isY31Thkw\"}),\"\\nViT Paper: \",i(r.a,{href:\"https://arxiv.org/pdf/2010.11929.pdf\",children:\"https://arxiv.org/pdf/2010.11929.pdf\"}),\"\\nMLP-Mixer Paper: \",i(r.a,{href:\"https://arxiv.org/abs/2105.01601\",children:\"https://arxiv.org/abs/2105.01601\"})]}),\"\\n\",i(r.hr,{})]})}return{default:function(e={}){const{wrapper:t}=e.components||{};return t?i(t,{...e,children:i(_createMdxContent,{...e})}):_createMdxContent(e)}};",
    "permalink": "/study/paper-review/vit-mlpmixer"
  }
]